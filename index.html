<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 爱上口袋的天空</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/image1.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <!-- mermaid -->
      
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">爱上口袋的天空</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['欢迎来到爱上口袋的天空的博客', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  <ul class="ads">
    
        <li>
            <a target="_blank" rel="noopener" href="https://curl.qcloud.com/kvO7hb43">
                <img src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/ten_1.jpg" width="300" alt="云服务器限时秒杀">
            </a>
        </li>
    
        <li>
            <a target="_blank" rel="noopener" href="https://www.vultr.com/?ref=8630075">
                <img src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/vultr.png" width="300" alt="vultr优惠vps">
            </a>
        </li>
    
</ul>
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-FastDFS简介"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/FastDFS%E7%AE%80%E4%BB%8B/"
    >FastDFS简介</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/FastDFS%E7%AE%80%E4%BB%8B/" class="article-date">
  <time datetime="2021-07-18T14:22:37.088Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Fastdfs/">Fastdfs</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: FastDFS简介<br>categories:</p>
<ul>
<li>fastdfs</li>
</ul>
<p>—### 1.什么是分布式文件系统</p>
<blockquote>
<p>         分布式文件系统 (Distributed File System) 是一个软件/软件服务器，这个软件可以用来管理文件。但这个软件所管理的文件通常不是在一个服务器节点上，而是在多个服务器节点上，这些服务器节点通过网络相连构成一个庞大的文件存储服务器集群，这些服务器都用于存储文件资源，通过分布式文件系统来管理这些服务器上的文件。<br>        常见的分布式文件系统有：FastDFS、GFS、HDFS、Lustre 、Ceph 、GridFS 、mogileFS、TFS等。<br>        分布式文件系统与传统文件系统对比<br> <img alt="" height="292" src="https://img-blog.csdnimg.cn/20210417174637335.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="553"><br> 传统方式弊端 </p>
</blockquote>
<ul>
<li>如果用户数量多，IO操作比较多，对磁盘访问压力很大- 如果磁盘发生故障，会造成数据丢失- 存储容量有限</li>
</ul>
<h3 id="2-​​​​​​​FastDFS简介"><a href="#2-​​​​​​​FastDFS简介" class="headerlink" title="2.​​​​​​​FastDFS简介"></a>2.​​​​​​​FastDFS简介</h3><blockquote>
<p>         FastDFS是一个开源的轻量级分布式文件系统，为互联网应用量身定做，简单、灵活、高效，采用C语言开发，由阿里巴巴开发并开源。<br>        FastDFS对文件进行管理，功能包括：文件存储、文件同步、文件访问（文件上传、文件下载、文件删除）等，解决了大容量文件存储的问题，特别适合以文件为载体的在线服务，如相册网站、文档网站、图片网站、视频网站等等。<br>        FastDFS充分考虑了冗余备份、线性扩容等机制，并注重高可用、高性能等指标，使用FastDFS很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。 </p>
</blockquote>
<h3 id="3-​​​​​​​FastDFS整体架构"><a href="#3-​​​​​​​FastDFS整体架构" class="headerlink" title="3.​​​​​​​FastDFS整体架构"></a>3.​​​​​​​FastDFS整体架构</h3><blockquote>
<p>       FastDFS文件系统由两大部分构成，一个是客户端，一个是服务端<br>       客户端通常指我们的程序，比如我们的Java程序去连接FastDFS、操作FastDFS，那我们的Java程序就是一个客户端，FastDFS提供专有API访问，目前提供了C、Java和PHP几种编程语言的API，用来访问FastDFS文件系统。<br>          服务端由两个部分构成：一个是跟踪器（tracker），一个是存储节点（storage）<br>          跟踪器（tracker）主要做调度工作，在内存中记录集群中存储节点storage的状态信息，是前端Client和后端存储节点storage的枢纽。因为相关信息全部在内存中，Tracker server的性能非常高，一个较大的集群（比如上百个group）中有3台就足够了。<br>          存储节点（storage）用于存储文件，包括文件和文件属性（meta data）都保存到存储服务器磁盘上，完成文件管理的所有功能：文件存储、文件同步和提供文件访问等。 ​​​​​​​</p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-FastDFS环境搭建"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/FastDFS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"
    >FastDFS环境搭建</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/FastDFS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="article-date">
  <time datetime="2021-07-18T14:22:37.086Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Fastdfs/">Fastdfs</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: FastDFS环境搭建<br>categories:</p>
<ul>
<li>fastdfs</li>
</ul>
<p>—### 1.安装前的准备</p>
<blockquote>
<p> 检查Linux上是否安装了 gcc、libevent、libevent-devel </p>
</blockquote>
<ul>
<li>yum list installed | grep gcc- yum list installed | grep libevent- yum list installed | grep libevent-devel<br>如果没有安装，则需进行安装<br>命令：yum install gcc libevent libevent-devel -y </li>
</ul>
<h3 id="2-安装-libfastcommon-库"><a href="#2-安装-libfastcommon-库" class="headerlink" title="2.安装 libfastcommon 库"></a>2.安装 libfastcommon 库</h3><blockquote>
<p> libfastcommon 库是 FastDFS 文件系统运行需要的公共 C 语言函数库<br> *<em>注意：目前最新版本的v1.0.39</em><em><strong>和最新版的FastDFS5.11</strong></em><em>不兼容，所有我们这里使用的版本是v1.0.36  <strong>下载地址：<br> 将下载好的libfastcommon文件上传到Linuxs（/opt/FastDFS）<br> <img alt="" height="192" src="https://img-blog.csdnimg.cn/20210417181554593.png" width="877"><br> 解压下载下来的tar.gz压缩包到当前目录<br> 命令：tar -zxvf libfastcommon-1.0.36.tar.gz<br> 切换到解压后的libfastcommon目录<br> <img alt="" height="251" src="https://img-blog.csdnimg.cn/20210417181925833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="762"><br> 执行make脚本进行编译<br>  ** ./make.sh</strong><br> <img alt="" height="241" src="https://img-blog.csdnimg.cn/20210417182035706.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1005"><br> <strong>注意： make</strong></em><em>编译的时候如果报错，需解决错误后再次进行make</em><em><strong>，通常发生错误是由于Linux</strong></em><em>缺少某些依赖库导致，根据错误提示解决错误</em>*<br> 执行make install进行安装<br> ./make.sh install<br> <img alt="" height="261" src="https://img-blog.csdnimg.cn/20210417182154506.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1152"> </p>
</blockquote>
<h3 id="3-安装FastDFS"><a href="#3-安装FastDFS" class="headerlink" title="3.安装FastDFS"></a>3.安装FastDFS</h3><blockquote>
<p> FastDFS没有Windows版本，不能在Windows下使用。<br> FastDFS需要安装部署在Linux环境下，我们这里使用的是fastdfs-5.11版本（201901）<br> 下载地址：<br> 解压下载下来的tar.gz压缩包到当前目录<br> 命令：tar -zxvf fastdfs-5.11.tar.gz<br> <img alt="" height="305" src="https://img-blog.csdnimg.cn/20210417182356215.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="800"><br> 切换到解压后FastDFS的目录，执行make脚本进行编译<br> <img alt="" height="530" src="https://img-blog.csdnimg.cn/20210417182507948.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="862"><br> 执行make install进行安装<br> 命令：./make.sh install<br> <img alt="" height="501" src="https://img-blog.csdnimg.cn/20210417182626786.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1073"><br> 至此FastDFS安装完成<br> 所有编译出来的文件存放在/usr/bin目录下<br> 所有配置文件存放在/etc/fdfs目录下<br> 查看安装后的效果：<br> 命令：ll /usr/bin/fdfs*<br> <img alt="" height="351" src="https://img-blog.csdnimg.cn/2021041718314329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="864"><br> /usr/bin是Linux的环境变量，可通过echo $PATH查看<br> 查看FastDFS的配置文件：<br> 命令：ll /etc/fdfs/<br> <img alt="" height="186" src="https://img-blog.csdnimg.cn/20210417183302325.png" width="767"><br> 另外注意需要把解压后的fastdfs-5.11/conf目录下的两个文件拷贝到/etc/fdfs/ ，否则后续会有很多奇怪问题不好解决<br> 命令：<br> cp http.conf /etc/fdfs/<br> cp mime.types /etc/fdfs/<br> <img alt="" height="322" src="https://img-blog.csdnimg.cn/20210417183955536.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="659"> </p>
</blockquote>
<h3 id="4-配置FastDFS"><a href="#4-配置FastDFS" class="headerlink" title="4.配置FastDFS"></a>4.配置FastDFS</h3><blockquote>
<p> 去掉/etc/fdfs/目录下FastDFS配置文件的后缀名<br> <img alt="" height="479" src="https://img-blog.csdnimg.cn/20210417184429614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="894"><br> 修改tracker.conf文件<br> <strong>默认指向的FastDFS****作者余庆的目录，因为在我们的机器上不存在，所有手动改一下</strong><br>  base_path=/opt/FastDFS/tracker             #配置tracker存储数据的目录，<strong>这个目录需要提前创建</strong><br> 命令：vim tracker.conf<br> <img alt="" height="580" src="https://img-blog.csdnimg.cn/2021041718523648.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="642"><br> 修改storage.conf文件<br>          base_path=/opt/FastDFS/storage                     #storage存储数据目录，<strong>目录需要提前创建</strong><br>          store_path0=/opt/FastDFS/storage/files         #真正存放文件的目录，<strong>目录需要提前创建</strong><br>          tracker_server=192.168.56.13:22122        #注册当前存储节点的跟踪器地址<br> <img alt="" height="124" src="https://img-blog.csdnimg.cn/20210417185931650.png" width="553"><br> <img alt="" height="169" src="https://img-blog.csdnimg.cn/20210417190051272.png" width="956"><br> <img alt="" height="129" src="https://img-blog.csdnimg.cn/20210417190124513.png" width="524"> </p>
</blockquote>
<h3 id="5-启动FastDFS"><a href="#5-启动FastDFS" class="headerlink" title="5.启动FastDFS"></a>5.启动FastDFS</h3><blockquote>
</blockquote>
<ul>
<li>启动FastDFS的tracker服务 在任意目录下执行：fdfs_trackerd /etc/fdfs/tracker.conf- 查看启动的进程<img alt="" height="139" src="https://img-blog.csdnimg.cn/20210417195757797.png" width="898">- 启动FastDFS的storage服务 在任意目录下执行：fdfs_storaged /etc/fdfs/storage.conf- 查看启动进程<img alt="" height="147" src="https://img-blog.csdnimg.cn/20210417200521133.png" width="898">- 查看storage是否已经注册到了tracker下 命令：fdfs_monitor /etc/fdfs/storage.conf<img alt="" height="437" src="https://img-blog.csdnimg.cn/20210417201359824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="780">- 首次启动storage后，会在配置的路径下创建存储文件的目录<img alt="" height="289" src="https://img-blog.csdnimg.cn/20210417201437435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="533"></li>
</ul>
<h3 id="6-FastDFS重启"><a href="#6-FastDFS重启" class="headerlink" title="6.FastDFS重启"></a>6.FastDFS重启</h3><blockquote>
</blockquote>
<ul>
<li>重启tracker 命令：fdfs_trackerd /etc/fdfs/tracker.conf restart<img alt="" height="115" src="https://img-blog.csdnimg.cn/20210417201950615.png" width="828">- 重启storage 命令：fdfs_storaged /etc/fdfs/storage.conf restart<img alt="" height="87" src="https://img-blog.csdnimg.cn/20210417202025395.png" width="773"></li>
</ul>
<h3 id="7-​​​​​​​FastDFS关闭"><a href="#7-​​​​​​​FastDFS关闭" class="headerlink" title="7.​​​​​​​FastDFS关闭"></a>7.​​​​​​​FastDFS关闭</h3><blockquote>
</blockquote>
<ul>
<li>关闭tracker执行命令 在任意目录下执行：fdfs_trackerd /etc/fdfs/tracker.conf stop<img alt="" height="112" src="https://img-blog.csdnimg.cn/20210417202141922.png" width="757">- 关闭storage执行命令 在任意目录下执行：fdfs_storaged /etc/fdfs/storage.conf stop<img alt="" height="89" src="https://img-blog.csdnimg.cn/20210417202212646.png" width="723"><img alt="" height="80" src="https://img-blog.csdnimg.cn/20210417202444469.png" width="734">- 或者kill关闭fastdfs，但不建议在线上使用 kill -9 强制关闭，因为可能会导致文件信息不同步问题 ​​​​​​​</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-FastDFS测试"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/FastDFS%E6%B5%8B%E8%AF%95/"
    >FastDFS测试</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/FastDFS%E6%B5%8B%E8%AF%95/" class="article-date">
  <time datetime="2021-07-18T14:22:37.083Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Fastdfs/">Fastdfs</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: FastDFS测试<br>categories:</p>
<ul>
<li>fastdfs</li>
</ul>
<p>—### 1.简介</p>
<blockquote>
<p> FastDFS安装完成之后，可以使用fdfs_test脚本测试文件上传 </p>
</blockquote>
<h3 id="2-测试之前，需要修改client-conf配置文件，修改两个配置"><a href="#2-测试之前，需要修改client-conf配置文件，修改两个配置" class="headerlink" title="2.测试之前，需要修改client.conf配置文件，修改两个配置"></a>2.测试之前，需要修改client.conf配置文件，修改两个配置</h3><blockquote>
 <img alt="" height="280" src="https://img-blog.csdnimg.cn/20210417204142585.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="645"> 
 <img alt="" height="197" src="https://img-blog.csdnimg.cn/20210417204301702.png" width="686"> 
</blockquote>
<ul>
<li>在/opt/FastDFS//目录下创建client<img alt="" height="163" src="https://img-blog.csdnimg.cn/2021041720440960.png" width="507"></li>
</ul>
<h3 id="3-启动fdfs"><a href="#3-启动fdfs" class="headerlink" title="3.启动fdfs"></a>3.启动fdfs</h3><blockquote>
 <img alt="" height="230" src="https://img-blog.csdnimg.cn/20210417205010495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="900"> 
</blockquote>
<h3 id="4-测试文件上传"><a href="#4-测试文件上传" class="headerlink" title="4.测试文件上传"></a>4.测试文件上传</h3><blockquote>
</blockquote>
<ul>
<li>准备需要上传的文件<img alt="" height="177" src="https://img-blog.csdnimg.cn/20210417205317340.png" width="702"><img alt="" height="162" src="https://img-blog.csdnimg.cn/20210417205415154.png" width="640">- 执行上传命令fdfs_test /etc/fdfs/client.conf upload /root/aa.txt<img alt="" height="409" src="https://img-blog.csdnimg.cn/20210417210039610.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="704"><img alt="" height="770" src="https://img-blog.csdnimg.cn/20210417211150986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1009">- 切换到存储目录查看文件上传情况<img alt="" height="206" src="https://img-blog.csdnimg.cn/20210417210240688.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1078"><img alt="" height="188" src="https://img-blog.csdnimg.cn/20210417211219718.png" width="1006">- FastDFS生成的文件目录结构及名称示例<img alt="" height="89" src="https://img-blog.csdnimg.cn/20210417210319330.png" width="527">
  </li>
</ul>
<h3 id="5-测试文件下载"><a href="#5-测试文件下载" class="headerlink" title="5.测试文件下载"></a>5.测试文件下载</h3><blockquote>
 <img alt="" height="563" src="https://img-blog.csdnimg.cn/20210417214249415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
 命令：fdfs_test /etc/fdfs/client.conf download group1 M00/00/00/wKg4DWB620aAeye8AAAWdd4My38470.txt 
 group1：表示组名 
 M00/00/00/wKg4DWB620aAeye8AAAWdd4My38470.txt：要下载的文件名称，和上面上传时候的文件路径对应 
</blockquote>
<h3 id="6-测试文件删除"><a href="#6-测试文件删除" class="headerlink" title="6.测试文件删除"></a>6.测试文件删除</h3><blockquote>
<p> 命令：fdfs_test /etc/fdfs/client.conf delete group1 M00/00/00/wKg4DWB620aAeye8AAAWdd4My38470.txt<br> <img alt="" height="328" src="https://img-blog.csdnimg.cn/20210417214624413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"><br> 查看之前上传的路径：<br> <img alt="" height="168" src="https://img-blog.csdnimg.cn/20210417214929783.png" width="1029"> </p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-ES之词库的动态添加"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/ES%E4%B9%8B%E8%AF%8D%E5%BA%93%E7%9A%84%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0/"
    >ES之词库的动态添加</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/ES%E4%B9%8B%E8%AF%8D%E5%BA%93%E7%9A%84%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0/" class="article-date">
  <time datetime="2021-07-18T14:21:56.455Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: ES之词库的动态添加<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—### 1、环境准备</p>
<blockquote>
<p> 1）安装nginx1.18.0<br> 2)  安装好ES7.8.1和kibana7.8.1（提前准备好） </p>
</blockquote>
<h3 id="2、安装nginx"><a href="#2、安装nginx" class="headerlink" title="2、安装nginx"></a>2、安装nginx</h3><blockquote>
<p> 2.1）拉取nginx1.18.0镜像<br>         docker pull nginx:1.18.0<br> 2.2）创建挂载容器里面的界面的访问<br>          mkdir -p /mydata/nignx/html<br> 2.3）在/mydata/nignx/html/中创建hotwords.txt<br>          <img alt="" height="208" src="https://img-blog.csdnimg.cn/20210704142127275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="464"><br> 2.4）docker命令启动nginx<br>          docker run -itd -p 80:80 -v /mydata/nignx/html:/usr/share/nginx/html nginx:1.18.0<br> <img alt="" height="156" src="https://img-blog.csdnimg.cn/20210704142706539.png" width="1200"><br> 2.5) 浏览器访问：<br>     <img alt="" height="131" src="https://img-blog.csdnimg.cn/20210704142903713.png" width="649"> </p>
</blockquote>
<h3 id="3、开始配置es"><a href="#3、开始配置es" class="headerlink" title="3、开始配置es"></a>3、开始配置es</h3><blockquote>
<p> 3.1) 进入/opt/es781/elasticsearch-7.8.1/plugins/ik/config目录下修改IKAnalyzer.cfg.xml<br> <img alt="" height="363" src="https://img-blog.csdnimg.cn/20210704143225821.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="925"><br> 3.2）重启es<br> 3.3）使用kibana查看<br>      <img alt="" height="136" src="https://img-blog.csdnimg.cn/20210704143626716.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="578"><br> 3.4）测试一个单词“就是我”<br>       <img alt="" height="190" src="https://img-blog.csdnimg.cn/20210704143741562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="591"><br>      我们在nginx的hotwords.txt中添加这个单词<br>        <img alt="" height="130" src="https://img-blog.csdnimg.cn/20210704143923740.png" width="506"><br> 不重启es直接查询：<br> <img alt="" height="280" src="https://img-blog.csdnimg.cn/2021070414394629.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1053"> </p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-ELK知识点学习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/ELK%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AD%A6%E4%B9%A0/"
    >ELK知识点学习</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/ELK%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2021-07-18T14:21:56.453Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: ELK知识点学习<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—title: ELK知识点学习<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—1. </p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch之自动补全案例实战"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/Elasticsearch%E4%B9%8B%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/"
    >Elasticsearch之自动补全案例实战</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/Elasticsearch%E4%B9%8B%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/" class="article-date">
  <time datetime="2021-07-18T14:21:56.451Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: Elasticsearch之自动补全案例实战<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—### 1、案例需求：</p>
<blockquote>
<p> 通过拼音以及汉字筛选对应的明星！ </p>
</blockquote>
<h3 id="2、设置分词器以及mapping"><a href="#2、设置分词器以及mapping" class="headerlink" title="2、设置分词器以及mapping"></a>2、设置分词器以及mapping</h3><blockquote>
 <pre><code class="language-javascript">PUT starts
&#123;
  "settings": &#123;
    "analysis": &#123;
      "analyzer": &#123;
        "start_name_analyzer":&#123;
          "char_filter":["html_strip"],
          "tokenizer":"keyword",
          "filter":"start_name_filter"
        &#125;
      &#125;,
      "filter": &#123;
        "start_name_filter":&#123;
          "type":"pinyin",
          "keep_full_pinyin":false,
          "keep_joined_full_pinyin":true,
          "keep_original": true
        &#125;
      &#125;
    &#125;
  &#125;,
  "mappings": &#123;
    "properties": &#123;
      "name":&#123;
        "type": "completion",
        "analyzer": "start_name_analyzer",
        "search_analyzer": "keyword"
      &#125;
    &#125;
  &#125;
&#125;</code></pre> 
 <img alt="" height="808" src="https://img-blog.csdnimg.cn/20210704163948950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
</blockquote>
<h3 id="3、批量插入数据"><a href="#3、批量插入数据" class="headerlink" title="3、批量插入数据"></a>3、批量插入数据</h3><blockquote>
 <pre><code class="language-javascript">PUT starts/_bulk
&#123;"index":&#123;&#125;&#125;
&#123;"name":"张学友"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"刘德华"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"柳岩"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"李易峰"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"黄晓明"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"刘青云"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"易中天"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"李小璐"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"黄家驹"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"李思思"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"庄媛媛"&#125;
&#123;"index":&#123;&#125;&#125;
&#123;"name":"刘亦菲"&#125;</code></pre> 
 <img alt="" height="688" src="https://img-blog.csdnimg.cn/20210704164406424.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
</blockquote>
<h3 id="4、在kibana上测试一下效果"><a href="#4、在kibana上测试一下效果" class="headerlink" title="4、在kibana上测试一下效果"></a>4、在kibana上测试一下效果</h3><blockquote>
 <pre><code class="language-java">GET starts/_search
&#123;
  "_source": false,
  "suggest": &#123;
    "start_name_suggest": &#123;
      "prefix":"柳",
      "completion":&#123;
        "field":"name",
        "size": 10,
        "skip_duplicates": true
      &#125;
    &#125;
  &#125;
&#125;</code></pre> 
 <img alt="" height="835" src="https://img-blog.csdnimg.cn/20210704164750795.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
 <img alt="" height="949" src="https://img-blog.csdnimg.cn/20210704164822955.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
 <img alt="" height="862" src="https://img-blog.csdnimg.cn/20210704164910346.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
 <img alt="" height="970" src="https://img-blog.csdnimg.cn/2021070416502437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
</blockquote>
<h3 id="5、在java服务端实现上面测试的自动补全案例"><a href="#5、在java服务端实现上面测试的自动补全案例" class="headerlink" title="5、在java服务端实现上面测试的自动补全案例"></a>5、在java服务端实现上面测试的自动补全案例</h3><blockquote>
<p> 5.1、Springboot整合ES7.8.1已经提前整合了<br> 5.2、创建controller类<br> <pre><code class="language-java">package com.kgf.es.controller;</p>
</blockquote>
<p>import com.alibaba.fastjson.JSONArray;<br>import com.alibaba.fastjson.JSONObject;<br>import org.apache.http.util.EntityUtils;<br>import org.elasticsearch.client.Request;<br>import org.elasticsearch.client.Response;<br>import org.elasticsearch.client.RestHighLevelClient;<br>import org.springframework.web.bind.annotation.GetMapping;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.RestController;</p>
<p>import javax.annotation.Resource;<br>import java.io.IOException;<br>import java.util.ArrayList;<br>import java.util.List;</p>
<p>@RequestMapping(“start”)<br>@RestController<br>public class StartController &#123;</p>
<pre><code>@Resource
private RestHighLevelClient restHighLevelClient;

@GetMapping(&quot;autoComplete&quot;)
public Object autoComplete(String term) throws IOException &#123;
    Request request = new Request(&quot;GET&quot;, &quot;starts/_search&quot;);
    request.setJsonEntity(String.format(&quot;&#123;&quot; +
            &quot;  \&quot;_source\&quot;: false,&quot; +
            &quot;  \&quot;suggest\&quot;: &#123;&quot; +
            &quot;    \&quot;start_name_suggest\&quot;: &#123;&quot; +
            &quot;      \&quot;prefix\&quot;:\&quot;%s\&quot;,&quot; +
            &quot;      \&quot;completion\&quot;:&#123;&quot; +
            &quot;        \&quot;field\&quot;:\&quot;name\&quot;,&quot; +
            &quot;        \&quot;size\&quot;: 10,&quot; +
            &quot;        \&quot;skip_duplicates\&quot;: true&quot; +
            &quot;      &#125;&quot; +
            &quot;    &#125;&quot; +
            &quot;  &#125;&quot; +
            &quot;&#125;&quot;,term));
    Response response = restHighLevelClient.getLowLevelClient().performRequest(request);
    String json = EntityUtils.toString(response.getEntity());
    JSONObject jsonObject = JSONObject.parseObject(json);
    JSONArray suggests = jsonObject.getJSONObject(&quot;suggest&quot;).getJSONArray(&quot;start_name_suggest&quot;);
    JSONArray options = suggests.getJSONObject(0).getJSONArray(&quot;options&quot;);
    List&amp;lt;String&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
    for (int i = 0; i &amp;lt; options.size(); i++) &#123;
        JSONObject object = options.getJSONObject(i);
        list.add(object.getString(&quot;text&quot;));
    &#125;
    return list;
&#125;
</code></pre>
<p>}<br></code></pre> </p>
<h3 id="6、访问测试效果"><a href="#6、访问测试效果" class="headerlink" title="6、访问测试效果"></a>6、访问测试效果</h3><blockquote>
 <img alt="" height="290" src="https://img-blog.csdnimg.cn/20210704181240367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="807"> 
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch之新闻案例实战"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/Elasticsearch%E4%B9%8B%E6%96%B0%E9%97%BB%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/"
    >Elasticsearch之新闻案例实战</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/Elasticsearch%E4%B9%8B%E6%96%B0%E9%97%BB%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/" class="article-date">
  <time datetime="2021-07-18T14:21:56.449Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: Elasticsearch之新闻案例实战<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—### 1、创建数据库表且预置数据</p>
<blockquote>
<p> 1.1、表结构如下<br> <pre><code class="language-sql">DROP TABLE IF EXISTS <code>news</code>;<br>CREATE TABLE <code>news</code> (<br>    <code>id</code> int(11) NOT NULL AUTO_INCREMENT,<br>    <code>title</code> varchar(255) NOT NULL comment '主题',<br>    <code>url</code> varchar(255) DEFAULT NULL comment '连接',<br>    <code>content</code> text comment '内容',<br>    <code>tags</code> varchar(1000) DEFAULT NULL comment '搜索的关键字',<br>    PRIMARY KEY (<code>id</code>) USING BTREE<br>) ENGINE=InnoDB AUTO_INCREMENT=92 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</code></pre><br> 1.2、数据如下<br> <img alt="" height="629" src="https://img-blog.csdnimg.cn/20210704215709241.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
<h3 id="2、定义分词器以及属性类型"><a href="#2、定义分词器以及属性类型" class="headerlink" title="2、定义分词器以及属性类型"></a>2、定义分词器以及属性类型</h3><blockquote>
 <pre><code class="language-javascript">PUT news
&#123;
  "settings": &#123;
    "analysis": &#123;
      "analyzer": &#123;
        "news_tags_analyzer": &#123;
          "char_filter": ["html_strip"],
          "tokenizer": "keyword",
          "filter": "news_tags_filter"
        &#125;
      &#125;,
      "filter": &#123;
        "news_tags_filter": &#123;
          "type": "pinyin",
          "keep_full_pinyin": true,
          "keep_joined_full_pinyin": true,
          "keep_original": true
        &#125;
      &#125;
    &#125;
  &#125;,
  "mappings": &#123;
    "properties": &#123;
      "id": &#123;
        "type": "long"
      &#125;,
      "title": &#123;
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart"
      &#125;,
      "content": &#123;
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart"
      &#125;,
      "url": &#123;
        "type": "keyword"
      &#125;,
      "tags": &#123;
        "type": "completion",
        "analyzer": "news_tags_analyzer",
        "search_analyzer": "keyword"
      &#125;
    &#125;
  &#125;
&#125;</code></pre> 
<p>  <img alt="" height="590" src="https://img-blog.csdnimg.cn/20210704221658848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1185"> </p>
</blockquote>
<h3 id="3、将mysql数据导入es"><a href="#3、将mysql数据导入es" class="headerlink" title="3、将mysql数据导入es"></a>3、将mysql数据导入es</h3><blockquote>
<p> 2.1、创建logstash-mysql-news.conf文件<br> <pre><code class="language-html">#input表示将数据读取到logstash中<br>input &#123;<br>  jdbc &#123;<br>    jdbc_driver_library =&gt; "/opt/es781/mysql/mysql-connector-java-5.1.49.jar"<br>    jdbc_driver_class =&gt; "com.mysql.jdbc.Driver"<br>    jdbc_connection_string =&gt; "jdbc:mysql://192.168.1.13:3306/oss?userUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimeZone=UTC"<br>    jdbc_user =&gt; "root"<br>    jdbc_password =&gt; "897570"<br>    #表示是否分页<br>    jdbc_paging_enabled =&gt; "true"<br>    #表示每页的数量<br>    jdbc_page_size =&gt; "20"<br>    #查询语句<br>    statement =&gt; "SELECT * FROM news where tags is not null"<br>  &#125;<br>&#125;<br>#这个filter表示对数据进行过滤<br>filter &#123;<br>  mutate &#123;<br>    #根据逗号切割关键字<br>    split =&gt; &#123; "tags" =&gt; ","&#125;<br>  &#125;<br>  #将下面两个字段过滤掉，logstash会自动帮我们加这两个属性，我们不需要，直接去掉<br>  mutate &#123;<br>    remove_field =&gt; ["@timestamp","@version"]<br>  &#125;<br>&#125;<br>#将logstash中的数据输出到es中<br>output &#123;<br>  elasticsearch &#123;<br>    document_id =&gt; "%&#123;id&#125;"<br>    document_type =&gt; "_doc"<br>    index =&gt; "news"<br>    hosts =&gt; ["<a href="http://192.168.56.20:9200&quot;]">http://192.168.56.20:9200&quot;]</a><br>  &#125;<br>  stdout&#123;<br>    codec =&gt; rubydebug<br>  &#125;<br>&#125;<br></code></pre><br> 2.2、将上面需要的mysql jar包上传到Linux服务器上<br> <img alt="" height="223" src="https://img-blog.csdnimg.cn/20210704220031533.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="804"><br> 2.3、将logstash-mysql-news.conf文件上传到/opt/es781/logstash-7.8.1/目录下<br> <img alt="" height="589" src="https://img-blog.csdnimg.cn/20210704220333418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="776"><br> 2.4、在/opt/es781/logstash-7.8.1/目录下执行下面的命令将数据从mysql中导入es,<br>      命令：bin/logstash -f /opt/es781/logstash-7.8.1/logstash-mysql-news.conf      <img alt="" height="903" src="https://img-blog.csdnimg.cn/20210704220730172.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1089"><br> 2.5、在kibana上查询news索引是否成功导入数据<br> <img alt="" height="936" src="https://img-blog.csdnimg.cn/20210704220858401.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
<h3 id="4、根据需求编写kibana脚本"><a href="#4、根据需求编写kibana脚本" class="headerlink" title="4、根据需求编写kibana脚本"></a>4、根据需求编写kibana脚本</h3><blockquote>
<p> 4.1、自动补全语句<br> <pre><code class="language-javascript">GET news/_search<br>&#123;<br>  "_source": false,<br>  "suggest": &#123;<br>    "news_tags_suggest": &#123;<br>      "prefix": "zh",<br>      "completion":&#123;<br>        "field":"tags",<br>        "size": 10,<br>        "skip_duplicates": true<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;</code></pre><br> <img alt="" height="464" src="https://img-blog.csdnimg.cn/20210704222803907.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"><br> 4.2、内容搜索<br> <pre><code class="language-javascript">GET news/_search<br>&#123;<br>  "_source": false,<br>  "query": &#123;<br>    "multi_match": &#123;<br>      "query": "中国",<br>      "fields": ["title","content"]<br>    &#125;<br>  &#125;,<br>  "highlight": &#123;<br>    "pre_tags": "&lt;span class='highLight'&gt;",<br>    "post_tags": "&lt;/span&gt;",<br>    "fields": &#123;<br>      "title": &#123;&#125;,<br>      "content": &#123;&#125;<br>    &#125;<br>  &#125;<br>&#125;</code></pre><br> <img alt="" height="766" src="https://img-blog.csdnimg.cn/20210704222727872.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
<h3 id="5、在java中使用代码实现上面两个搜索"><a href="#5、在java中使用代码实现上面两个搜索" class="headerlink" title="5、在java中使用代码实现上面两个搜索"></a>5、在java中使用代码实现上面两个搜索</h3><blockquote>
<p> 5.1、创建news实体类<br> <pre><code class="language-java">package com.kgf.es.model;</p>
</blockquote>
<p>import lombok.AllArgsConstructor;<br>import lombok.Data;<br>import lombok.NoArgsConstructor;</p>
<p>@Data<br>@AllArgsConstructor<br>@NoArgsConstructor<br>public class News &#123;<br>    private Integer id;<br>    private String title;<br>    private String content;<br>    private String url;<br>&#125;<br></code></pre><br> 5.2、创建NewsController<br> <pre><code class="language-java">package com.kgf.es.controller;</p>
<p>import com.alibaba.fastjson.JSONArray;<br>import com.alibaba.fastjson.JSONObject;<br>import com.kgf.es.model.News;<br>import org.apache.http.util.EntityUtils;<br>import org.elasticsearch.client.Request;<br>import org.elasticsearch.client.Response;<br>import org.elasticsearch.client.RestHighLevelClient;<br>import org.springframework.web.bind.annotation.GetMapping;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.RestController;</p>
<p>import javax.annotation.Resource;<br>import java.io.IOException;<br>import java.util.ArrayList;<br>import java.util.List;</p>
<p>@RestController<br>@RequestMapping(“/news”)<br>public class NewsController &#123;</p>
<pre><code>@Resource
private RestHighLevelClient restHighLevelClient;


@GetMapping(&quot;/tips&quot;)
public Object autoComplete(String term) throws IOException &#123;
    Request request = new Request(&quot;GET&quot;, &quot;news/_search&quot;);

    request.setJsonEntity(String.format(&quot;&#123;&quot; +
            &quot;  \&quot;_source\&quot;: false, &quot; +
            &quot;  \&quot;suggest\&quot;: &#123;&quot; +
            &quot;    \&quot;news_tags_suggest\&quot;: &#123;&quot; +
            &quot;      \&quot;prefix\&quot;: \&quot;%s\&quot;,&quot; +
            &quot;      \&quot;completion\&quot;: &#123;&quot; +
            &quot;        \&quot;field\&quot;: \&quot;tags\&quot;,&quot; +
            &quot;        \&quot;size\&quot;: 10,&quot; +
            &quot;        \&quot;skip_duplicates\&quot;: true&quot; +
            &quot;      &#125;&quot; +
            &quot;    &#125;&quot; +
            &quot;  &#125;&quot; +
            &quot;&#125;&quot;, term));

    Response response = restHighLevelClient.getLowLevelClient().performRequest(request);

    String jsonString = EntityUtils.toString(response.getEntity()); // &quot;&#123;\&quot;age\&quot;: 10&#125;&quot;  &#123;&quot;age&quot;: 10&#125;

    JSONObject jsonObject = JSONObject.parseObject(jsonString);

    JSONArray suggests = jsonObject.getJSONObject(&quot;suggest&quot;).getJSONArray(&quot;news_tags_suggest&quot;);

    JSONArray options = suggests.getJSONObject(0).getJSONArray(&quot;options&quot;);

    List&amp;lt;String&amp;gt; results = new ArrayList&amp;lt;&amp;gt;();
    for(int i = 0; i &amp;lt; options.size(); i++) &#123;
        JSONObject opt = options.getJSONObject(i);
        results.add(opt.getString(&quot;text&quot;));
    &#125;

    return results;
&#125;

@GetMapping(&quot;/search&quot;)
public List&amp;lt;News&amp;gt; query(String text) throws Exception&#123;
    /**
     * 1.对于高亮的数据，ES是抽取的一个个片段，然后将这些片段设置到一个数组中。
     * 2.对于有些数据，可能title或者content中没有高亮的字眼，那么我们就需要取原始数据的 title 和 content.
     */
    Request request = new Request(&quot;GET&quot;, &quot;news/_search&quot;);
    request.setJsonEntity(String.format(&quot;&#123;&quot; +
            &quot;  \&quot;_source\&quot;: [\&quot;url\&quot;, \&quot;title\&quot;, \&quot;content\&quot;], &quot; +
            &quot;  \&quot;query\&quot;: &#123;&quot; +
            &quot;    \&quot;multi_match\&quot;: &#123;&quot; +
            &quot;      \&quot;query\&quot;: \&quot;%s\&quot;,&quot; +
            &quot;      \&quot;fields\&quot;: [\&quot;title\&quot;, \&quot;content\&quot;]&quot; +
            &quot;    &#125;&quot; +
            &quot;  &#125;,&quot; +
            &quot;  \&quot;highlight\&quot;: &#123;&quot; +
            &quot;    \&quot;pre_tags\&quot;: \&quot;&amp;lt;span class=&#39;highLight&#39;&amp;gt;\&quot;, &quot; +
            &quot;    \&quot;post_tags\&quot;: \&quot;&amp;lt;/span&amp;gt;\&quot;, &quot; +
            &quot;    \&quot;fields\&quot;: &#123;&quot; +
            &quot;      \&quot;title\&quot;: &#123;&#125;,&quot; +
            &quot;      \&quot;content\&quot;: &#123;&#125;&quot; +
            &quot;    &#125;&quot; +
            &quot;  &#125;&quot; +
            &quot;&#125;&quot;, text));

    Response response = restHighLevelClient.getLowLevelClient().performRequest(request);

    JSONObject jsonObject = JSONObject.parseObject(EntityUtils.toString(response.getEntity()));

    JSONArray hits = jsonObject.getJSONObject(&quot;hits&quot;).getJSONArray(&quot;hits&quot;);

    List&amp;lt;News&amp;gt; results = new ArrayList&amp;lt;&amp;gt;();

    for (int i = 0; i &amp;lt; hits.size(); i++) &#123;
        News news = new News();
        JSONObject hit = hits.getJSONObject(i);
        JSONObject highLight = hit.getJSONObject(&quot;highlight&quot;);  //获取高亮的数据结果

        JSONObject _source = hit.getJSONObject(&quot;_source&quot;); //这个是原始的数据
        news.setUrl(_source.getString(&quot;url&quot;));  //设置url

        JSONArray highLightTitle = highLight.getJSONArray(&quot;title&quot;);  //获取高亮的 title 数组
        JSONArray highLightContent = highLight.getJSONArray(&quot;content&quot;);

        if(null != highLightTitle) &#123;
            StringBuffer highLightTitleStringBuffer = new StringBuffer();
            for (int j = 0; j &amp;lt; highLightTitle.size(); j++) &#123;
                String titleSegment = highLightTitle.getString(j);
                highLightTitleStringBuffer.append(titleSegment);
            &#125;
            news.setTitle(highLightTitleStringBuffer.toString());
        &#125;else &#123;  // 如果不存在高亮的数据，那么就取原始数据
            news.setTitle(_source.getString(&quot;title&quot;));
        &#125;

        if(null != highLightContent) &#123;
            StringBuffer highLightContentStringBuffer = new StringBuffer();
            for (int j = 0; j &amp;lt; highLightContent.size(); j++) &#123;
                String contentSegment = highLightContent.getString(j);
                highLightContentStringBuffer.append(contentSegment);
            &#125;
            news.setContent(highLightContentStringBuffer.toString());
        &#125;else &#123;  // 如果不存在高亮的数据，那么就取原始数据
            news.setContent(_source.getString(&quot;content&quot;));
        &#125;

        results.add(news);
    &#125;
    return results;
&#125;
</code></pre>
<p>}<br></code></pre> </p>
<h3 id="6、测试"><a href="#6、测试" class="headerlink" title="6、测试"></a>6、测试</h3><blockquote>
<p> 6.1、测试tips,完成对tags的关键字检索<br> <img alt="" height="726" src="https://img-blog.csdnimg.cn/20210704230043938.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="757"><br> 6.2、测试内容检索<br> <img alt="" height="918" src="https://img-blog.csdnimg.cn/20210704230215251.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch之Request Body查询"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/Elasticsearch%E4%B9%8BRequest%20Body%E6%9F%A5%E8%AF%A2/"
    >Elasticsearch之Request Body查询</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/Elasticsearch%E4%B9%8BRequest%20Body%E6%9F%A5%E8%AF%A2/" class="article-date">
  <time datetime="2021-07-18T14:21:56.446Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: Elasticsearch之Request Body查询<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—### 1、term查询简介</p>
<blockquote>
<p> term是表达语义的最小单位，在搜索的时候基本都要使用到term。 term查询的种类有：Term Query、Range Query等。 在ES中，Term查询不会对输入进行分词处理，将输入作为一个整体，在倒排索引中查找准确的词项。 我们也可以使用 Constant Score 将查询转换为一个filter,避免算分，利用缓存，提高查询的效 率。 </p>
</blockquote>
<h3 id="2、term与terms"><a href="#2、term与terms" class="headerlink" title="2、term与terms"></a>2、term与terms</h3><blockquote>
<p> 查询电影名字中包含有 beautiful 这个单词的所有的电影，用于查询的单词不会进行分词的处理<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “term”: {<!-- -->             “title”: {<!-- -->                 “value”: “beautiful”             }         }     } }<br> 查询电影名字中包含有 beautiful 或者 mind 这两个单词的所有的电影，用于查询的单词不会进行 分词的处理<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “terms”: {<!-- -->             “title”: [                 “beautiful”,                 “mind”             ]         }     } } </p>
</blockquote>
<h3 id="3、range"><a href="#3、range" class="headerlink" title="3、range"></a>3、range</h3><blockquote>
<p> 查询上映在2016到2018年的所有的电影，再根据上映时间的倒序进行排序<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “range”: {<!-- -->             “year”: {<!-- -->                 “gte”: 2016,                 “lte”: 2018             }          }     },     “sort”: [         {<!-- -->             “year”: {<!-- -->                 “order”: “desc”             }         }     ] } </p>
</blockquote>
<h3 id="4、Constant-Score"><a href="#4、Constant-Score" class="headerlink" title="4、Constant Score"></a>4、Constant Score</h3><blockquote>
<p> 查询title中包含有beautiful的所有的电影，不进行相关性算分，查询的数据进行缓存，提高效率<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “constant_score”: {<!-- -->             “filter”: {<!-- -->                 “term”: {<!-- -->                     “title”: “beautiful”                 }             }         }     } } </p>
</blockquote>
<h3 id="5、全文查询"><a href="#5、全文查询" class="headerlink" title="5、全文查询"></a>5、全文查询</h3><blockquote>
<p> 全文查询的种类有: Match Query、Match Phrase Query、Query String Query等 索引和搜索的时候都会进行分词，在查询的时候，会对输入进行分词，然后每个词项会逐个到底层进行 查询，将最终的结果进行合并 </p>
</blockquote>
<h3 id="6、match"><a href="#6、match" class="headerlink" title="6、match"></a>6、match</h3><blockquote>
<p> 查询电影名字中包含有beautiful的所有电影，每页十条，取第二页的数据<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “match”: {<!-- -->             “title”: “beautiful”         }     },     “from”: 10,     “size”: 10 }<br> 查询电影名字中包含有 beautiful 或者 mind 的所有的数据，但是只查询title和id两个属性<br> GET movies/_search {<!-- -->     “_source”: [“title”, “id”],         “query”: {<!-- -->             “match”: {<!-- -->                 “title”: “beautiful mind”             }         } } </p>
</blockquote>
<h3 id="7、match-phrase"><a href="#7、match-phrase" class="headerlink" title="7、match_phrase"></a>7、match_phrase</h3><blockquote>
<p> 查询电影名字中包含有 “beautiful mind” 这个短语的所有的数据<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “match_phrase”: {<!-- -->             “title”: “beautiful mind”         }     } }<br> 注意：match_phrase和term区别<br> term是将传入的文本原封不动地（不分词）拿去查询。 match会对输入进行分词处理后再去查询，部分命中的结果也会按照评分由高到低显示出来。 match_phrase是按短语查询，只有存在这个短语的文档才会被显示出来。<br> 也就是说，term和match_phrase都可以用于精确匹配，而match用于模糊匹配。<br> 上面说的也不是很准确：<br> match_phrase总结如下： </p>
</blockquote>
<ul>
<li>match_phrase还是分词后去搜的- 目标文档需要包含分词后的所有词- 目标文档还要保持这些词的相对顺序和文档中的一致</li>
</ul>
<h3 id="8、multi-match"><a href="#8、multi-match" class="headerlink" title="8、multi_match"></a>8、multi_match</h3><blockquote>
<p> 查询 title 或 genre 中包含有 beautiful 或者 Adventure 的所有的数据<br> GET movies/_search     {<!-- -->     “query”: {<!-- -->         “multi_match”: {<!-- -->             “query”: “beautiful Adventure”,             “fields”: [“title”, “genre”]         }     } }   </p>
</blockquote>
<h3 id="9、match-all"><a href="#9、match-all" class="headerlink" title="9、match_all"></a>9、match_all</h3><blockquote>
<p> 查询所有的数据<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “match_all”: {}     } } </p>
</blockquote>
<h3 id="10、query-string"><a href="#10、query-string" class="headerlink" title="10、query_string"></a>10、query_string</h3><blockquote>
<p> 查询 title 中包含有 beautiful 和 mind 的所有的电影<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “query_string”: {<!-- -->             “default_field”: “title”,             “query”: “mind AND beautiful”         }     } } 或者<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “query_string”: {<!-- -->             “default_field”: “title”,             “query”: “mind beautiful”,             “default_operator”: “AND”         }     } }   </p>
</blockquote>
<h3 id="11、simple-query-string"><a href="#11、simple-query-string" class="headerlink" title="11、simple_query_string"></a>11、simple_query_string</h3><blockquote>
<p> simple_query_string 覆盖了很多其他查询的用法。<br> 查询 title 中包含有 beautiful 和 mind 的所有的电影<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “simple_query_string”: {<!-- -->             “query”: “beautiful + mind”,             “fields”: [“title”]         }     } }<br> 或者<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “simple_query_string”: {<!-- -->             “query”: “beautiful mind”,             “fields”: [“title”],             “default_operator”: “AND”         }     } }<br> 查询title中包含 “beautiful mind” 这个短语的所有的电影 (用法和match_phrase类似)<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “simple_query_string”: {<!-- -->             “query”: “&quot;beautiful mind&quot;“,             “fields”: [“title”]         }     } }<br> 查询title或genre中包含有 beautiful mind romance 这个三个单词的所有的电影 （与multi_match类似）<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “simple_query_string”: {<!-- -->             “query”: “beautiful mind Romance”,             “fields”: [“title”, “genre”]         }     } }<br> 查询title中包含 “beautiful mind” 或者 “Modern Romance” 这两个短语的所有的电影<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “simple_query_string”: {<!-- -->             “query”: “&quot;beautiful mind&quot; | &quot;Modern Romance&quot;“,             “fields”: [“title”]         }     } }<br> 查询title或者genre中包含有 beautiful + mind 这个两个词，或者Comedy + Romance + Musical + Drama + Children 这个五个词的所有的数据<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “simple_query_string”: {<!-- -->             “query”: “(beautiful + mind) | (Comedy + Romance + Musical + Drama + Children)”,             “fields”: [“title”,”genre”]         }     } }<br> 查询 title 中包含 beautiful 和 people 但是不包含 Animals 的所有的数据<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “simple_query_string”: {<!-- -->             “query”: “beautiful + people + -Animals”,             “fields”: [“title”]         }     } } </p>
</blockquote>
<h3 id="12、模糊搜索"><a href="#12、模糊搜索" class="headerlink" title="12、模糊搜索"></a>12、模糊搜索</h3><blockquote>
<p> 查询title中从第6个字母开始只要最多纠正一次，就与 neverendign 匹配的所有的数据<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “fuzzy”: {<!-- -->             “title”: {<!-- -->                 “value”: “neverendign”,                 “fuzziness”: 1,                 “prefix_length”: 5             }         }     } } </p>
</blockquote>
<h3 id="13、多条件查询"><a href="#13、多条件查询" class="headerlink" title="13、多条件查询"></a>13、多条件查询</h3><blockquote>
<p> 查询title中包含有beautiful或者mind单词，并且上映时间在2016<del>1018年的所有的电影<br> GET movies/_search {<!-- -->     “query”: {<!-- -->         “bool”: {<!-- -->             “must”: [                 {<!-- -->                     “simple_query_string”: {<!-- -->                         “query”: “beautiful mind”,                         “fields”: [“title”]                     }                 },                 {<!-- -->                     “range”: {<!-- -->                         “year”: {<!-- -->                             “gte”: 2016,                             “lte”: 2018                         }                     }                 }             ]         }     } }<br> 查询 title 中包含有 beautiful 这个单词，并且上映年份在2016</del>2018年间的所有电影，但是不 进行相关性的算分 </p>
</blockquote>
<h1 id="filter不会进行相关性的算分，并且会将查出来的结果进行缓存，效率上比-query-高-GET-movies-search-“query”-“bool”-“filter”-“term”-“title”-“beautiful”-“range”-“year”-“gte”-2016-“lte”-2018"><a href="#filter不会进行相关性的算分，并且会将查出来的结果进行缓存，效率上比-query-高-GET-movies-search-“query”-“bool”-“filter”-“term”-“title”-“beautiful”-“range”-“year”-“gte”-2016-“lte”-2018" class="headerlink" title="filter不会进行相关性的算分，并且会将查出来的结果进行缓存，效率上比 query 高 GET movies/_search {     “query”: {         “bool”: {             “filter”: [                 {                     “term”: {                         “title”: “beautiful”                     }                 },                 {                     “range”: {                         “year”: {                             “gte”: 2016,                             “lte”: 2018                         }                     }                 }             ]         }     } }"></a>filter不会进行相关性的算分，并且会将查出来的结果进行缓存，效率上比 query 高 GET movies/_search {<!-- -->     “query”: {<!-- -->         “bool”: {<!-- -->             “filter”: [                 {<!-- -->                     “term”: {<!-- -->                         “title”: “beautiful”                     }                 },                 {<!-- -->                     “range”: {<!-- -->                         “year”: {<!-- -->                             “gte”: 2016,                             “lte”: 2018                         }                     }                 }             ]         }     } }</h1><h3 id="14、Mapping"><a href="#14、Mapping" class="headerlink" title="14、Mapping"></a>14、Mapping</h3><blockquote>
<p> mapping类似于数据库中的schema，作用如下:<br>         1. 定义索引中的字段类型；<br>         2. 定义字段的数据类型，例如：布尔、字符串、数字、日期…..<br>         3. 字段倒排索引的设置<br> 数据类型<img alt="" height="315" src="https://img-blog.csdnimg.cn/20210703130327728.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="753"><br> Mapping的定义语法如下：<br> PUT users {<!-- -->     “mappings”: {<!-- -->         // define your mappings here     } }<br> 定义mapping的建议方式: 写入一个样本文档到临时索引中，ES会自动生成mapping信息，通过访问 mapping信息的api查询mapping的定义，修改自动生成的mapping成为我们需要方式，创建索引，删 除临时索引，简而言之就是 “卸磨杀驴” 。 </p>
</blockquote>
<h3 id="15、常见参数"><a href="#15、常见参数" class="headerlink" title="15、常见参数"></a>15、常见参数</h3><blockquote>
<p> 1）index<br>       可以给属性添加一个 布尔类型的index属性，标识该属性是否能被倒排索引，也就是说是否能通过 该字段进行搜索。<br> 2) null_value<br> 在数据索引进ES的时候，当某些数据为 null 的时候，该数据是不能被搜索的，可以使用 null_value 属性指定一个值，当属性的值为 null 的时候，转换为一个通过 null_value 指 定的值。 null_value属性只能用于Keyword类型的属性 </p>
</blockquote>
<h3 id="16、聚合查询"><a href="#16、聚合查询" class="headerlink" title="16、聚合查询"></a>16、聚合查询</h3><blockquote>
<p> 1）聚合搜索的语法格式如下：<br> GET indexName/_search {<!-- -->     “aggs”: {<!-- -->         “aggs_name”: { #聚合分析的名字是由用户自定义的             “aggs_type”: {<!-- -->                 // aggregation body             }         }     } } 2）给users索引创建mapping信息<br> <img alt="" height="507" src="https://img-blog.csdnimg.cn/20210703165950461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="406"><br> 3）往 users 索引中写入数据<br> <pre><code class="language-html">PUT employee/_bulk<br>&#123;"index": &#123;"_id": 1&#125;&#125;<br>&#123;"id": 1, "name": "Bob", "job": "java", "age": 21, "sal": 8000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 2&#125;&#125;<br>&#123;"id": 2, "name": "Rod", "job": "html", "age": 31, "sal": 18000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 3&#125;&#125;<br>&#123;"id": 3, "name": "Gaving", "job": "java", "age": 24, "sal": 12000, "gender": "male"&#125;<br>&#123;"index": &#123;"_id": 4&#125;&#125;<br>&#123;"id": 4, "name": "King", "job": "dba", "age": 26, "sal": 15000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 5&#125;&#125;<br>&#123;"id": 5, "name": "Jonhson", "job": "dba", "age": 29, "sal": 16000, "gender": "male"&#125;<br>&#123;"index": &#123;"_id": 6&#125;&#125;<br>&#123;"id": 6, "name": "Douge", "job": "java", "age": 41, "sal": 20000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 7&#125;&#125;<br>&#123;"id": 7, "name": "cutting", "job": "dba", "age": 27, "sal": 7000, "gender": "male"&#125;<br>&#123;"index": &#123;"_id": 8&#125;&#125;<br>&#123;"id": 8, "name": "Bona", "job": "html", "age": 22, "sal": 14000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 9&#125;&#125;<br>&#123;"id": 9, "name": "Shyon", "job": "dba", "age": 20, "sal": 19000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 10&#125;&#125;<br>&#123;"id": 10, "name": "James", "job": "html", "age": 18, "sal": 22000, "gender": "male"&#125;<br>&#123;"index": &#123;"_id": 11&#125;&#125;<br>&#123;"id": 11, "name": "Golsling", "job": "java", "age": 32, "sal": 23000, "gender":<br>"female"&#125;<br>&#123;"index": &#123;"_id": 12&#125;&#125;<br>&#123;"id": 12, "name": "Lily", "job": "java", "age": 24, "sal": 2000, "gender": "male"&#125;<br>&#123;"index": &#123;"_id": 13&#125;&#125;<br>&#123;"id": 13, "name": "Jack", "job": "html", "age": 23, "sal": 3000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 14&#125;&#125;<br>&#123;"id": 14, "name": "Rose", "job": "java", "age": 36, "sal": 6000, "gender": "female"&#125;<br>&#123;"index": &#123;"_id": 15&#125;&#125;<br>&#123;"id": 15, "name": "Will", "job": "dba", "age": 38, "sal": 4500, "gender": "male"&#125;<br>&#123;"index": &#123;"_id": 16&#125;&#125;<br>&#123;"id": 16, "name": "smith", "job": "java", "age": 32, "sal": 23000, "gender": "male"&#125;</code></pre><br> 4）单值的输出，ES中大多数的数学计算只输出一个值，如：min、max、sum、avg、cardinalit<br>     4.1）查询工资的总和<br>           <img alt="" height="254" src="https://img-blog.csdnimg.cn/20210703170233150.png" width="292"><br>     4.2）查询员工的平均工资<br>           <img alt="" height="257" src="https://img-blog.csdnimg.cn/20210703170322424.png" width="290"><br>     4.3）查询总共有多少个岗位, cardinality的值类似于sql中的 count distinct,即去重统计总数<br>            <img alt="" height="264" src="https://img-blog.csdnimg.cn/20210703170347326.png" width="298"><br>     4.4）查询航班票价的最高值、平均值、最低值<br>            <img alt="" height="483" src="https://img-blog.csdnimg.cn/20210703170430932.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="447"><br> 5）多值的输出,ES还有些函数，可以一次性输出很多个统计的数据: terms、stats<br>      5.1）查询工资的信息<br>             <img alt="" height="250" src="https://img-blog.csdnimg.cn/20210703170608578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="316"><br>      5.2）查询到达不同城市的航班数量<br>             <img alt="" height="260" src="https://img-blog.csdnimg.cn/20210703170635852.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="368"><br>      5.3）查询每个岗位有多少人<br>             <img alt="" height="260" src="https://img-blog.csdnimg.cn/20210703170720626.png" width="279"><br>      5.4）查询目标地的航班次数以及天气信息<br>             <img alt="" height="417" src="https://img-blog.csdnimg.cn/20210703170751309.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="427"><br>      5.5）查询每个岗位下工资的信息(平均工资、最高工资、最少工资等)<br>             <img alt="" height="542" src="https://img-blog.csdnimg.cn/20210703170929821.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="493"><br>      5.6）查询不同工种的男女员工数量、然后统计不同工种下男女员工的工资信息<br>               <img alt="" height="572" src="https://img-blog.csdnimg.cn/20210703171012471.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="408"><br>      5.7）查询年龄最大的两位员工的信息<br>           <img alt="" height="543" src="https://img-blog.csdnimg.cn/20210703171105176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="382"><br>      5.8）查询不同区间员工工资的统计信息<br>           <img alt="" height="645" src="https://img-blog.csdnimg.cn/2021070317114435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="442"><br>     5.9）以直方图的方式以每5000元为一个区间查看工资信息<br>          <img alt="" height="431" src="https://img-blog.csdnimg.cn/20210703171304558.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="553"><br>     5.10）查询平均工资最低的工种<br>          <img alt="" height="525" src="https://img-blog.csdnimg.cn/20210703171412288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="490"><br>     5.11）求工资和工种的信息<br>          <img alt="" height="375" src="https://img-blog.csdnimg.cn/20210703171444218.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="351"><br>     5.12）查询年龄大于30岁的员工的平均工资<br>        <img alt="" height="423" src="https://img-blog.csdnimg.cn/20210703171518293.png" width="282"><br>     5.13）查询Java员工的平均工资<br>          <img alt="" height="488" src="https://img-blog.csdnimg.cn/20210703171556873.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="303"><br>     5.14）求30岁以上的员工的平均工资和所有员工的平均工资<br>        <img alt="" height="757" src="https://img-blog.csdnimg.cn/20210703171629367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="367"> </p>
</blockquote>
<h3 id="17、推荐搜索"><a href="#17、推荐搜索" class="headerlink" title="17、推荐搜索"></a>17、推荐搜索</h3><blockquote>
<p> 在搜索过程中，因为单词的拼写错误，没有得到任何的结果，希望ES能够给我们一个推荐搜索。<br> <img alt="" height="456" src="https://img-blog.csdnimg.cn/20210703175229434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="596"> </p>
</blockquote>
<h3 id="18、自动补全"><a href="#18、自动补全" class="headerlink" title="18、自动补全"></a>18、自动补全</h3><blockquote>
<p> 自动补全应该是我们在日常的开发过程中最常见的搜索方式了，如百度搜索和京东商品搜索。<br> <img alt="" height="382" src="https://img-blog.csdnimg.cn/20210703175338116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="750"><br> <img alt="" height="671" src="https://img-blog.csdnimg.cn/20210703175400630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="753"><br> 定义mapping：<br> <img alt="" height="824" src="https://img-blog.csdnimg.cn/20210703175531835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="519"><br> <img alt="" height="314" src="https://img-blog.csdnimg.cn/20210703175551768.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="462"><br> 前缀搜索<br> <img alt="" height="330" src="https://img-blog.csdnimg.cn/20210703175642732.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="366"><br> <img alt="" height="804" src="https://img-blog.csdnimg.cn/20210703175715675.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
<h3 id="19、高亮显示"><a href="#19、高亮显示" class="headerlink" title="19、高亮显示"></a>19、高亮显示</h3><blockquote>
<p> 高亮显示在实际的应用中也会碰到很多，如下给出了百度和极客时间的两个高亮搜索的案例：<br> <img alt="" height="825" src="https://img-blog.csdnimg.cn/20210703180705816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="925"><br> <img alt="" height="657" src="https://img-blog.csdnimg.cn/2021070318072243.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="960"><br> 将所有的包含有 beautiful 的单词高亮显示<br> <img alt="" height="631" src="https://img-blog.csdnimg.cn/20210703180807646.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="551"><br> <img alt="" height="636" src="https://img-blog.csdnimg.cn/20210703180825496.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch之JAVA API操作"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/Elasticsearch%E4%B9%8BJAVA%20API%E6%93%8D%E4%BD%9C/"
    >Elasticsearch之JAVA API操作</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/Elasticsearch%E4%B9%8BJAVA%20API%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2021-07-18T14:21:56.444Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: Elasticsearch之JAVA API操作<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—### 1、JavaAPI-环境准备</p>
<blockquote>
<p> 1.1、创建一个springboot项目<br>       <img alt="" height="300" src="https://img-blog.csdnimg.cn/2021062012261018.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="477">      pom的依赖如下：<br> <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;project xmlns="<a target="_blank" rel="noopener" href="http://maven.apache.org/POM/4.0.0&quot;">http://maven.apache.org/POM/4.0.0&quot;</a><br>         xmlns:xsi="<a target="_blank" rel="noopener" href="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</a><br>         xsi:schemaLocation="<a target="_blank" rel="noopener" href="http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</a> <a target="_blank" rel="noopener" href="http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;">http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</a>&gt;<br>    &lt;parent&gt;<br>        &lt;artifactId&gt;kgf-java-learning&lt;/artifactId&gt;<br>        &lt;groupId&gt;com.kgf.learning&lt;/groupId&gt;<br>        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br>        &lt;relativePath&gt;../kgf-java-learning/pom.xml&lt;/relativePath&gt;<br>    &lt;/parent&gt;<br>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</p>
</blockquote>
<pre><code>&amp;lt;groupId&amp;gt;com.kgf.es7.8&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;kgf-es7.8-api&amp;lt;/artifactId&amp;gt;
&amp;lt;properties&amp;gt;
    &amp;lt;!--自定义elasticsearch版本--&amp;gt;
    &amp;lt;elasticsearch.version&amp;gt;7.8.0&amp;lt;/elasticsearch.version&amp;gt;
    &amp;lt;lombok.version&amp;gt;1.18.16&amp;lt;/lombok.version&amp;gt;
    &amp;lt;fastjson.version&amp;gt;1.2.75&amp;lt;/fastjson.version&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;dependencies&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;com.alibaba&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;fastjson&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;$&#123;fastjson.version&#125;&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;!--引入lombok依赖--&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;$&#123;lombok.version&#125;&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-boot-starter-data-elasticsearch&amp;lt;/artifactId&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;!--引入Juntil单元测试 --&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-boot-starter-test&amp;lt;/artifactId&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-boot-configuration-processor&amp;lt;/artifactId&amp;gt;
        &amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-boot-starter-thymeleaf&amp;lt;/artifactId&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;!--jsoup解析网页，tiks解析视频音乐--&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.jsoup&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;jsoup&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;1.10.2&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&amp;lt;build&amp;gt;
    &amp;lt;plugins&amp;gt;
        &amp;lt;plugin&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-maven-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;2.2.11.RELEASE&amp;lt;/version&amp;gt;
        &amp;lt;/plugin&amp;gt;
        &amp;lt;plugin&amp;gt;
            &amp;lt;artifactId&amp;gt;maven-compiler-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;configuration&amp;gt;
                &amp;lt;source&amp;gt;1.8&amp;lt;/source&amp;gt;
                &amp;lt;target&amp;gt;1.8&amp;lt;/target&amp;gt;
            &amp;lt;/configuration&amp;gt;
        &amp;lt;/plugin&amp;gt;
    &amp;lt;/plugins&amp;gt;
&amp;lt;/build&amp;gt;
</code></pre>
<p>&lt;/project&gt;</code></pre><br> <pre><code>ElasticConfig.java如下：</code></pre><br> <pre><code class="language-java">package com.kgf.es.config;</p>
<p>import org.apache.http.HttpHost;<br>import org.elasticsearch.client.RestClient;<br>import org.elasticsearch.client.RestHighLevelClient;<br>import org.springframework.context.annotation.Bean;<br>import org.springframework.context.annotation.Configuration;</p>
<p>@Configuration<br>public class ElasticConfig &#123;</p>
<pre><code>@Bean
public RestHighLevelClient restHighLevelClient()&#123;
    RestHighLevelClient client = new RestHighLevelClient(
            RestClient.builder(new HttpHost(&quot;127.0.0.1&quot;, 9200, &quot;http&quot;))
    );
    return client;
&#125;
</code></pre>
<p>}<br></code></pre><br> 1.2、ESApplication.java如下<br> <pre><code class="language-java">package com.kgf.es;</p>
<p>import org.springframework.boot.SpringApplication;<br>import org.springframework.boot.autoconfigure.SpringBootApplication;</p>
<p>@SpringBootApplication<br>public class ESApplication &#123;</p>
<pre><code>public static void main(String[] args) &#123;

    SpringApplication.run(ESApplication.class,args);

&#125;
</code></pre>
<p>}<br></code></pre> 
   </p>
<h3 id="2、JavaAPI-索引-创建"><a href="#2、JavaAPI-索引-创建" class="headerlink" title="2、JavaAPI-索引-创建"></a>2、JavaAPI-索引-创建</h3><blockquote>
<p> 2.1、在一个Junit测试类创建索引<br> <pre><code class="language-java">package es7;</p>
</blockquote>
<p>import com.kgf.es.ESApplication;<br>import org.elasticsearch.client.RequestOptions;<br>import org.elasticsearch.client.RestHighLevelClient;<br>import org.elasticsearch.client.indices.CreateIndexRequest;<br>import org.elasticsearch.client.indices.CreateIndexResponse;<br>import org.junit.Test;<br>import org.junit.runner.RunWith;<br>import org.springframework.boot.test.context.SpringBootTest;<br>import org.springframework.test.context.junit4.SpringRunner;</p>
<p>import javax.annotation.Resource;<br>import java.io.IOException;</p>
<p>@RunWith(SpringRunner.class)<br>@SpringBootTest(classes = ESApplication.class,webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)<br>public class EsApplicationTest &#123;</p>
<pre><code>@Resource
private RestHighLevelClient restHighLevelClient;

/***
 * 创建索引
 */
@Test
public void createIndexTest()&#123;
    try &#123;
        //创建索引对象
        CreateIndexRequest indexRequest = new CreateIndexRequest(&quot;user&quot;);
        //客户端执行请求
        CreateIndexResponse response = restHighLevelClient.indices().create(indexRequest, RequestOptions.DEFAULT);

        boolean acknowledged = response.isAcknowledged();
        // 响应状态
        System.out.println(&quot;操作状态 = &quot; + acknowledged);
    &#125; catch (IOException e) &#123;
        e.printStackTrace();
    &#125;
&#125;
</code></pre>
<p>}<br></code></pre><br> 执行：<br> <img alt="" height="245" src="https://img-blog.csdnimg.cn/20210620123925330.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="724"><br> 查看索引：<br> <img alt="" height="503" src="https://img-blog.csdnimg.cn/20210620124000441.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1100"> </p>
<h3 id="3、索引-查询-amp-删除"><a href="#3、索引-查询-amp-删除" class="headerlink" title="3、索引-查询 &amp; 删除"></a>3、索引-查询 &amp; 删除</h3><blockquote>
<p> <strong>3.1、查询</strong><br> <pre><code class="language-java">   /***<br>     * 查询索引<br>     */<br>    @Test<br>    public void getIndexTest()&#123;<br>        try &#123;<br>            // 查询索引 - 请求对象<br>            GetIndexRequest request = new GetIndexRequest("user");<br>            // 发送请求，获取响应<br>            GetIndexResponse response = restHighLevelClient.indices().get(request,<br>                    RequestOptions.DEFAULT);</p>
</blockquote>
<pre><code>        System.out.println(&quot;aliases:&quot;+response.getAliases());
        System.out.println(&quot;mappings:&quot;+response.getMappings());
        System.out.println(&quot;settings:&quot;+response.getSettings());
    &#125; catch (IOException e) &#123;
        e.printStackTrace();
    &#125;
&#125;&lt;/code&gt;&lt;/pre&gt; 
</code></pre>
<p> 后台打印：<br> <pre><code class="language-java">aliases:&#123;user=[]&#125;<br>mappings:&#123;user=org.elasticsearch.cluster.metadata.MappingMetadata@872c984c&#125;<br>settings:&#123;user=&#123;"index.creation_date":"1624163950299","index.number_of_replicas":"1","index.number_of_shards":"1","index.provided_name":"user","index.uuid":"XvPUSw3rR7CjmrGk0BtdCw","index.version.created":"7080099"&#125;&#125;<br></code></pre><br> <strong>3.2、删除</strong><br> <pre><code class="language-java"> /***<br>     * 删除索引<br>     */<br>    @Test<br>    public void DelIndexTest()&#123;<br>        try &#123;<br>            // 删除索引 - 请求对象<br>            DeleteIndexRequest request = new DeleteIndexRequest("user");<br>            // 发送请求，获取响应<br>            AcknowledgedResponse response = restHighLevelClient.indices().delete(request,RequestOptions.DEFAULT);<br>            // 操作结果<br>            System.out.println("操作结果 ： " + response.isAcknowledged());<br>        &#125; catch (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;</code></pre><br> 后台打印：<br> <pre><code>操作结果 ： true<br></code></pre> 
   </p>
<h3 id="4、JavaAPI-文档-新增-amp-修改"><a href="#4、JavaAPI-文档-新增-amp-修改" class="headerlink" title="4、JavaAPI-文档-新增 &amp; 修改"></a>4、JavaAPI-文档-新增 &amp; 修改</h3><blockquote>
<p> <strong>4.1、新增</strong><br> <pre><code class="language-java">/***<br>     * 添加文档<br>     */<br>    @Test<br>    public void addDocumentTest()&#123;<br>        try &#123;<br>            // 新增文档 - 请求对象<br>            IndexRequest request = new IndexRequest();<br>            // 设置索引及唯一性标识<br>            request.index("user").id("1001");</p>
</blockquote>
<pre><code>        // 创建数据对象
        User user = new User();
        user.setName(&quot;zhangsan&quot;);
        user.setAge(30);
        user.setSex(&quot;男&quot;);

        ObjectMapper objectMapper = new ObjectMapper();
        String productJson = objectMapper.writeValueAsString(user);
        // 添加文档数据，数据格式为 JSON 格式
        request.source(productJson, XContentType.JSON);
        // 客户端发送请求，获取响应对象
        IndexResponse response = restHighLevelClient.index(request, RequestOptions.DEFAULT);
        //打印结果信息
        System.out.println(&quot;_index:&quot; + response.getIndex());
        System.out.println(&quot;_id:&quot; + response.getId());
        System.out.println(&quot;_result:&quot; + response.getResult());
    &#125; catch (IOException e) &#123;
        e.printStackTrace();
    &#125;
&#125;&lt;/code&gt;&lt;/pre&gt; 
</code></pre>
<p> 后台打印：<br> <img alt="" height="210" src="https://img-blog.csdnimg.cn/20210620172914512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="668"><br> <strong>4.2、修改</strong><br> <pre><code class="language-java">/***<br>     * 修改文档信息<br>     */<br>    @Test<br>    public void updateDocument()&#123;<br>        try &#123;<br>            // 修改文档 - 请求对象<br>            UpdateRequest request = new UpdateRequest();<br>            // 配置修改参数<br>            request.index("user").id("1001");<br>            // 设置请求体，对数据进行修改<br>            request.doc(XContentType.JSON, "sex", "女");<br>            // 客户端发送请求，获取响应对象<br>            UpdateResponse response = restHighLevelClient.update(request, RequestOptions.DEFAULT);<br>            System.out.println("_index:" + response.getIndex());<br>            System.out.println("_id:" + response.getId());<br>            System.out.println("_result:" + response.getResult());<br>        &#125; catch (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;</code></pre><br> 后台打印：<br> <img alt="" height="188" src="https://img-blog.csdnimg.cn/20210620173126639.png" width="699"> </p>
<h3 id="5、文档-查询-amp-删除"><a href="#5、文档-查询-amp-删除" class="headerlink" title="5、文档-查询 &amp; 删除"></a>5、文档-查询 &amp; 删除</h3><blockquote>
<p> <strong>5.1、查询文档</strong><br> <pre><code class="language-java"> /***<br>     * 查询文档信息<br>     */<br>    @Test<br>    public void queryDocument()&#123;<br>        try &#123;<br>            //1.创建请求对象<br>            GetRequest request = new GetRequest().index("user").id("1001");<br>            //2.客户端发送请求，获取响应对象<br>            GetResponse response = restHighLevelClient.get(request, RequestOptions.DEFAULT);<br>            //打印结果信息<br>            System.out.println("_index:" + response.getIndex());<br>            System.out.println("_type:" + response.getType());<br>            System.out.println("_id:" + response.getId());<br>            System.out.println("source:" + response.getSourceAsString());<br>        &#125; catch (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;</code></pre><br> 后台打印：<br> <pre><code class="language-java">_index:user<br>_type:_doc<br>_id:1001<br>source:&#123;"name":"zhangsan","age":30,"sex":"男"&#125;</p>
</blockquote>
<p>Process finished with exit code 0<br></code></pre><br> <strong>5.2、删除</strong><br> <pre><code class="language-java"> /***<br>     * 删除文档操作<br>     * @throws IOException<br>     */<br>    @Test<br>    public void delDocumentTest() throws IOException &#123;<br>        //创建请求对象<br>        DeleteRequest request = new DeleteRequest().index("user").id("1001");<br>        //客户端发送请求，获取响应对象<br>        DeleteResponse response = restHighLevelClient.delete(request, RequestOptions.DEFAULT);<br>        //打印信息<br>        System.out.println(response.toString());<br>    &#125;</code></pre><br> 后台打印：<br> <pre><code class="language-java">DeleteResponse[index=user,type=_doc,id=1001,version=16,result=deleted,shards=ShardInfo&#123;total=2, successful=1, failures=[]&#125;]</p>
<p>Process finished with exit code 0<br></code></pre> 
   </p>
<h3 id="6、文档-批量新增-amp-批量删除"><a href="#6、文档-批量新增-amp-批量删除" class="headerlink" title="6、文档-批量新增 &amp; 批量删除"></a>6、文档-批量新增 &amp; 批量删除</h3><blockquote>
<p> <strong>6.1、批量新增</strong><br> <pre><code class="language-java"> /***<br>     * 测试批量插入操作<br>     * @throws IOException<br>     */<br>    @Test<br>    public void bulkInsertRequestTest() throws IOException &#123;<br>        //创建批量新增请求对象<br>        BulkRequest request = new BulkRequest();<br>        request.add(new<br>                IndexRequest().index("user").id("1001").source(XContentType.JSON, "name",<br>                "zhangsan"));<br>        request.add(new<br>                IndexRequest().index("user").id("1002").source(XContentType.JSON, "name",<br>                "lisi"));<br>        request.add(new<br>                IndexRequest().index("user").id("1003").source(XContentType.JSON, "name",<br>                "wangwu"));<br>        //客户端发送请求，获取响应对象<br>        BulkResponse responses = restHighLevelClient.bulk(request, RequestOptions.DEFAULT);<br>        //打印结果信息<br>        System.out.println("took:" + responses.getTook());<br>        System.out.println("items:" + responses.getItems());<br>    &#125;</code></pre><br> 后台打印<br> <pre><code class="language-java">took:294ms<br>items:[Lorg.elasticsearch.action.bulk.BulkItemResponse;@2beee7ff</p>
</blockquote>
<p>Process finished with exit code 0<br></code></pre><br> <strong>6.2、批量删除</strong><br> <pre><code class="language-java">  /***<br>     * 测试批量插入操作<br>     * @throws IOException<br>     */<br>    @Test<br>    public void bulkDeleteRequestTest() throws IOException &#123;<br>        //创建批量删除请求对象<br>        BulkRequest request = new BulkRequest();<br>        request.add(new DeleteRequest().index("user").id("1001"));<br>        request.add(new DeleteRequest().index("user").id("1002"));<br>        request.add(new DeleteRequest().index("user").id("1003"));<br>        //客户端发送请求，获取响应对象<br>        BulkResponse responses = restHighLevelClient.bulk(request, RequestOptions.DEFAULT);<br>        //打印结果信息<br>        System.out.println("took:" + responses.getTook());<br>        System.out.println("items:" + responses.getItems());<br>    &#125;</code></pre><br> 后台打印<br> <pre><code class="language-java">took:108ms<br>items:[Lorg.elasticsearch.action.bulk.BulkItemResponse;@7b02881e</p>
<p>Process finished with exit code 0</p>
<p></code></pre> 
   </p>
<h3 id="7、文档-高级查询-全量查询"><a href="#7、文档-高级查询-全量查询" class="headerlink" title="7、文档-高级查询-全量查询"></a>7、文档-高级查询-全量查询</h3><blockquote>
<p> 7.1、先批量增加数据<br> <pre><code class="language-java"> /***<br>     * 测试批量插入操作<br>     * @throws IOException<br>     */<br>    @Test<br>    public void bulkInsertRequestTest() throws IOException &#123;<br>        //创建批量新增请求对象<br>        BulkRequest request = new BulkRequest();<br>        request.add(new IndexRequest().index("user").id("1001").source(XContentType.JSON, "name", "zhangsan", "age", "10", "sex","女"));<br>        request.add(new IndexRequest().index("user").id("1002").source(XContentType.JSON, "name", "lisi", "age", "30", "sex","女"));<br>        request.add(new IndexRequest().index("user").id("1003").source(XContentType.JSON, "name", "wangwu1", "age", "40", "sex","男"));<br>        request.add(new IndexRequest().index("user").id("1004").source(XContentType.JSON, "name", "wangwu2", "age", "20", "sex","女"));<br>        request.add(new IndexRequest().index("user").id("1005").source(XContentType.JSON, "name", "wangwu3", "age", "50", "sex","男"));<br>        request.add(new IndexRequest().index("user").id("1006").source(XContentType.JSON, "name", "wangwu4", "age", "20", "sex","男"));<br>        //客户端发送请求，获取响应对象<br>        BulkResponse responses = restHighLevelClient.bulk(request, RequestOptions.DEFAULT);<br>        //打印结果信息<br>        System.out.println("took:" + responses.getTook());<br>        System.out.println("items:" + responses.getItems());<br>    &#125;</code></pre><br> 后台打印<br> <pre><code class="language-java">took:168ms<br>items:[Lorg.elasticsearch.action.bulk.BulkItemResponse;@2beee7ff</p>
</blockquote>
<p>Process finished with exit code 0<br></code></pre><br> <strong>查询所有索引数据</strong><br> <pre><code class="language-java">/***<br>     * 查询所有索引数据<br>     * @throws IOException<br>     */<br>    @Test<br>    public void searchRequestTest() throws IOException &#123;<br>        // 创建搜索请求对象<br>        SearchRequest request = new SearchRequest();<br>        request.indices("user");<br>        // 构建查询的请求体<br>        SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();<br>        // 查询所有数据<br>        sourceBuilder.query(QueryBuilders.matchAllQuery());<br>        request.source(sourceBuilder);<br>        SearchResponse response = restHighLevelClient.search(request, RequestOptions.DEFAULT);<br>        // 查询匹配<br>        SearchHits hits = response.getHits();<br>        System.out.println("took:" + response.getTook());<br>        System.out.println("timeout:" + response.isTimedOut());<br>        System.out.println("total:" + hits.getTotalHits());<br>        System.out.println("MaxScore:" + hits.getMaxScore());<br>        System.out.println("hits========&gt;&gt;");<br>        for (SearchHit hit : hits) &#123;<br>            //输出每条查询的结果信息<br>            System.out.println(hit.getSourceAsString());<br>        &#125;<br>        System.out.println("&lt;&lt;========");<br>    &#125;</code></pre><br> 后台打印<br> <pre><code class="language-java">took:2ms<br>timeout:false<br>total:6 hits<br>MaxScore:1.0<br>hits========&gt;&gt;<br>&#123;"name":"zhangsan","age":"10","sex":"女"&#125;<br>&#123;"name":"lisi","age":"30","sex":"女"&#125;<br>&#123;"name":"wangwu1","age":"40","sex":"男"&#125;<br>&#123;"name":"wangwu2","age":"20","sex":"女"&#125;<br>&#123;"name":"wangwu3","age":"50","sex":"男"&#125;<br>&#123;"name":"wangwu4","age":"20","sex":"男"&#125;<br>&lt;&lt;========</p>
<p>Process finished with exit code 0<br></code></pre> 
   </p>
<h3 id="8、文档-高级查询-分页查询-amp-条件查询-amp-查询排序"><a href="#8、文档-高级查询-分页查询-amp-条件查询-amp-查询排序" class="headerlink" title="8、文档-高级查询-分页查询 &amp; 条件查询 &amp; 查询排序"></a>8、文档-高级查询-分页查询 &amp; 条件查询 &amp; 查询排序</h3><blockquote>
<p> <strong>8.1、条件查询</strong><br> <pre><code class="language-java"> /***<br>     * 条件查询<br>     * @throws IOException<br>     */<br>    @Test<br>    public void queryByConditiontest() throws IOException &#123;<br>        // 创建搜索请求对象<br>        SearchRequest request = new SearchRequest();<br>        request.indices("user");<br>        // 构建查询的请求体<br>        SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();<br>        sourceBuilder.query(QueryBuilders.termQuery("age", "30"));<br>        request.source(sourceBuilder);<br>        SearchResponse response = restHighLevelClient.search(request, RequestOptions.DEFAULT);<br>        // 查询匹配<br>        SearchHits hits = response.getHits();<br>        System.out.println("took:" + response.getTook());<br>        System.out.println("timeout:" + response.isTimedOut());<br>        System.out.println("total:" + hits.getTotalHits());<br>        System.out.println("MaxScore:" + hits.getMaxScore());<br>        System.out.println("hits========&gt;&gt;");<br>        for (SearchHit hit : hits) &#123;<br>            //输出每条查询的结果信息<br>            System.out.println(hit.getSourceAsString());<br>        &#125;<br>        System.out.println("&lt;&lt;========");<br>    &#125;</code></pre><br> 后台打印<br> <pre><code class="language-java">took:1ms<br>timeout:false<br>total:1 hits<br>MaxScore:1.0<br>hits========&gt;&gt;<br>&#123;"name":"lisi","age":"30","sex":"女"&#125;<br>&lt;&lt;========<br></code></pre><br> <strong>8.2、分页查询</strong> </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/***</span><br><span class="line">     * 条件查询</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void queryByPagetest() throws IOException &#123;</span><br><span class="line">        // 创建搜索请求对象</span><br><span class="line">        SearchRequest request = new SearchRequest();</span><br><span class="line">        request.indices(&quot;user&quot;);</span><br><span class="line">        // 构建查询的请求体</span><br><span class="line">        SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();</span><br><span class="line">        sourceBuilder.query(QueryBuilders.matchAllQuery());</span><br><span class="line">        // 分页查询</span><br><span class="line">        // 当前页其实索引(第一条数据的顺序号)， from</span><br><span class="line">        sourceBuilder.from(0);</span><br><span class="line"></span><br><span class="line">        // 每页显示多少条 size</span><br><span class="line">        sourceBuilder.size(2);</span><br><span class="line">        request.source(sourceBuilder);</span><br><span class="line">        SearchResponse response = restHighLevelClient.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        // 查询匹配</span><br><span class="line">        SearchHits hits = response.getHits();</span><br><span class="line">        System.out.println(&quot;took:&quot; + response.getTook());</span><br><span class="line">        System.out.println(&quot;timeout:&quot; + response.isTimedOut());</span><br><span class="line">        System.out.println(&quot;total:&quot; + hits.getTotalHits());</span><br><span class="line">        System.out.println(&quot;MaxScore:&quot; + hits.getMaxScore());</span><br><span class="line">        System.out.println(&quot;hits========&amp;gt;&amp;gt;&quot;);</span><br><span class="line">        for (SearchHit hit : hits) &#123;</span><br><span class="line">            //输出每条查询的结果信息</span><br><span class="line">            System.out.println(hit.getSourceAsString());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;&amp;lt;&amp;lt;========&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>后台打印</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">took:1ms</span><br><span class="line">timeout:false</span><br><span class="line">total:6 hits</span><br><span class="line">MaxScore:1.0</span><br><span class="line">hits========&amp;gt;&amp;gt;</span><br><span class="line">&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:&quot;10&quot;,&quot;sex&quot;:&quot;女&quot;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;lisi&quot;,&quot;age&quot;:&quot;30&quot;,&quot;sex&quot;:&quot;女&quot;&#125;</span><br><span class="line">&amp;lt;&amp;lt;========</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-3、查询排序"><a href="#8-3、查询排序" class="headerlink" title="8.3、查询排序"></a>8.3、查询排序</h3><blockquote>
 <pre><code class="language-java">/***
     * 条件查询
     * @throws IOException
     */
    @Test
    public void queryByOrdertest() throws IOException &#123;
        // 创建搜索请求对象
        SearchRequest request = new SearchRequest();
        request.indices("user");
</blockquote>
<pre><code>    // 构建查询的请求体
    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
    sourceBuilder.query(QueryBuilders.matchAllQuery());
    // 排序
    sourceBuilder.sort(&quot;age&quot;, SortOrder.ASC);
    request.source(sourceBuilder);
    SearchResponse response = restHighLevelClient.search(request, RequestOptions.DEFAULT);
    // 查询匹配
    SearchHits hits = response.getHits();
    System.out.println(&quot;took:&quot; + response.getTook());
    System.out.println(&quot;timeout:&quot; + response.isTimedOut());
    System.out.println(&quot;total:&quot; + hits.getTotalHits());
    System.out.println(&quot;MaxScore:&quot; + hits.getMaxScore());
    System.out.println(&quot;hits========&amp;gt;&amp;gt;&quot;);
    for (SearchHit hit : hits) &#123;
        //输出每条查询的结果信息
        System.out.println(hit.getSourceAsString());
    &#125;
    System.out.println(&quot;&amp;lt;&amp;lt;========&quot;);
&#125;&lt;/code&gt;&lt;/pre&gt; 
</code></pre>
<p> 后台打印<br> <pre><code class="language-java">took:1ms<br>timeout:false<br>total:6 hits<br>MaxScore:NaN<br>hits========&gt;&gt;<br>&#123;"name":"zhangsan","age":"10","sex":"女"&#125;<br>&#123;"name":"wangwu2","age":"20","sex":"女"&#125;<br>&#123;"name":"wangwu4","age":"20","sex":"男"&#125;<br>&#123;"name":"lisi","age":"30","sex":"女"&#125;<br>&#123;"name":"wangwu1","age":"40","sex":"男"&#125;<br>&#123;"name":"wangwu3","age":"50","sex":"男"&#125;<br>&lt;&lt;========<br></code></pre> 
   </p>
<h3 id="9、高级查询-组合查询-amp-范围查询"><a href="#9、高级查询-组合查询-amp-范围查询" class="headerlink" title="9、高级查询-组合查询 &amp; 范围查询"></a>9、高级查询-组合查询 &amp; 范围查询</h3><blockquote>
 <h3>9.1、组合查询</h3> 
 <pre><code class="language-java"> /***
     * 条件查询
     * @throws IOException
     */
    @Test
    public void queryByCombinattest() throws IOException &#123;
        // 创建搜索请求对象
        SearchRequest request = new SearchRequest();
        request.indices("user");
        // 构建查询的请求体
        SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();
        // 必须包含
        boolQueryBuilder.must(QueryBuilders.matchQuery("age", "30"));
        // 一定不含
        boolQueryBuilder.mustNot(QueryBuilders.matchQuery("name", "zhangsan"));
        // 可能包含
        boolQueryBuilder.should(QueryBuilders.matchQuery("sex", "男"));
        sourceBuilder.query(boolQueryBuilder);
        request.source(sourceBuilder);
        SearchResponse response = restHighLevelClient.search(request, RequestOptions.DEFAULT);
        // 查询匹配
        SearchHits hits = response.getHits();
        System.out.println("took:" + response.getTook());
        System.out.println("timeout:" + response.isTimedOut());
        System.out.println("total:" + hits.getTotalHits());
        System.out.println("MaxScore:" + hits.getMaxScore());
        System.out.println("hits========&gt;&gt;");
        for (SearchHit hit : hits) &#123;
            //输出每条查询的结果信息
            System.out.println(hit.getSourceAsString());
        &#125;
        System.out.println("&lt;&lt;========");
    &#125;</code></pre> 
 后台打印 
 <pre><code class="language-java">took:28ms
timeout:false
total:1 hits
MaxScore:1.0
hits========&gt;&gt;
&#123;"name":"lisi","age":"30","sex":"女"&#125;
&lt;&lt;========
</blockquote>
<p>Process finished with exit code 0<br></code></pre><br> <strong>9.2、范围查询</strong><br> <pre><code class="language-java">import com.lun.elasticsearch.hello.ConnectElasticsearch;<br>import com.lun.elasticsearch.hello.ElasticsearchTask;<br>import org.elasticsearch.action.search.SearchRequest;<br>import org.elasticsearch.action.search.SearchResponse;<br>import org.elasticsearch.client.RequestOptions;<br>import org.elasticsearch.index.query.BoolQueryBuilder;<br>import org.elasticsearch.index.query.QueryBuilders;<br>import org.elasticsearch.index.query.RangeQueryBuilder;<br>import org.elasticsearch.search.SearchHit;<br>import org.elasticsearch.search.SearchHits;<br>import org.elasticsearch.search.builder.SearchSourceBuilder;<br>import org.elasticsearch.search.sort.SortOrder;</p>
<p>public class QueryDoc &#123;</p>
<pre><code>public static final ElasticsearchTask SEARCH_BY_RANGE = client -&amp;gt; &#123;
    // 创建搜索请求对象
    SearchRequest request = new SearchRequest();
    request.indices(&quot;user&quot;);
    // 构建查询的请求体
    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
    RangeQueryBuilder rangeQuery = QueryBuilders.rangeQuery(&quot;age&quot;);
    // 大于等于
    //rangeQuery.gte(&quot;30&quot;);
    // 小于等于
    rangeQuery.lte(&quot;40&quot;);
    sourceBuilder.query(rangeQuery);
    request.source(sourceBuilder);
    SearchResponse response = client.search(request, RequestOptions.DEFAULT);
    // 查询匹配
    SearchHits hits = response.getHits();
    System.out.println(&quot;took:&quot; + response.getTook());
    System.out.println(&quot;timeout:&quot; + response.isTimedOut());
    System.out.println(&quot;total:&quot; + hits.getTotalHits());
    System.out.println(&quot;MaxScore:&quot; + hits.getMaxScore());
    System.out.println(&quot;hits========&amp;gt;&amp;gt;&quot;);
    for (SearchHit hit : hits) &#123;
    //输出每条查询的结果信息
        System.out.println(hit.getSourceAsString());
    &#125;
    System.out.println(&quot;&amp;lt;&amp;lt;========&quot;);
&#125;;

public static void main(String[] args) &#123;
    ConnectElasticsearch.connect(SEARCH_BY_RANGE);
&#125;
</code></pre>
<p>}</p>
<p></code></pre><br> 后台打印<br> <pre><code class="language-java">took:1ms<br>timeout:false<br>total:5 hits<br>MaxScore:1.0<br>hits========&gt;&gt;<br>&#123;"name":"zhangsan","age":"10","sex":"女"&#125;<br>&#123;"name":"lisi","age":"30","sex":"女"&#125;<br>&#123;"name":"wangwu1","age":"40","sex":"男"&#125;<br>&#123;"name":"wangwu2","age":"20","sex":"女"&#125;<br>&#123;"name":"wangwu4","age":"20","sex":"男"&#125;<br>&lt;&lt;========</p>
<p>Process finished with exit code 0<br></code></pre> </p>
<h3 id="10、高级查询-模糊查询-amp-高亮查询"><a href="#10、高级查询-模糊查询-amp-高亮查询" class="headerlink" title="10、高级查询-模糊查询 &amp; 高亮查询"></a><strong>10、</strong>高级查询-模糊查询 &amp; 高亮查询</h3><blockquote>
<p> <strong>10.1、模糊查询</strong><br> <pre><code class="language-java">import com.lun.elasticsearch.hello.ConnectElasticsearch;<br>import com.lun.elasticsearch.hello.ElasticsearchTask;<br>import org.elasticsearch.action.search.SearchRequest;<br>import org.elasticsearch.action.search.SearchResponse;<br>import org.elasticsearch.client.RequestOptions;<br>import org.elasticsearch.common.unit.Fuzziness;<br>import org.elasticsearch.index.query.BoolQueryBuilder;<br>import org.elasticsearch.index.query.QueryBuilders;<br>import org.elasticsearch.index.query.RangeQueryBuilder;<br>import org.elasticsearch.search.SearchHit;<br>import org.elasticsearch.search.SearchHits;<br>import org.elasticsearch.search.builder.SearchSourceBuilder;<br>import org.elasticsearch.search.sort.SortOrder;</p>
</blockquote>
<p>public class QueryDoc &#123;</p>
<pre><code>public static final ElasticsearchTask SEARCH_BY_FUZZY_CONDITION = client -&amp;gt; &#123;
    // 创建搜索请求对象
    SearchRequest request = new SearchRequest();
    request.indices(&quot;user&quot;);
    // 构建查询的请求体
    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
    sourceBuilder.query(QueryBuilders.fuzzyQuery(&quot;name&quot;,&quot;wangwu&quot;).fuzziness(Fuzziness.ONE));
    request.source(sourceBuilder);
    SearchResponse response = client.search(request, RequestOptions.DEFAULT);
    // 查询匹配
    SearchHits hits = response.getHits();
    System.out.println(&quot;took:&quot; + response.getTook());
    System.out.println(&quot;timeout:&quot; + response.isTimedOut());
    System.out.println(&quot;total:&quot; + hits.getTotalHits());
    System.out.println(&quot;MaxScore:&quot; + hits.getMaxScore());
    System.out.println(&quot;hits========&amp;gt;&amp;gt;&quot;);
    for (SearchHit hit : hits) &#123;
        //输出每条查询的结果信息
        System.out.println(hit.getSourceAsString());
    &#125;
    System.out.println(&quot;&amp;lt;&amp;lt;========&quot;);
&#125;;


public static void main(String[] args) &#123;
</code></pre>
<p>//        ConnectElasticsearch.connect(SEARCH_ALL);<br>//        ConnectElasticsearch.connect(SEARCH_BY_CONDITION);<br>//        ConnectElasticsearch.connect(SEARCH_BY_PAGING);<br>//        ConnectElasticsearch.connect(SEARCH_WITH_ORDER);<br>//        ConnectElasticsearch.connect(SEARCH_BY_BOOL_CONDITION);<br>//        ConnectElasticsearch.connect(SEARCH_BY_RANGE);<br>        ConnectElasticsearch.connect(SEARCH_BY_FUZZY_CONDITION);<br>    }</p>
<p>}<br></code></pre><br> 后台打印<br> <pre><code class="language-java">took:152ms<br>timeout:false<br>total:4 hits<br>MaxScore:1.2837042<br>hits========&gt;&gt;<br>&#123;"name":"wangwu1","age":"40","sex":"男"&#125;<br>&#123;"name":"wangwu2","age":"20","sex":"女"&#125;<br>&#123;"name":"wangwu3","age":"50","sex":"男"&#125;<br>&#123;"name":"wangwu4","age":"20","sex":"男"&#125;<br>&lt;&lt;========</p>
<p>Process finished with exit code 0<br></code></pre><br> <strong>10.2、高亮查询</strong><br> <pre><code class="language-java">import com.lun.elasticsearch.hello.ConnectElasticsearch;<br>import com.lun.elasticsearch.hello.ElasticsearchTask;<br>import org.elasticsearch.action.search.SearchRequest;<br>import org.elasticsearch.action.search.SearchResponse;<br>import org.elasticsearch.client.RequestOptions;<br>import org.elasticsearch.common.unit.Fuzziness;<br>import org.elasticsearch.index.query.BoolQueryBuilder;<br>import org.elasticsearch.index.query.QueryBuilders;<br>import org.elasticsearch.index.query.RangeQueryBuilder;<br>import org.elasticsearch.index.query.TermsQueryBuilder;<br>import org.elasticsearch.search.SearchHit;<br>import org.elasticsearch.search.SearchHits;<br>import org.elasticsearch.search.builder.SearchSourceBuilder;<br>import org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;<br>import org.elasticsearch.search.fetch.subphase.highlight.HighlightField;<br>import org.elasticsearch.search.sort.SortOrder;</p>
<p>import java.util.Map;</p>
<p>public class QueryDoc &#123;</p>
<pre><code>public static final ElasticsearchTask SEARCH_WITH_HIGHLIGHT = client -&amp;gt; &#123;
    // 高亮查询
    SearchRequest request = new SearchRequest().indices(&quot;user&quot;);
    //2.创建查询请求体构建器
    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
    //构建查询方式：高亮查询
    TermsQueryBuilder termsQueryBuilder =
            QueryBuilders.termsQuery(&quot;name&quot;,&quot;zhangsan&quot;);
    //设置查询方式
    sourceBuilder.query(termsQueryBuilder);
    //构建高亮字段
    HighlightBuilder highlightBuilder = new HighlightBuilder();
    highlightBuilder.preTags(&quot;&amp;lt;font color=&#39;red&#39;&amp;gt;&quot;);//设置标签前缀
    highlightBuilder.postTags(&quot;&amp;lt;/font&amp;gt;&quot;);//设置标签后缀
    highlightBuilder.field(&quot;name&quot;);//设置高亮字段
    //设置高亮构建对象
    sourceBuilder.highlighter(highlightBuilder);
    //设置请求体
    request.source(sourceBuilder);
    //3.客户端发送请求，获取响应对象
    SearchResponse response = client.search(request, RequestOptions.DEFAULT);
    //4.打印响应结果
    SearchHits hits = response.getHits();
    System.out.println(&quot;took::&quot;+response.getTook());
    System.out.println(&quot;time_out::&quot;+response.isTimedOut());
    System.out.println(&quot;total::&quot;+hits.getTotalHits());
    System.out.println(&quot;max_score::&quot;+hits.getMaxScore());
    System.out.println(&quot;hits::::&amp;gt;&amp;gt;&quot;);
    for (SearchHit hit : hits) &#123;
        String sourceAsString = hit.getSourceAsString();
        System.out.println(sourceAsString);
        //打印高亮结果
        Map&amp;lt;String, HighlightField&amp;gt; highlightFields = hit.getHighlightFields();
        System.out.println(highlightFields);
    &#125;
    System.out.println(&quot;&amp;lt;&amp;lt;::::&quot;);
&#125;;


public static void main(String[] args) &#123;
    ConnectElasticsearch.connect(SEARCH_WITH_HIGHLIGHT);
&#125;
</code></pre>
<p>}<br></code></pre><br> 后台打印<br> <pre><code class="language-java">took::672ms<br>time_out::false<br>total::1 hits<br>max_score::1.0<br>hits::::&gt;&gt;<br>&#123;"name":"zhangsan","age":"10","sex":"女"&#125;<br>&#123;name=[name], fragments[[&lt;font color='red'&gt;zhangsan&lt;/font&gt;]]&#125;<br>&lt;&lt;::::</p>
<p>Process finished with exit code 0<br></code></pre> 
   </p>
<h3 id="11、高级查询-最大值查询-amp-分组查询"><a href="#11、高级查询-最大值查询-amp-分组查询" class="headerlink" title="11、高级查询-最大值查询 &amp; 分组查询"></a>11、高级查询-最大值查询 &amp; 分组查询</h3><blockquote>
<p> <strong>1、最大值查询</strong><br> <pre><code class="language-java">import com.lun.elasticsearch.hello.ConnectElasticsearch;<br>import com.lun.elasticsearch.hello.ElasticsearchTask;<br>import org.elasticsearch.action.search.SearchRequest;<br>import org.elasticsearch.action.search.SearchResponse;<br>import org.elasticsearch.client.RequestOptions;<br>import org.elasticsearch.common.unit.Fuzziness;<br>import org.elasticsearch.index.query.BoolQueryBuilder;<br>import org.elasticsearch.index.query.QueryBuilders;<br>import org.elasticsearch.index.query.RangeQueryBuilder;<br>import org.elasticsearch.index.query.TermsQueryBuilder;<br>import org.elasticsearch.search.SearchHit;<br>import org.elasticsearch.search.SearchHits;<br>import org.elasticsearch.search.aggregations.AggregationBuilders;<br>import org.elasticsearch.search.builder.SearchSourceBuilder;<br>import org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;<br>import org.elasticsearch.search.fetch.subphase.highlight.HighlightField;<br>import org.elasticsearch.search.sort.SortOrder;</p>
</blockquote>
<p>import java.util.Map;</p>
<p>public class QueryDoc &#123;</p>
<pre><code>public static final ElasticsearchTask SEARCH_WITH_MAX = client -&amp;gt; &#123;
    // 高亮查询
    SearchRequest request = new SearchRequest().indices(&quot;user&quot;);
    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
    sourceBuilder.aggregation(AggregationBuilders.max(&quot;maxAge&quot;).field(&quot;age&quot;));
    //设置请求体
    request.source(sourceBuilder);
    //3.客户端发送请求，获取响应对象
    SearchResponse response = client.search(request, RequestOptions.DEFAULT);
    //4.打印响应结果
    SearchHits hits = response.getHits();
    System.out.println(response);
&#125;;

public static void main(String[] args) &#123;
    ConnectElasticsearch.connect(SEARCH_WITH_MAX);
&#125;
</code></pre>
<p>}<br></code></pre><br> 后台打印<br> <pre><code>&#123;"took":16,"timed_out":false,"_shards":&#123;"total":1,"successful":1,"skipped":0,"failed":0&#125;,"hits":&#123;"total":&#123;"value":6,"relation":"eq"&#125;,"max_score":1.0,"hits":[&#123;"_index":"user","_type":"_doc","_id":"1001","_score":1.0,"_source":&#123;"name":"zhangsan","age":"10","sex":"女"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1002","_score":1.0,"_source":&#123;"name":"lisi","age":"30","sex":"女"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1003","_score":1.0,"_source":&#123;"name":"wangwu1","age":"40","sex":"男"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1004","_score":1.0,"_source":&#123;"name":"wangwu2","age":"20","sex":"女"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1005","_score":1.0,"_source":&#123;"name":"wangwu3","age":"50","sex":"男"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1006","_score":1.0,"_source":&#123;"name":"wangwu4","age":"20","sex":"男"&#125;&#125;]&#125;,"aggregations":&#123;"max#maxAge":&#123;"value":50.0&#125;&#125;&#125;</p>
<p>Process finished with exit code 0<br></code></pre><br> <h3>分组查询</h3><br> <pre><code class="language-java">import com.lun.elasticsearch.hello.ConnectElasticsearch;<br>import com.lun.elasticsearch.hello.ElasticsearchTask;<br>import org.elasticsearch.action.search.SearchRequest;<br>import org.elasticsearch.action.search.SearchResponse;<br>import org.elasticsearch.client.RequestOptions;<br>import org.elasticsearch.common.unit.Fuzziness;<br>import org.elasticsearch.index.query.BoolQueryBuilder;<br>import org.elasticsearch.index.query.QueryBuilders;<br>import org.elasticsearch.index.query.RangeQueryBuilder;<br>import org.elasticsearch.index.query.TermsQueryBuilder;<br>import org.elasticsearch.search.SearchHit;<br>import org.elasticsearch.search.SearchHits;<br>import org.elasticsearch.search.aggregations.AggregationBuilders;<br>import org.elasticsearch.search.builder.SearchSourceBuilder;<br>import org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;<br>import org.elasticsearch.search.fetch.subphase.highlight.HighlightField;<br>import org.elasticsearch.search.sort.SortOrder;</p>
<p>import java.util.Map;</p>
<p>public class QueryDoc &#123;</p>
<pre><code>public static final ElasticsearchTask SEARCH_WITH_GROUP = client -&amp;gt; &#123;
    SearchRequest request = new SearchRequest().indices(&quot;user&quot;);
    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
    sourceBuilder.aggregation(AggregationBuilders.terms(&quot;age_groupby&quot;).field(&quot;age&quot;));
    //设置请求体
    request.source(sourceBuilder);
    //3.客户端发送请求，获取响应对象
    SearchResponse response = client.search(request, RequestOptions.DEFAULT);
    //4.打印响应结果
    SearchHits hits = response.getHits();
    System.out.println(response);
&#125;;

public static void main(String[] args) &#123;
    ConnectElasticsearch.connect(SEARCH_WITH_GROUP);
&#125;
</code></pre>
<p>}<br></code></pre><br> 后台打印<br> <pre><code class="language-java">&#123;"took":10,"timed_out":false,"_shards":&#123;"total":1,"successful":1,"skipped":0,"failed":0&#125;,"hits":&#123;"total":&#123;"value":6,"relation":"eq"&#125;,"max_score":1.0,"hits":[&#123;"_index":"user","_type":"_doc","_id":"1001","_score":1.0,"_source":&#123;"name":"zhangsan","age":"10","sex":"女"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1002","_score":1.0,"_source":&#123;"name":"lisi","age":"30","sex":"女"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1003","_score":1.0,"_source":&#123;"name":"wangwu1","age":"40","sex":"男"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1004","_score":1.0,"_source":&#123;"name":"wangwu2","age":"20","sex":"女"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1005","_score":1.0,"_source":&#123;"name":"wangwu3","age":"50","sex":"男"&#125;&#125;,&#123;"_index":"user","_type":"_doc","_id":"1006","_score":1.0,"_source":&#123;"name":"wangwu4","age":"20","sex":"男"&#125;&#125;]&#125;,"aggregations":&#123;"lterms#age_groupby":&#123;"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[&#123;"key":20,"doc_count":2&#125;,&#123;"key":10,"doc_count":1&#125;,&#123;"key":30,"doc_count":1&#125;,&#123;"key":40,"doc_count":1&#125;,&#123;"key":50,"doc_count":1&#125;]&#125;&#125;&#125;</p>
<p>Process finished with exit code 0<br></code></pre> 
   </p>
<p> </p>
<p> </p>
<p> </p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch之analysis"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/Elasticsearch%E4%B9%8Banalysis/"
    >Elasticsearch之analysis</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/Elasticsearch%E4%B9%8Banalysis/" class="article-date">
  <time datetime="2021-07-18T14:21:56.442Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: Elasticsearch之analysis<br>categories:</p>
<ul>
<li>elasticsearch</li>
</ul>
<p>—### 1、简介</p>
<blockquote>
<p> analysis(只是一个概念)，文本分析是将全文本转换为一系列单词的过程，也叫分词。analysis是通 过analyzer(分词器)来实现的，可以使用Elasticsearch内置的分词器，也可以自己去定制一些分词 器。 除了在数据写入的时候进行分词处理，那么在查询的时候也可以使用分析器对查询语句进行分词。<br> anaylzer是由三部分组成，例如有：Hello a World, the world is beautiful </p>
</blockquote>
<ol>
<li>Character Filter: 将文本中html标签剔除掉。 </li>
<li>Tokenizer: 按照规则进行分词，在英文中按照空格分词。 </li>
<li>Token Filter: 去掉stop world(停顿词，a, an, the, is, are等)，然后转换小写 <img alt="" height="201" src="https://img-blog.csdnimg.cn/20210701230820389.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="739"> </li>
</ol>
<h3 id="2、内置分词器"><a href="#2、内置分词器" class="headerlink" title="2、内置分词器"></a>2、内置分词器</h3><blockquote>
 <img alt="" height="296" src="https://img-blog.csdnimg.cn/20210701230857488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="740"> 
 内置分词器示例： 
 <img alt="" height="545" src="https://img-blog.csdnimg.cn/20210701231016915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="779"> 
 <img alt="" height="557" src="https://img-blog.csdnimg.cn/20210701231031310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="796"> 
</blockquote>
<h3 id="3、ik分词器"><a href="#3、ik分词器" class="headerlink" title="3、ik分词器"></a>3、ik分词器</h3><blockquote>
<p> IK分词器在任何操作系统下安装步骤均⼀样: 在ES的家⽬录下的 plugins ⽬录下创建名为 ik 的 ⽂件夹，然后将下载后的 zip 包拷⻉到 ik 解压即可<br> IK分词器提供了两种分词⽅式：<br> <img alt="" height="271" src="https://img-blog.csdnimg.cn/20210704114331635.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="991"><br> 验证：<br> <img alt="" height="280" src="https://img-blog.csdnimg.cn/20210704114423155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1007"><br> <img alt="" height="76" src="https://img-blog.csdnimg.cn/20210704114551497.png" width="483"><img alt="" height="205" src="https://img-blog.csdnimg.cn/20210704114605160.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="992"> </p>
</blockquote>
<h3 id="4、⾃定义词库"><a href="#4、⾃定义词库" class="headerlink" title="4、⾃定义词库"></a>4、⾃定义词库</h3><blockquote>
<p> 在很多的时候，业务上的⼀些词库极有可能不在IK分词器的词库中，需要去定制属于我们⾃⼰的词 库。例如下⾯的例⼦中， 正井猫 、 up主 被切分为⼀个个的字，我们希望这两个词语是不被拆 分；另外 的 作为中⽂的停顿词，也不希望出现在分词中，所以我们需要⾃定义词库和停顿词词 库。<br> <img alt="" height="166" src="https://img-blog.csdnimg.cn/20210704115725621.png" width="988"><img alt="" height="798" src="https://img-blog.csdnimg.cn/20210704115746521.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"><br> 进⼊到 $ES_HOME/plugins/ik/config ⽬录下，创建 custom ⽬录，在⽬录下创建 mydic.dic 、 ext_stopword.dic ⽂件，<br> 在 mydic.dic ⽂件中添加两⾏内容：<br> <img alt="" height="101" src="https://img-blog.csdnimg.cn/20210704121115600.png" width="620"> 在 ext_stopword.dic 中添加⼀⾏内容:<br> <img alt="" height="61" src="https://img-blog.csdnimg.cn/20210704121136941.png" width="485"><br> 最后修改 $ES_HOME/plugins/ik/config/IKAnalyzer.cfg.xml ⽂件，内容如下：<br> <img alt="" height="501" src="https://img-blog.csdnimg.cn/2021070412115725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1102"><br> 重启重启elasticsearch elasticsearch ， 重新执⾏如上的命令，结果如下：<br> <img alt="" height="579" src="https://img-blog.csdnimg.cn/20210704121221247.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
<h3 id="5、IK分词器在工作中的实际案例"><a href="#5、IK分词器在工作中的实际案例" class="headerlink" title="5、IK分词器在工作中的实际案例"></a>5、IK分词器在工作中的实际案例</h3><blockquote>
<p> 5.1、首先创建new索引的mapping<br> <pre><code class="language-javascript">PUT news<br>&#123;<br>  "mappings": &#123;<br>    "properties": &#123;<br>      "title":&#123;<br>        "type": "text",<br>        "analyzer": "ik_max_word",<br>        "search_analyzer": "ik_smart"<br>      &#125;,<br>      "content":&#123;<br>        "type": "text",<br>        "analyzer": "ik_max_word",<br>        "search_analyzer": "ik_smart"<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;</code></pre><br> 注意：analyzer和search_analyzer的区别如下：<br>       analyzer：表示数据在进入news这个索引中的时候，我们尽量让它多的对我们数据进行分词，后面才能够达到精准的匹配。<br>       search_analyzer：对我们的数据进行搜索的时候不要进行过多的分词处理，提高效率。<br> 5.2、查看创建的索引结构<br>      GET news/_mapping<br>      <img alt="" height="402" src="https://img-blog.csdnimg.cn/20210704123038178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="520"><br> 5.3、创建数据进入索引<br> <img alt="" height="438" src="https://img-blog.csdnimg.cn/20210704123835184.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="854"><br> 5.4、通过语句查询<br> <img alt="" height="234" src="https://img-blog.csdnimg.cn/20210704124000129.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="659"><br> <img alt="" height="758" src="https://img-blog.csdnimg.cn/20210704124016440.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1157"><br> 下面我们再新增两条数据测试<br> <img alt="" height="212" src="https://img-blog.csdnimg.cn/2021070412571235.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="638"><br> 查询一下柳岩：<br> <img alt="" height="181" src="https://img-blog.csdnimg.cn/20210704125756473.png" width="660"><br> <img alt="" height="766" src="https://img-blog.csdnimg.cn/20210704125822468.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1160"><br> 可以发现我们其实仅仅只是查询柳岩，但是两条数据都查询出来了，那么我们首先配置一下mydic.dic扩展词典：<br> <img alt="" height="212" src="https://img-blog.csdnimg.cn/20210704130118770.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="422"><br> 重新启动elasticsearch:<br> 因为我们之前的数据已经分过词了，所以我们需要重新分词相关数据：<br> 先重新索引柳岩：<br> <pre><code class="language-html">POST news/_update_by_query<br>&#123;<br>  "query": &#123;<br>    "bool": &#123;<br>      "should": [<br>        &#123;<br>          "bool": &#123;<br>            "must": [<br>              &#123;<br>                "term": &#123;<br>                  "title": &#123;<br>                    "value": "柳"<br>                  &#125;<br>                &#125;<br>              &#125;,&#123;<br>                "term": &#123;<br>                  "title": &#123;<br>                    "value": "岩"<br>                  &#125;<br>                &#125;<br>              &#125;<br>            ]<br>          &#125;<br>        &#125;,&#123;<br>          "bool": &#123;<br>            "must": [<br>              &#123;<br>                "term": &#123;<br>                  "content": &#123;<br>                    "value": "柳"<br>                  &#125;<br>                &#125;<br>              &#125;,&#123;<br>                "term": &#123;<br>                  "content": &#123;<br>                    "value": "岩"<br>                  &#125;<br>                &#125;<br>              &#125;<br>            ]<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;</code></pre><br> 先重新索引柳真：<br> <pre><code class="language-html">POST news/_update_by_query<br>&#123;<br>  "query": &#123;<br>    "bool": &#123;<br>      "should": [<br>        &#123;<br>          "bool": &#123;<br>            "must": [<br>              &#123;<br>                "term": &#123;<br>                  "title": &#123;<br>                    "value": "柳"<br>                  &#125;<br>                &#125;<br>              &#125;,&#123;<br>                "term": &#123;<br>                  "title": &#123;<br>                    "value": "真"<br>                  &#125;<br>                &#125;<br>              &#125;<br>            ]<br>          &#125;<br>        &#125;,&#123;<br>          "bool": &#123;<br>            "must": [<br>              &#123;<br>                "term": &#123;<br>                  "content": &#123;<br>                    "value": "柳"<br>                  &#125;<br>                &#125;<br>              &#125;,&#123;<br>                "term": &#123;<br>                  "content": &#123;<br>                    "value": "真"<br>                  &#125;<br>                &#125;<br>              &#125;<br>            ]<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;</code></pre><br> 再次查询：<br> <img alt="" height="200" src="https://img-blog.csdnimg.cn/20210704134645260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="579"><br> <img alt="" height="625" src="https://img-blog.csdnimg.cn/20210704134700972.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1179"> </p>
</blockquote>
<h3 id="6、pinyin分词器的安装"><a href="#6、pinyin分词器的安装" class="headerlink" title="6、pinyin分词器的安装"></a>6、pinyin分词器的安装</h3><blockquote>
<p> pinyin 分词器在任何操作系统下安装步骤均⼀样: 在ES的家⽬录下的 plugins ⽬录下创建名为 pinyin 的⽂件夹，然后将下载后的 zip 包拷⻉到 pinyin 解压即可<br> <img alt="" height="219" src="https://img-blog.csdnimg.cn/202107041449420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="827"><br> 重启es<br> 测试pingyin插件<br> <img alt="" height="154" src="https://img-blog.csdnimg.cn/20210704145316140.png" width="653"><br> 效果：<br> <img alt="" height="539" src="https://img-blog.csdnimg.cn/2021070414533563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="484"> </p>
</blockquote>
<h3 id="6、Elasticsearch之⾃定义分词器以及应⽤"><a href="#6、Elasticsearch之⾃定义分词器以及应⽤" class="headerlink" title="6、Elasticsearch之⾃定义分词器以及应⽤"></a>6、Elasticsearch之⾃定义分词器以及应⽤</h3><blockquote>
<p> 6.1、案例需求：<br> <img alt="" height="58" src="https://img-blog.csdnimg.cn/20210704154206109.png" width="796"><img alt="" height="783" src="https://img-blog.csdnimg.cn/20210704154226316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="463"><br> 6.2、设置分词器<br> <img alt="" height="621" src="https://img-blog.csdnimg.cn/20210704154308863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="699"><br> 6.3、验证分词器效果<br> <img alt="" height="135" src="https://img-blog.csdnimg.cn/20210704154525604.png" width="800"><br> <img alt="" height="588" src="https://img-blog.csdnimg.cn/20210704154546577.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="982"><br> 6.4、为属性添加分词器<br> <img alt="" height="373" src="https://img-blog.csdnimg.cn/20210704154634587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="996"><br> 6.5、结果验证<br>    执⾏如下命令添加数据<br>    <img alt="" height="234" src="https://img-blog.csdnimg.cn/20210704154704254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="452">    <img alt="" height="728" src="https://img-blog.csdnimg.cn/20210704154744408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"><br> <img alt="" height="462" src="https://img-blog.csdnimg.cn/20210704154800679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"><br> <img alt="" height="566" src="https://img-blog.csdnimg.cn/20210704154826224.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> </p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> kgf
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        由 <a href="https://hexo.io" target="_blank">Hexo</a> 强力驱动
        <span class="division">|</span>
        主题 - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/image1.ico" alt="爱上口袋的天空"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
  </div>
</body>

</html>