<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> çˆ±ä¸Šå£è¢‹çš„å¤©ç©º</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/image1.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <!-- mermaid -->
      
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">çˆ±ä¸Šå£è¢‹çš„å¤©ç©º</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['æ¬¢è¿æ¥åˆ°çˆ±ä¸Šå£è¢‹çš„å¤©ç©ºçš„åšå®¢', 'æ„¿ä½ ä¸€ç”ŸåŠªåŠ›ï¼Œä¸€ç”Ÿè¢«çˆ±', 'æƒ³è¦çš„éƒ½æ‹¥æœ‰ï¼Œå¾—ä¸åˆ°çš„éƒ½é‡Šæ€€'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  <ul class="ads">
    
        <li>
            <a target="_blank" rel="noopener" href="https://curl.qcloud.com/kvO7hb43">
                <img src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/ten_1.jpg" width="300" alt="äº‘æœåŠ¡å™¨é™æ—¶ç§’æ€">
            </a>
        </li>
    
        <li>
            <a target="_blank" rel="noopener" href="https://www.vultr.com/?ref=8630075">
                <img src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/vultr.png" width="300" alt="vulträ¼˜æƒ vps">
            </a>
        </li>
    
</ul>
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-CSSèƒŒæ™¯(background)"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/CSS%E8%83%8C%E6%99%AF(background)/"
    >CSSèƒŒæ™¯(background)</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/CSS%E8%83%8C%E6%99%AF(background)/" class="article-date">
  <time datetime="2021-07-18T14:19:55.197Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Css/">Css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: CSSèƒŒæ™¯(background)<br>categories:</p>
<ul>
<li>css</li>
</ul>
<p>â€”1.èƒŒæ™¯é¢œè‰²</p>
<blockquote>
<p> background-color:Â é¢œè‰²å€¼;Â Â Â é»˜è®¤çš„å€¼æ˜¯Â **transparentÂ Â **é€æ˜çš„ </p>
</blockquote>
<p>2.èƒŒæ™¯å›¾ç‰‡(image)</p>
<blockquote>
<p> è¯­æ³•ï¼š background-imageÂ :Â noneÂ |Â urlÂ (url)Â ; ä¾‹å¦‚: background-image:Â url(images/1.png); </p>
</blockquote>
<p>3.èƒŒæ™¯å¹³é“ºï¼ˆrepeatï¼‰</p>
<blockquote>
 <pre><code class="language-css">background-repeatÂ :Â repeatÂ |Â no-repeatÂ |Â repeat-xÂ |Â repeat-yÂ 
</code></pre> 
 <table><thead>|å‚æ•°|ä½œç”¨
</blockquote>
</thead><tbody>|repeat|èƒŒæ™¯å›¾åƒåœ¨çºµå‘å’Œæ¨ªå‘ä¸Šå¹³é“ºï¼ˆé»˜è®¤çš„ï¼‰
|no-repeat|èƒŒæ™¯å›¾åƒä¸å¹³é“º
|repeat-x|èƒŒæ™¯å›¾åƒåœ¨æ¨ªå‘ä¸Šå¹³é“º
|repeat-y| èƒŒæ™¯å›¾åƒåœ¨çºµå‘å¹³é“ºÂ Â  
</tbody></table> ä»€ä¹ˆæ˜¯repeatï¼Ÿ
  Â  Â  Â  Â Â 
 <img alt="" height="380" src="https://img-blog.csdnimg.cn/20210202210607583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="582">
  ä»€ä¹ˆæ˜¯repeat-xï¼Ÿ
  Â  Â  Â  Â Â 
 <img alt="" height="248" src="https://img-blog.csdnimg.cn/20210202210750597.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="483">
  ä»€ä¹ˆæ˜¯repeat-yï¼Ÿ
  Â  Â  Â  Â Â 
 <img alt="" height="369" src="https://img-blog.csdnimg.cn/20210202210842685.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="451">


<p>4.èƒŒæ™¯ä½ç½®(position)</p>
<blockquote>
 <pre><code class="language-css">background-positionÂ :Â lengthÂ ||Â length
background-positionÂ :Â positionÂ ||Â positionÂ 
</code></pre> 
 <table><thead>|å‚æ•°|å€¼
</blockquote>
</thead><tbody>|length|ç™¾åˆ†æ•° | ç”±æµ®ç‚¹æ•°å­—å’Œå•ä½æ ‡è¯†ç¬¦ç»„æˆçš„é•¿åº¦å€¼
|position|top | center | bottom | left | center | right Â  æ–¹ä½åè¯
</tbody></table>
 æ³¨æ„ï¼š 
 -  å¿…é¡»å…ˆæŒ‡å®šbackground-imageå±æ€§ -  position åé¢æ˜¯xåæ ‡å’Œyåæ ‡ã€‚å¯ä»¥ä½¿ç”¨æ–¹ä½åè¯æˆ–è€… ç²¾ç¡®å•ä½ã€‚ -  å¦‚æœæŒ‡å®šä¸¤ä¸ªå€¼ï¼Œä¸¤ä¸ªå€¼éƒ½æ˜¯æ–¹ä½åå­—ï¼Œåˆ™ä¸¤ä¸ªå€¼å‰åé¡ºåºæ— å…³ï¼Œæ¯”å¦‚left Â topå’Œtop Â leftæ•ˆæœä¸€è‡´ -  å¦‚æœåªæŒ‡å®šäº†ä¸€ä¸ªæ–¹ä½åè¯ï¼Œå¦ä¸€ä¸ªå€¼é»˜è®¤å±…ä¸­å¯¹é½ã€‚ -  å¦‚æœposition åé¢æ˜¯ç²¾ç¡®åæ ‡ï¼Œ é‚£ä¹ˆç¬¬ä¸€ä¸ªï¼Œè‚¯å®šæ˜¯ x ç¬¬äºŒä¸ªä¸€å®šæ˜¯y -  å¦‚æœåªæŒ‡å®šä¸€ä¸ªæ•°å€¼,é‚£è¯¥æ•°å€¼ä¸€å®šæ˜¯xåæ ‡ï¼Œå¦ä¸€ä¸ªé»˜è®¤å‚ç›´å±…ä¸­ -  å¦‚æœæŒ‡å®šçš„ä¸¤ä¸ªå€¼æ˜¯ ç²¾ç¡®å•ä½å’Œæ–¹ä½åå­—æ··åˆä½¿ç”¨ï¼Œåˆ™ç¬¬ä¸€ä¸ªå€¼æ˜¯xåæ ‡ï¼Œç¬¬äºŒä¸ªå€¼æ˜¯yåæ ‡ 
 èƒŒæ™¯ç®€å†™ï¼š 
 -  backgroundï¼šå±æ€§çš„å€¼çš„ä¹¦å†™é¡ºåºå®˜æ–¹æ²¡æœ‰å¼ºåˆ¶çš„æ ‡å‡†ã€‚ä¸ºäº†å¯è¯»æ€§ï¼Œå»ºè®®å¦‚ä¸‹å†™ï¼š -  background: èƒŒæ™¯é¢œè‰² èƒŒæ™¯å›¾ç‰‡åœ°å€ èƒŒæ™¯å¹³é“º èƒŒæ™¯æ»šåŠ¨ èƒŒæ™¯ä½ç½®; 
 <pre><code>/*Â æœ‰èƒŒæ™¯å›¾ç‰‡èƒŒæ™¯é¢œè‰²å¯ä»¥ä¸ç”¨å†™*/
background:Â transparentÂ url(image.jpg)Â repeat-yÂ Â scrollÂ centerÂ topÂ ;</code></pre> 


<p>5.èƒŒæ™¯å›¾åƒå›ºå®šbackground-attachment</p>
<blockquote>
<p> èƒŒæ™¯æ˜¯å¦è·Ÿç€æ»šåŠ¨è€Œæ»šåŠ¨<br> <img alt="" height="456" src="https://img-blog.csdnimg.cn/20210202214748899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1105"> </p>
</blockquote>
<p>6.èƒŒæ™¯åŠé€æ˜(CSS3)</p>
<blockquote>
 <pre><code class="language-css">background:Â rgba(0,Â 0,Â 0,Â 0.3);
background:Â rgba(0,Â 0,Â 0,Â .3);
</code></pre> 
</blockquote>
<ul>
<li>ç­‰åŒäºbackground-color: rgba(0, 0, 0, .3) -  æœ€åä¸€ä¸ªå‚æ•°æ˜¯alpha é€æ˜åº¦Â Â å–å€¼èŒƒå›´ 0~1ä¹‹é—´ -  æˆ‘ä»¬ä¹ æƒ¯æŠŠ0.3 çš„ 0Â çœç•¥æ‰Â Â è¿™æ ·å†™ background: rgba(0, 0, 0, .3); -  æ³¨æ„ï¼šèƒŒæ™¯åŠé€æ˜æ˜¯æŒ‡ç›’å­èƒŒæ™¯åŠé€æ˜ï¼Œç›’å­é‡Œé¢çš„å†…å®¹ä¸å—å½±å“ -  ä½äºIE 9çš„ç‰ˆæœ¬ä¸æ”¯æŒ<br>ç›’å­åŠé€æ˜ opacity </li>
<li>è®¾ç½®opacityå…ƒç´ çš„æ‰€æœ‰åä»£å…ƒç´ ä¼šéšç€ä¸€èµ·å…·æœ‰é€æ˜æ€§ï¼Œä¸€èˆ¬ç”¨äºè°ƒæ•´å›¾ç‰‡æˆ–è€…æ¨¡å—çš„æ•´ä½“ä¸é€æ˜åº¦ <pre>`opacity:Â .2;`</pre> </li>
</ul>
<p>7.èƒŒæ™¯æ€»ç»“</p>
<blockquote>
 <table><thead>|å±æ€§|ä½œç”¨|å€¼
</blockquote>
</thead><tbody>|background-color|èƒŒæ™¯é¢œè‰²|é¢„å®šä¹‰çš„é¢œè‰²å€¼/åå…­è¿›åˆ¶/RGBä»£ç 
|background-image|èƒŒæ™¯å›¾ç‰‡|url(å›¾ç‰‡è·¯å¾„)
|background-repeat|æ˜¯å¦å¹³é“º|repeat/no-repeat/repeat-x/repeat-y
|background-position|èƒŒæ™¯ä½ç½®|length/position Â  Â åˆ†åˆ«æ˜¯x Â å’Œ yåæ ‡ï¼Œ åˆ‡è®° å¦‚æœæœ‰ ç²¾ç¡®æ•°å€¼å•ä½ï¼Œåˆ™å¿…é¡»æŒ‰ç…§å…ˆX åY çš„å†™æ³•
|background-attachment|èƒŒæ™¯å›ºå®šè¿˜æ˜¯æ»šåŠ¨|scroll/fixed
|èƒŒæ™¯ç®€å†™|æ›´ç®€å•|èƒŒæ™¯é¢œè‰² èƒŒæ™¯å›¾ç‰‡åœ°å€ èƒŒæ™¯å¹³é“º èƒŒæ™¯æ»šåŠ¨ èƒŒæ™¯ä½ç½®; Â ä»–ä»¬æ²¡æœ‰é¡ºåº
|èƒŒæ™¯é€æ˜|è®©ç›’å­åŠé€æ˜|background: rgba(0,0,0,0.3); Â  åé¢å¿…é¡»æ˜¯ 4ä¸ªå€¼
</tbody></table>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-CSS3 æ–°å¢åœ†è§’ä»¥åŠç›’å­é˜´å½±"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/CSS3%20%E6%96%B0%E5%A2%9E%E5%9C%86%E8%A7%92%E4%BB%A5%E5%8F%8A%E7%9B%92%E5%AD%90%E9%98%B4%E5%BD%B1/"
    >CSS3 æ–°å¢åœ†è§’ä»¥åŠç›’å­é˜´å½±</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/CSS3%20%E6%96%B0%E5%A2%9E%E5%9C%86%E8%A7%92%E4%BB%A5%E5%8F%8A%E7%9B%92%E5%AD%90%E9%98%B4%E5%BD%B1/" class="article-date">
  <time datetime="2021-07-18T14:19:55.195Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Css/">Css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: CSS3 æ–°å¢åœ†è§’ä»¥åŠç›’å­é˜´å½±<br>categories:</p>
<ul>
<li>css</li>
</ul>
<p>â€”1.åœ†è§’è¾¹æ¡†</p>
<blockquote>
 <pre><code class="language-css">border-radius:length;
</blockquote>
<p>border-top-left-radiusÂ Â Â å®šä¹‰äº†å·¦ä¸Šè§’çš„å¼§åº¦<br>border-top-right-radiusÂ Â Â å®šä¹‰äº†å³ä¸Šè§’çš„å¼§åº¦<br>border-bottom-right-radiusÂ Â Â å®šä¹‰äº†å³ä¸‹è§’çš„å¼§åº¦<br>border-bottom-left-radiusÂ Â Â å®šä¹‰äº†å·¦ä¸‹è§’çš„å¼§åº¦<br></code></pre> </p>
<ul>
<li>å…¶ä¸­æ¯ä¸€ä¸ªå€¼å¯ä»¥ä¸º æ•°å€¼æˆ–ç™¾åˆ†æ¯”çš„å½¢å¼ã€‚ -  æŠ€å·§ï¼šè®©ä¸€ä¸ªæ­£æ–¹å½¢ å˜æˆåœ†åœˆ <pre><code class="language-css">border-radius:Â 50%;
</code></pre> 
<img alt="å›¾ç‰‡" src="https://img-blog.csdnimg.cn/img_convert/cd90d25bf757638154c28d92250dac7c.png">å¦‚æœè¦åœ¨å››ä¸ªè§’ä¸Šä¸€ä¸€æŒ‡å®šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ğŸ‘‡ğŸ‘‡ï¼š <pre><code class="language-css">border-radius:Â å·¦ä¸Šè§’Â å³ä¸Šè§’Â Â å³ä¸‹è§’Â Â å·¦ä¸‹è§’;
</code></pre> </li>
<li> å››ä¸ªå€¼: ç¬¬ä¸€ä¸ªå€¼ä¸ºå·¦ä¸Šè§’ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºå³ä¸Šè§’ï¼Œç¬¬ä¸‰ä¸ªå€¼ä¸ºå³ä¸‹è§’ï¼Œç¬¬å››ä¸ªå€¼ä¸ºå·¦ä¸‹è§’ã€‚ -  ä¸‰ä¸ªå€¼: ç¬¬ä¸€ä¸ªå€¼ä¸ºå·¦ä¸Šè§’, ç¬¬äºŒä¸ªå€¼ä¸ºå³ä¸Šè§’å’Œå·¦ä¸‹è§’ï¼Œç¬¬ä¸‰ä¸ªå€¼ä¸ºå³ä¸‹è§’ -  ä¸¤ä¸ªå€¼: ç¬¬ä¸€ä¸ªå€¼ä¸ºå·¦ä¸Šè§’ä¸å³ä¸‹è§’ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºå³ä¸Šè§’ä¸å·¦ä¸‹è§’ -  ä¸€ä¸ªå€¼ï¼šå››ä¸ªåœ†è§’å€¼ç›¸åŒ </li>
</ul>
<p>2.ç›’å­é˜´å½±(box-shadow)</p>
<blockquote>
 <pre><code class="language-css">box-shadow:Â offset-xÂ offset-yÂ [blurÂ [spread]]Â [color]Â [inset]
</code></pre> 
 <table><thead>|å€¼|æè¿°
</blockquote>
</thead><tbody>|offset-x|é˜´å½±çš„æ°´å¹³åç§»é‡ã€‚æ­£æ•°å‘å³åç§»ï¼Œè´Ÿæ•°å‘å·¦åç§»ã€‚
|offset-y|é˜´å½±çš„å‚ç›´åç§»é‡ã€‚æ­£æ•°å‘ä¸‹åç§»ï¼Œè´Ÿæ•°å‘ä¸Šåç§»ã€‚
|blur|å¯é€‰ã€‚é˜´å½±æ¨¡ç³Šè·ç¦»ï¼Œä¸èƒ½å–è´Ÿæ•°ã€‚
|spread|å¯é€‰ã€‚é˜´å½±å¤§å°
|color|å¯é€‰ã€‚é˜´å½±çš„é¢œè‰²
|inset|å¯é€‰ã€‚è¡¨ç¤ºæ·»åŠ å†…é˜´å½±ï¼Œé»˜è®¤ä¸ºå¤–é˜´å½±
</tbody></table>
 <pre><code class="language-css">divÂ &#123;
Â Â Â width:Â 200px;
Â Â Â height:Â 200px;
Â Â Â border:Â 10pxÂ solidÂ red;
Â Â Â /*Â box-shadow:Â 5pxÂ 5pxÂ 3pxÂ 4pxÂ rgba(0,Â 0,Â 0,Â .4);Â Â */
Â Â Â /* box-shadow:æ°´å¹³ä½ç½®Â å‚ç›´ä½ç½®Â æ¨¡ç³Šè·ç¦»Â é˜´å½±å°ºå¯¸ï¼ˆå½±å­å¤§å°ï¼‰Â é˜´å½±é¢œè‰²Â Â å†…/å¤–é˜´å½±ï¼›Â */
Â Â Â box-shadow:Â 0Â 15pxÂ 30pxÂ Â rgba(0,Â 0,Â 0,Â .4);Â Â Â 
&#125;</code></pre> 


<p>Â </p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-clickhouseä¹‹è¡¨å’Œåˆ—çš„TTLè§„åˆ™ä¸å®è·µ"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/clickhouse%E4%B9%8B%E8%A1%A8%E5%92%8C%E5%88%97%E7%9A%84TTL%E8%A7%84%E5%88%99%E4%B8%8E%E5%AE%9E%E8%B7%B5/"
    >clickhouseä¹‹è¡¨å’Œåˆ—çš„TTLè§„åˆ™ä¸å®è·µ</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/clickhouse%E4%B9%8B%E8%A1%A8%E5%92%8C%E5%88%97%E7%9A%84TTL%E8%A7%84%E5%88%99%E4%B8%8E%E5%AE%9E%E8%B7%B5/" class="article-date">
  <time datetime="2021-07-18T14:12:50.359Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: clickhouseä¹‹è¡¨å’Œåˆ—çš„TTLè§„åˆ™ä¸å®è·µ<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”### 1.è¡¨å’Œåˆ—çš„TTL</p>
<blockquote>
<p> å®šä¹‰å€¼çš„ç”Ÿå‘½å‘¨æœŸ<br> å¯ä»¥ä¸ºæ•´ä¸ªè¡¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªå•ç‹¬çš„åˆ—è®¾ç½®ã€‚<br> è¡¨çº§çš„TTLä¹Ÿå¯ä»¥æŒ‡å®šåœ¨ç£ç›˜å’Œå·ä¹‹é—´è‡ªåŠ¨ç§»åŠ¨æ•°æ®çš„é€»è¾‘ã€‚<br> è®¾ç½®TTLçš„è¡¨ï¼Œå¿…é¡»åŒ…å«Dateæˆ–DateTimeç±»å‹çš„å­—æ®µã€‚<br> å®šä¹‰æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦åœ¨è¿™ä¸ªæ—¥æœŸå­—æ®µä½¿ç”¨æ“ä½œç¬¦ï¼š<br> <pre><code>TTL time_column<br>TTL time_column + interval<br></code></pre><br> ç¤ºä¾‹ï¼š<br> <pre><code>TTL date_time + INTERVAL 1 MONTH</p>
</blockquote>
<p>TTL date_time + INTERVAL 15 HOUR</code></pre> </p>
<h3 id="2-åˆ—çº§TTL"><a href="#2-åˆ—çº§TTL" class="headerlink" title="2.åˆ—çº§TTL"></a>2.åˆ—çº§TTL</h3><blockquote>
<p> å½“åˆ—ä¸­çš„å€¼è¿‡æœŸæ—¶ï¼ŒClickHouseå°†å®ƒä»¬æ›¿æ¢ä¸ºè¯¥åˆ—å¯¹åº”æ•°æ®ç±»å‹çš„é»˜è®¤å€¼ã€‚<br> å¦‚æœæ•°æ®ç‰‡æ®µä¸­æ‰€æœ‰åˆ—å€¼éƒ½è¿‡æœŸï¼Œåˆ™åˆ é™¤è¯¥æ•°æ®ç‰‡æ®µä¸‹çš„è¯¥åˆ—çš„æ–‡ä»¶ã€‚<br> TTLå­å¥ä¸èƒ½ç”¨äºkeyåˆ—ã€‚<br> ç¤ºä¾‹ï¼š </p>
</blockquote>
<ul>
<li>åˆ›å»ºTTLè¡¨- TTLè¿‡æœŸéªŒè¯- ç»™åˆ—å¢åŠ TTL- ä¿®æ”¹åˆ—çš„TTL</li>
</ul>
<h3 id="3-è¡¨çº§TTL"><a href="#3-è¡¨çº§TTL" class="headerlink" title="3.è¡¨çº§TTL"></a>3.è¡¨çº§TTL</h3><blockquote>
 <ol>- è¡¨çº§çš„TTLå®šä¹‰äº†è¿‡æœŸè¡Œçš„åˆ é™¤ã€ç£ç›˜å’Œå·ä¹‹é—´è‡ªåŠ¨ç§»åŠ¨æ•°æ®çš„é€»è¾‘ã€‚- ä¸€å¼ è¡¨å¯ä»¥å®šä¹‰ä¸€ä¸ªè¿‡æœŸè¡Œç§»é™¤çš„è¡¨è¾¾å¼å’Œå¤šä¸ªç£ç›˜å’Œå·ä¹‹é—´è‡ªåŠ¨ç§»åŠ¨æ•°æ®çš„é€»è¾‘çš„è¡¨è¾¾å¼ã€‚ TTL expr [DELETE|TO DISK 'aaa'|TO VOLUME 'bbb'], ...- å½“è¡¨ä¸­çš„æ•°æ®è¿‡æœŸæ—¶ï¼ŒClickHouseåˆ é™¤æ‰€æœ‰å¯¹åº”çš„è¡Œã€‚- TTLè§„åˆ™çš„ç±»å‹è·Ÿåœ¨æ¯ä¸ªTTLè¡¨è¾¾å¼åé¢ï¼Œå®ƒè¡¨ç¤ºè¡¨è¾¾å¼æ»¡è¶³åï¼ˆè¾¾åˆ°å½“å‰æ—¶é—´ï¼‰è¦æ‰§è¡Œçš„æ“ä½œã€‚**DELETE - åˆ é™¤è¿‡æœŸçš„è¡Œï¼ˆé»˜è®¤æ“ä½œï¼‰ï¼› TO DISK â€˜aaaâ€™ - å°†ç‰‡æ®µç§»è‡³ç£ç›˜aaaï¼› TO VOLUME â€˜bbbâ€™ - å°†ç‰‡æ®µç§»åŠ¨è‡³ç£ç›˜bbbï¼›**<li>åˆ›å»ºè¡¨ç¤ºä¾‹ï¼š <pre><code class="language-sql">CREATE TABLE example_table
(
    d DateTime, 
    a Int 
)ENGINE = MergeTree 
PARTITION BY toYYYYMM(d) 
ORDER BY d 
TTL d + INTERVAL 1 MONTH [DELETE], 
    d + INTERVAL 1 WEEK TO VOLUME 'aaa',
    d + INTERVAL 2 WEEK TO DISK 'bbb'
SETTINGS storage_policy = 'moving_from_ssd_to_hdd';
</code></pre> æ³¨æ„ï¼šå½“TTLè¡¨è¾¾å¼æŒ‡å®šäº†ç£ç›˜å’Œå·ä¹‹é—´ç§»åŠ¨æ•°æ®çš„é€»è¾‘ï¼Œé‚£ä¹ˆClickHouseçš„è¡¨å¿…é¡»æŒ‡å®šå­˜å‚¨ç­–ç•¥ï¼Œä¸”è¯¥å­˜å‚¨ç­–ç•¥ä¸­è¦åŒ…å«ç›¸åº”çš„ç£ç›˜å’Œå·ã€‚ </li>- **ä½¿ç”¨æ¡ˆä¾‹ï¼šTTLè¿‡æœŸåæ‰§è¡Œæ•°æ®åˆ é™¤æ¡ˆä¾‹ã€‚** 1).å½“ClickHouseåˆå¹¶æ•°æ®ç‰‡æ®µæ—¶ï¼Œ å°†åˆ é™¤TTLè¿‡æœŸçš„æ•°æ®ã€‚ 2).å½“ClickHouseå‘ç°æ•°æ®è¿‡æœŸæ—¶ï¼Œ å®ƒå°†æ‰§è¡Œä¸€ä¸ªè®¡åˆ’å¤–çš„åˆå¹¶ã€‚ è¦æ§åˆ¶è¿™ç±»åˆå¹¶çš„é¢‘ç‡ï¼Œ å¯è®¾ç½®å‚æ•° merge_with_ttl_timeoutã€‚å¦‚æœè¯¥å€¼è®¾ç½®çš„è¿‡ä½ï¼Œ å®ƒå°†å¯¼è‡´æ‰§è¡Œè®¸å¤šçš„è®¡åˆ’å¤–åˆå¹¶ï¼Œè¿™å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡èµ„æºã€‚ 3).å¦‚æœåœ¨åˆå¹¶çš„æ—¶å€™æ‰§è¡ŒSELECTæŸ¥è¯¢ï¼Œ åˆ™å¯èƒ½ä¼šå¾—åˆ°è¿‡æœŸçš„æ•°æ®ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œ å¯ä»¥åœ¨SELECT ä¹‹å‰ä½¿ç”¨OPTIMIZEæŸ¥è¯¢ã€‚</ol>
</blockquote>
<h3 id="4-åˆ—çº§TTLç¤ºä¾‹"><a href="#4-åˆ—çº§TTLç¤ºä¾‹" class="headerlink" title="4.åˆ—çº§TTLç¤ºä¾‹"></a>4.åˆ—çº§TTLç¤ºä¾‹</h3><blockquote>
 <ol><li>**åˆ›å»ºå¸¦TTLçš„è¡¨** <pre><code class="language-sql">DROP TABLE example_table;
CREATE TABLE example_table 
(
    d DateTime,
    a Int TTL d + INTERVAL 1 MINUTE,
    b String TTL d + INTERVAL 1 MINUTE,
    c String
)
ENGINE = MergeTree
ORDER BY d;
xxxxx :) show create table example_table;
</blockquote>
<p>SHOW CREATE TABLE example_table</p>
<p>â”Œâ”€statementâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ CREATE TABLE default.example_table<br>(<br>    <code>d</code> DateTime,<br>    <code>a</code> Int32 TTL d + toIntervalMinute(1),<br>    <code>b</code> String TTL d + toIntervalMinute(1),<br>    <code>c</code> String<br>)<br>ENGINE = MergeTree<br>ORDER BY d<br>SETTINGS index_granularity = 8192 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>1 rows in set. Elapsed: 0.007 sec. </p>
<p>xxxxx :)<br></code></pre> </li><li><strong>æ’å…¥æ•°æ®</strong> <pre><code class="language-sql">insert into example_table values (now(), 1, 'value1', 'ccc1');<br>insert into example_table values(now(), 2, 'value2', 'ccc2');<br></code></pre> ç­‰å¾…1åˆ†é’Ÿä¹‹åï¼Œæ‰§è¡Œï¼š <pre><code class="language-sql">xxxxx :) select * from example_table;</p>
<p>SELECT *<br>FROM example_table</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€dâ”€â”¬â”€aâ”€â”¬â”€bâ”€â”€â”€â”€â”€â”€â”¬â”€câ”€â”€â”€â”€â”<br>â”‚ 2020-11-26 14:53:16 â”‚ 2 â”‚ value2 â”‚ ccc2 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€dâ”€â”¬â”€aâ”€â”¬â”€bâ”€â”€â”€â”€â”€â”€â”¬â”€câ”€â”€â”€â”€â”<br>â”‚ 2020-11-26 14:53:15 â”‚ 1 â”‚ value1 â”‚ ccc1 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜</p>
<p>2 rows in set. Elapsed: 0.009 sec. </p>
<p>xxxxx :) optimize table example_table;</p>
<p>OPTIMIZE TABLE example_table</p>
<p>Ok.</p>
<p>0 rows in set. Elapsed: 0.004 sec. </p>
<p>xxxxx :) select * from example_table;</p>
<p>SELECT *<br>FROM example_table</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€dâ”€â”¬â”€aâ”€â”¬â”€bâ”€â”¬â”€câ”€â”€â”€â”€â”<br>â”‚ 2020-11-26 14:53:15 â”‚ 0 â”‚   â”‚ ccc1 â”‚<br>â”‚ 2020-11-26 14:53:16 â”‚ 0 â”‚   â”‚ ccc2 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜</p>
<p>2 rows in set. Elapsed: 0.007 sec. </p>
<p>xxxxx :)<br></code></pre> Â  </li><li><strong>ç»™è¡¨çš„åˆ—æ·»åŠ TTLï¼š</strong> <pre><code class="language-sql">ALTER TABLE example_table<br>MODIFY COLUMN<br>c String TTL d + INTERVAL 1 DAY;<br>xxxxx :) ALTER TABLE example_table<br>:-] MODIFY COLUMN<br>:-] c String TTL d + INTERVAL 1 DAY;</p>
<p>ALTER TABLE example_table<br>    MODIFY COLUMN <code>c</code> String TTL d + toIntervalDay(1)</p>
<p>Ok.</p>
<p>0 rows in set. Elapsed: 0.018 sec. </p>
<p>xxxxx :)<br></code></pre> ä¿®æ”¹åˆ—çš„TTLï¼š <pre><code class="language-sql">ALTER TABLE example_table<br>    MODIFY COLUMN<br>    c String TTL d + INTERVAL 1 MONTH;<br>xxxxx :) ALTER TABLE example_table<br>:-]     MODIFY COLUMN<br>:-]     c String TTL d + INTERVAL 1 MONTH;</p>
<p>ALTER TABLE example_table<br>    MODIFY COLUMN <code>c</code> String TTL d + toIntervalMonth(1)</p>
<p>Ok.</p>
<p>0 rows in set. Elapsed: 0.015 sec. </p>
<p>xxxxx :) show create table example_table;</p>
<p>SHOW CREATE TABLE example_table</p>
<p>â”Œâ”€statementâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ CREATE TABLE default.example_table<br>(<br>    <code>d</code> DateTime,<br>    <code>a</code> Int32 TTL d + toIntervalMinute(1),<br>    <code>b</code> String TTL d + toIntervalMinute(1),<br>    <code>c</code> String TTL d + toIntervalMonth(1)<br>)<br>ENGINE = MergeTree<br>ORDER BY d<br>SETTINGS index_granularity = 8192 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>1 rows in set. Elapsed: 0.004 sec. </p>
<p>xxxxx :)<br></code></pre> Â  </li></ol></p>
<h3 id="5-è¡¨çº§TTLç¤ºä¾‹"><a href="#5-è¡¨çº§TTLç¤ºä¾‹" class="headerlink" title="5.è¡¨çº§TTLç¤ºä¾‹"></a>5.è¡¨çº§TTLç¤ºä¾‹</h3><blockquote>
 <ol><li>**åˆ›å»ºè¡¨** <pre><code class="language-sql">drop table example_table ;
CREATE TABLE example_table 
(
    d DateTime,
    a Int,
    b String,
    c String
)
ENGINE = MergeTree
ORDER BY d
TTL d + INTERVAL 1 MINUTE DELETE;
</code></pre> </li><li>**æ’å…¥æ•°æ®** <pre><code class="language-sql">insert into example_table values (now(), 1, 'value1', 'ccc1');
insert into example_table values(now(), 2, 'value2', 'ccc2');
</code></pre> ç„¶åæŸ¥è¯¢ç»“æœï¼š <pre><code class="language-sql">xxxxx :) select * from example_table;
</blockquote>
<p>SELECT *<br>FROM example_table</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€dâ”€â”¬â”€aâ”€â”¬â”€bâ”€â”€â”€â”€â”€â”€â”¬â”€câ”€â”€â”€â”€â”<br>â”‚ 2020-11-26 15:24:53 â”‚ 1 â”‚ value1 â”‚ ccc1 â”‚<br>â”‚ 2020-11-26 15:24:54 â”‚ 2 â”‚ value2 â”‚ ccc2 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜</p>
<p>2 rows in set. Elapsed: 0.008 sec. </p>
<p>xxxxx :)<br></code></pre> ç­‰å¾…1åˆ†é’Ÿåï¼Œ æ‰§è¡Œoptimizeæ“ä½œã€‚ <pre><code class="language-sql">xxxxx :) optimize table example_table;</p>
<p>OPTIMIZE TABLE example_table</p>
<p>Ok.</p>
<p>0 rows in set. Elapsed: 0.006 sec. </p>
<p>xxxxx :) select * from example_table;</p>
<p>SELECT *<br>FROM example_table</p>
<p>Ok.</p>
<p>0 rows in set. Elapsed: 0.003 sec. </p>
<p>xxxxx :)<br></code></pre> Â  </li></ol></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-clickhouseä¹‹TSKVæ ¼å¼"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/clickhouse%E4%B9%8BTSKV%E6%A0%BC%E5%BC%8F/"
    >clickhouseä¹‹TSKVæ ¼å¼</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/clickhouse%E4%B9%8BTSKV%E6%A0%BC%E5%BC%8F/" class="article-date">
  <time datetime="2021-07-18T14:12:50.352Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: clickhouseä¹‹TSKVæ ¼å¼<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”# TSKVéœ€è¦äº†è§£çš„ç‚¹</p>
<ul>
<li>TSKVæ ¼å¼ä¸é€‚åˆæœ‰å¤§é‡å°åˆ—çš„è¾“å‡º.(å› ä¸ºæ¯ä¸€è¡Œéƒ½æ˜¯éœ€è¦è¾“å‡ºkeyï¼Œvalueï¼Œä¼šæ¯”è¾ƒæµªè´¹)- TSKVçš„æ•ˆç‡å¹¶ä¸æ¯”JSONEachRowå·®.- TSKVæ”¯æŒæ•°æ®æŸ¥è¯¢å’Œæ•°æ®å¯¼å…¥ã€‚- ä¸éœ€è¦ä¿è¯åˆ—çš„é¡ºåºã€‚- æ”¯æŒå¿½ç•¥æŸäº›å€¼ï¼Œè¿™äº›åˆ—ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¾‹å¦‚0å’Œç©ºç™½è¡Œã€‚å¤æ‚ç±»å‹çš„å€¼å¿…é¡»æŒ‡å®šï¼Œæ— æ³•ä½¿ç”¨é»˜è®¤å€¼ã€‚<h2 id="æ•°æ®çš„æŸ¥è¯¢"><a href="#æ•°æ®çš„æŸ¥è¯¢" class="headerlink" title="æ•°æ®çš„æŸ¥è¯¢"></a>æ•°æ®çš„æŸ¥è¯¢</h2></li>
</ul>
<blockquote>
</blockquote>
<ul>
<li>å¸¸è§„çš„æ•°æ®æŸ¥è¯¢<img alt="" height="473" src="https://img-blog.csdnimg.cn/20210411120539536.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="719">- ä½¿ç”¨TSKVæ ¼å¼åŒ–ä¹‹åçš„æŸ¥è¯¢ å‘½ä»¤ï¼š<strong>select * from escape_demo format TSKV;</strong><img alt="" height="434" src="https://img-blog.csdnimg.cn/202104111206194.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="828"> å¯ä»¥å‘ç°æ¯ä¸ªæ•°æ®å‰é¢éƒ½æ‹¼æ¥ä¸Šäº†å­—æ®µåç§°ã€‚</li>
</ul>
<h2 id="æ•°æ®çš„å¯¼å‡º"><a href="#æ•°æ®çš„å¯¼å‡º" class="headerlink" title="æ•°æ®çš„å¯¼å‡º"></a>æ•°æ®çš„å¯¼å‡º</h2><blockquote>
<p> å‘½ä»¤ï¼šclickhouse-client â€“query â€œselect * from tutorial.escape_demo FORMAT TSKVâ€ &gt; tskv.demo </p>
</blockquote>
<h3 id="æŸ¥çœ‹å¯¼å‡ºæ•°æ®"><a href="#æŸ¥çœ‹å¯¼å‡ºæ•°æ®" class="headerlink" title="æŸ¥çœ‹å¯¼å‡ºæ•°æ®"></a>æŸ¥çœ‹å¯¼å‡ºæ•°æ®</h3><img alt="" height="269" src="https://img-blog.csdnimg.cn/20210411122533734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="807">

<h2 id="æ•°æ®çš„å¯¼å…¥"><a href="#æ•°æ®çš„å¯¼å…¥" class="headerlink" title="æ•°æ®çš„å¯¼å…¥"></a>æ•°æ®çš„å¯¼å…¥</h2><blockquote>
<p> å‘½ä»¤ï¼šclickhouse-client â€“query â€œinsert into tutorial.escape_demo FORMAT TSKVâ€ &lt; tskv.demo </p>
</blockquote>
<h3 id="æŸ¥çœ‹æ•°æ®çš„å¯¼å…¥"><a href="#æŸ¥çœ‹æ•°æ®çš„å¯¼å…¥" class="headerlink" title="æŸ¥çœ‹æ•°æ®çš„å¯¼å…¥"></a>æŸ¥çœ‹æ•°æ®çš„å¯¼å…¥</h3><img alt="" height="631" src="https://img-blog.csdnimg.cn/20210411123055692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="724">

<p>å¯ä»¥å‘ç°ä¸Šé¢çš„æ•°æ®å‘ç”Ÿäº†ç¿»å€ã€‚</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-clickhouseç®—æœ¯å‡½æ•°"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/clickhouse%E7%AE%97%E6%9C%AF%E5%87%BD%E6%95%B0/"
    >clickhouseç®—æœ¯å‡½æ•°</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/clickhouse%E7%AE%97%E6%9C%AF%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2021-07-18T14:12:50.344Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: clickhouseç®—æœ¯å‡½æ•°<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”&gt;<br> <pre><code class="language-sql">--æ±‚å’Œ<br>SELECT plus(12, 21), plus(10, -10), plus(-10, -10);<br>+------------+-------------+--------------+<br>|plus(12, 21)|plus(10, -10)|plus(-10, -10)|<br>+------------+-------------+--------------+<br>|33          |0            |-20           |<br>+------------+-------------+--------------+</p>
<p>â€“å·®å€¼<br>SELECT minus(10, 5), minus(10, -10), minus(-10, -10);<br>+â€”â€”â€”â€”+â€”â€”â€”â€”â€“+â€”â€”â€”â€”â€”+<br>|minus(10, 5)|minus(10, -10)|minus(-10, -10)|<br>+â€”â€”â€”â€”+â€”â€”â€”â€”â€“+â€”â€”â€”â€”â€”+<br>|5           |20            |0              |<br>+â€”â€”â€”â€”+â€”â€”â€”â€”â€“+â€”â€”â€”â€”â€”+</p>
<p>â€“ç§¯<br>SELECT multiply(12, 2), multiply(12, -2), multiply(-12, -2);<br>+â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€“+<br>|multiply(12, 2)|multiply(12, -2)|multiply(-12, -2)|<br>+â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€“+<br>|24             |-24             |24               |<br>+â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€“+</p>
<p>â€“å¹³å‡å€¼<br>SELECT divide(12, 4), divide(10, 3), divide(2, 4), divide(-4, -2), divide(-4, 2), divide(-4.5, 3);<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”+â€”â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”+<br>|divide(12, 4)|divide(10, 3)     |divide(2, 4)|divide(-4, -2)|divide(-4, 2)|divide(-4.5, 3)|<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”+â€”â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”+<br>|3            |3.3333333333333335|0.5         |2             |-2           |-1.5           |<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”+â€”â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”+</p>
<p>SELECT intDiv(10, 3), divide(10, 3);<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”+<br>|intDiv(10, 3)|divide(10, 3)     |<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”+<br>|3            |3.3333333333333335|<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”+</p>
<p>SELECT divide(10, 0), divide(-10, 0); â€“ å‡ºç°æ— ç©·å¤§å­—ç¬¦â€œ âˆ â€æˆ–â€œ -âˆ â€<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€“+<br>|divide(10, 0)|divide(-10, 0)|<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€“+<br>|âˆ            |-âˆ            |<br>+â€”â€”â€”â€”-+â€”â€”â€”â€”â€“+</p>
<p>SELECT divide(0, 0); â€“ ç‰¹æ®Šå­—ç¬¦ï¼ˆç±»ä¼¼ä¹±ç ï¼‰<br>+â€”â€”â€”â€”+<br>|divide(0, 0)|<br>+â€”â€”â€”â€”+<br>|NaN         |<br>+â€”â€”â€”â€”+</p>
<p>SELECT intDivOrZero(10, 0);<br>â€“ 0<br>+â€”â€”â€”â€”â€”â€”-+<br>|intDivOrZero(10, 0)|<br>+â€”â€”â€”â€”â€”â€”-+<br>|0                  |<br>+â€”â€”â€”â€”â€”â€”-+</p>
<p>â€“æ±‚ä½™æ•°<br>SELECT modulo(10, 3); â€“1<br>+â€”â€”â€”â€”-+<br>|modulo(10, 3)|<br>+â€”â€”â€”â€”-+<br>|1            |<br>+â€”â€”â€”â€”-+</p>
<p>SELECT modulo(10.5, 3);<br>+â€”â€”â€”â€”â€”+<br>|modulo(10.5, 3)|<br>+â€”â€”â€”â€”â€”+<br>|1              |<br>+â€”â€”â€”â€”â€”+</p>
<p>â€“å–å<br>SELECT negate(10), negate(-10);<br>+â€”â€”â€”-+â€”â€”â€”â€“+<br>|negate(10)|negate(-10)|<br>+â€”â€”â€”-+â€”â€”â€”â€“+<br>|-10       |10         |<br>+â€”â€”â€”-+â€”â€”â€”â€“+</p>
<p>â€“ç»å¯¹å€¼<br>SELECT abs(-10), abs(10);<br>+â€”â€”â€“+â€”â€”-+<br>|abs(-10)|abs(10)|<br>+â€”â€”â€“+â€”â€”-+<br>|10      |10     |<br>+â€”â€”â€“+â€”â€”-+</p>
<p>â€“æœ€å¤§å…¬çº¦æ•°<br>SELECT gcd(12, 24), gcd(-12, -24), gcd(-12, 24);<br>+â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”â€”+<br>|gcd(12, 24)|gcd(-12, -24)|gcd(-12, 24)|<br>+â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”â€”+<br>|12         |12           |12          |<br>+â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”â€”+</p>
<p>â€“æœ€å°å…¬å€æ•°<br>SELECT lcm(12, 24), lcm(-12, -24), lcm(-3, 4);<br>+â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”-+<br>|lcm(12, 24)|lcm(-12, -24)|lcm(-3, 4)|<br>+â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”-+<br>|24         |24           |12        |<br>+â€”â€”â€”â€“+â€”â€”â€”â€”-+â€”â€”â€”-+</p>
<p></code></pre> 
 Â  </p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-ClickHouseæ•°æ®æŸ¥è¯¢"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/ClickHouse%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/"
    >ClickHouseæ•°æ®æŸ¥è¯¢</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/ClickHouse%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/" class="article-date">
  <time datetime="2021-07-18T14:12:50.334Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: ClickHouseæ•°æ®æŸ¥è¯¢<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”### 1.æŸ¥è¯¢è¯­æ³•</p>
<blockquote>
 <pre><code class="language-sql">[WITH expr_list|(subquery)]
SELECT [DISTINCT] expr_list
[FROM [db.]table | (subquery) | table_function] [FINAL]
[SAMPLE sample_coeff]
[ARRAY JOIN ...]
[GLOBAL] [ANY|ALL|ASOF] [INNER|LEFT|RIGHT|FULL|CROSS] [OUTER|SEMI|ANTI] JOIN (subquery)|table (ON &lt;expr_list&gt;)|(USING &lt;column_list&gt;)
[PREWHERE expr]
[WHERE expr]
[GROUP BY expr_list] [WITH TOTALS]
[HAVING expr]
[ORDER BY expr_list] [WITH FILL] [FROM expr] [TO expr] [STEP expr]
[LIMIT [offset_value, ]n BY columns]
[LIMIT [n, ]m] [WITH TIES]
[UNION ALL ...]
[INTO OUTFILE filename]
[FORMAT format]
</blockquote>
<p></code></pre><br> å¯ä»¥çœ‹åˆ°ClickHouseçš„SELECTè¯­å¥çš„è¯­æ³•å’Œé€šç”¨çš„SQLçš„SELECTè¯­å¥éå¸¸ç±»ä¼¼ï¼ŒåŒ…æ‹¬ï¼š </p>
<ul>
<li>SELECT: æŒ‡å®šè¿”å›ç»“æœå­—æ®µ- DISTINCTï¼šå»é‡- FROM: æŒ‡å®šè¦æŸ¥è¯¢çš„è¡¨æˆ–å­æŸ¥è¯¢- JOINï¼šè¡¨è¿æ¥ï¼Œæ”¯æŒå†…è¿æ¥å’Œå¤–è¿æ¥ã€å·¦è¿æ¥å’Œå³è¿æ¥- WHEREï¼šç­›é€‰æ¡ä»¶- GROUP BYï¼šåˆ†ç»„ï¼Œå’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨- HAVINGï¼šåˆ†ç»„åç­›é€‰- ORDER BYï¼šæ’åº- LIMITï¼šé™åˆ¶è¿”å›è®°å½•æ•°- UNION ALLï¼šå¹¶é›†ï¼›ClickHouseç›®å‰åªæ”¯æŒUNION ALLï¼Œè¿˜ä¸æ”¯æŒUNION<br>ClickHouseçš„SELECTè¯­å¥ä¸­ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šçš„ç”¨æ³•ï¼š </li>
<li>WITH: è®¾ç½®æŸ¥è¯¢ä¸­è¦ç”¨åˆ°çš„å˜é‡- SAMPLE: æ•°æ®å–æ ·ï¼Œç±»ä¼¼Pandasåº“çš„sample()å‡½æ•°- PREWHERE: é¢„ç­›é€‰ï¼Œèµ·åˆ°æå‡æ€§èƒ½ä½œç”¨- ARRAY JOINï¼šæ•°ç»„è¿æ¥ï¼Œç”¨æ¥å±•å¼€æ•°ç»„æˆ–åµŒå¥—å­—æ®µï¼Œä¸€è¡Œå˜å¤šè¡Œ- LIMIT BY: åˆ†ç»„ï¼Œå†ä»æ¯ç»„ä¸­å–å‰næ¡è®°å½•- INTO OUTFILE: å¯¼å‡ºè¡¨æ•°æ®åˆ°æ–‡ä»¶ï¼Œå†ç”¨FORMATæŒ‡å®šæ–‡ä»¶æ ¼å¼</li>
</ul>
<h3 id="2-WITHå­å¥"><a href="#2-WITHå­å¥" class="headerlink" title="2.WITHå­å¥"></a>2.WITHå­å¥</h3><blockquote>
 <pre><code class="language-sql">-- åœ¨WITHå­å¥ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡å¹¶èµ‹å€¼ï¼Œç„¶ååœ¨SELECTå­å¥ä¸­é€šè¿‡åˆ«åä½¿ç”¨è¯¥å˜é‡
with '2014-03-17' as dt \
select count(1) from hits_v1 where EventDate = dt;
</blockquote>
<p>â€“ åœ¨WITHå­å¥ä¸­å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨SELECTå­å¥ä¸­é€šè¿‡åˆ«åä½¿ç”¨è¯¥å‡½æ•°<br>with round(Duration / 60)as duration_minutes <br>select StartDate, max(duration_minutes) as max_duration_minutes from visits_v1 <br>group by StartDate, Duration <br>order by max_duration_minutes desc <br>limit 10;</p>
<p>â€“ åœ¨WITHå­å¥ä¸­å®šä¹‰ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œç„¶ååœ¨SELECTå­å¥ä¸­é€šè¿‡åˆ«åä½¿ç”¨è¯¥å­æŸ¥è¯¢<br>â€“ è¯¥å­æŸ¥è¯¢åªèƒ½è¿”å›ä¸€è¡Œæ•°æ®<br>with ( <br>  select sum(Duration) from visits_v1 <br>) as total_duration <br>select StartDate, sum(Duration) / total_duration as duration_percentage from visits_v1 <br>group by StartDate, Duration <br>limit 10;</p>
<p></code></pre><br> <h3>Â </h3> </p>
<h3 id="3-SAMPLEå­å¥"><a href="#3-SAMPLEå­å¥" class="headerlink" title="3.SAMPLEå­å¥"></a>3.SAMPLEå­å¥</h3><blockquote>
<p> å¯¹ä½¿ç”¨äº†MergeTreeè¡¨å¼•æ“çš„è¡¨ï¼Œå¹¶ä¸”è®¾ç½®äº†SAMPLE BYçš„è¡¨ï¼Œå¯ä»¥ä½¿ç”¨SAMPLEå­å¥æ¥å¯¹æ•°æ®è¿›è¡ŒæŠ½æ ·ã€‚<br> è¡¨ä¾‹å­ï¼š<br> <pre><code class="language-sql">CREATE TABLE tutorial.hits_v1 \<br>(<br>  ...<br>)<br>ENGINE = MergeTree() \<br>PARTITION BY toYYYYMM(EventDate) \<br>ORDER BY (CounterID, EventDate, intHash32(UserID)) \<br>SAMPLE BY intHash32(UserID) \<br>SETTINGS index_granularity = 8192;</p>
</blockquote>
<p></code></pre><br> hits_v1è¡¨ä½¿ç”¨MergeTreeè¡¨å¼•æ“ï¼Œå¹¶ä¸”SAMPLE BYä¸ºå°†UserIDè½¬æ¢æˆ32ä½çš„Hashå€¼ã€‚<br> <img alt="" height="276" src="https://img-blog.csdnimg.cn/20210428212535801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"><br> SAMPLEå­å¥ç¤ºä¾‹ï¼š<br> <pre><code class="language-sql">-- æŒ‰æ¯”ä¾‹é‡‡æ ·<br>-- é‡‡æ ·ç»“æœè®°å½•æ•°<br>select count(1) from hits_v1 sample 0.1<br>-- é‡‡æ ·æ•°æ®ï¼Œé»˜è®¤é™åˆ¶è¿”å›10000æ¡<br>select CounterID, UserID, EventDate, EventTime  from hits_v1 sample 0.1<br>-- é‡‡æ ·æ•°æ®ï¼Œé™åˆ¶è¿”å›10æ¡<br>select CounterID, UserID, EventDate, EventTime  from hits_v1 sample 0.1 limit 10</p>
<p>â€“ æŒ‰è®°å½•æ•°é‡‡æ ·<br>â€“ é‡‡æ ·è®°å½•æ•°è¾ƒå°æ—¶ï¼Œé‡‡æ ·ç»“æœæ•°æ®ä¸º0æ¡<br>select count(1) from hits_v1 sample 100<br>â€“ é‡‡æ ·è®°å½•æ•°å¤§è¿‡ç´¢å¼•ç²’åº¦æ—¶ï¼Œé‡‡æ ·ç»“æœæ•°æ®è®°å½•æ•°æ¥è¿‘é‡‡æ ·è®°å½•æ•°<br>elect count(1) from hits_v1 sample 10000<br>â€“ é‡‡æ ·æ•°æ®ï¼Œé»˜è®¤é™åˆ¶è¿”å›10000æ¡<br>select CounterID, UserID, EventDate, EventTime  from hits_v1 sample 20000<br>â€“ é‡‡æ ·æ•°æ®ï¼Œé™åˆ¶è¿”å›10æ¡<br>select CounterID, UserID, EventDate, EventTime  from hits_v1 sample 20000 limit 10</p>
<p>â€“ æŒ‰æ¯”ä¾‹å’Œåç§»é‡é‡‡æ ·ï¼Œç±»ä¼¼äºæŒ‰æ¯”ä¾‹é‡‡æ ·<br>select CounterID, UserID, EventDate, EventTime  from hits_v1 sample 0.1 offset 0.3 limit 10<br></code></pre><br> SAMPLEå­å¥æ•°æ®é‡‡æ ·å…·æœ‰å¹‚ç­‰æ€§å’Œè¿‘ä¼¼æ€§çš„ç‰¹ç‚¹ï¼š </p>
<ul>
<li>å¹‚ç­‰æ€§ï¼šé‡‡æ ·æ¡ä»¶ä¸å˜æ—¶ï¼Œä¸¤æ¬¡é‡‡æ ·çš„ç»“æœ<strong>å¯èƒ½</strong>ä¸€æ ·- è¿‘ä¼¼æ€§ï¼šé‡‡æ ·èŒƒå›´å’Œé‡‡æ ·ç»“æœä¸ä¿è¯ç²¾ç¡®</li>
</ul>
<h3 id="4-PREWHEREå­å¥"><a href="#4-PREWHEREå­å¥" class="headerlink" title="4.PREWHEREå­å¥"></a>4.PREWHEREå­å¥</h3><blockquote>
<p> åªæœ‰MergeTreeè¡¨å¼•æ“çš„è¡¨æ‰èƒ½ä½¿ç”¨PREWHEREå­å¥ï¼Œå¯ä»¥å°†PREWHEREçœ‹ä½œæ˜¯ClickHouseå¯¹WHEREå­å¥çš„ä¼˜åŒ–ã€‚<br> ClickHouseé»˜è®¤å°†WHEREè‡ªåŠ¨ä¼˜åŒ–ä¸ºPREWHERE:<br> <pre><code class="language-sql">-- optimize_move_to_prewhereä¸º1æ—¶ï¼Œè¡¨ç¤ºå¼€å§‹PREWHEREè‡ªåŠ¨ä¼˜åŒ–<br>select name, value from system.settings where name like '%prewhere%'<br></code></pre> 
 Â  </p>
</blockquote>
<h3 id="5-ARRAY-JOINå­å¥"><a href="#5-ARRAY-JOINå­å¥" class="headerlink" title="5.ARRAY JOINå­å¥"></a>5.ARRAY JOINå­å¥</h3><blockquote>
<p> å¯ä»¥ç”¨ARRAY JOINå­å¥æ¥å¯¹æ•°ç»„ï¼ˆArrayï¼‰æˆ–åµŒå¥—ï¼ˆNestedï¼‰ç±»å‹åšé“¾æ¥æŸ¥è¯¢ï¼Œå¯ä»¥å°†ä¸€è¡Œæ•°ç»„å±•æˆå¤šè¡Œã€‚<br> ARRAY JOINæ•°ç»„ç¤ºä¾‹ï¼š<br> <pre><code class="language-sql">-- ä¸ä½¿ç”¨ARRAY JOIN<br>select WatchID, RefererCategories from hits_v1 where WatchID = 4944118417295196513</p>
</blockquote>
<p>â€“ ç»“æœï¼š<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€WatchIDâ”€â”¬â”€RefererCategoriesâ”€â”<br>â”‚ 4944118417295196513 â”‚ [6,98,456,8586]   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>â€“ ä½¿ç”¨ARRAY JOIN<br>select WatchID, RefererCategories <br>from hits_v1 <br>array join RefererCategories <br>where WatchID = 4944118417295196513;</p>
<p>â€“ ç»“æœï¼š<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€WatchIDâ”€â”¬â”€RefererCategoriesâ”€â”<br>â”‚ 4944118417295196513 â”‚                 6 â”‚<br>â”‚ 4944118417295196513 â”‚                98 â”‚<br>â”‚ 4944118417295196513 â”‚               456 â”‚<br>â”‚ 4944118417295196513 â”‚              8586 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p></code></pre><br> ARRAY JOINåµŒå¥—ç±»å‹ç¤ºä¾‹ï¼š<br> <pre><code class="language-sql">-- ä¸ä½¿ç”¨ARRAY JOIN<br>select WatchID, ParsedParams.Key1, ParsedParams.Key2 from hits_v1 where WatchID = 5024825574842900819</p>
<p>â€“ ç»“æœï¼š<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€WatchIDâ”€â”¬â”€ParsedParams.Key1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ParsedParams.Key2â”€â”€â”€â”<br>â”‚ 5024825574842900819 â”‚ [â€˜gen_timestampâ€™,â€™Toolbarâ€™] â”‚ [â€˜groupâ€™,â€™trueâ€ /â€˜] â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>â€“ ä½¿ç”¨ARRAY JOIN<br>select WatchID, ParsedParams.Key1, ParsedParams.Key2 <br>from hits_v1 <br>array join ParsedParams <br>where WatchID = 5024825574842900819;</p>
<p>â€“ ç»“æœï¼š<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€WatchIDâ”€â”¬â”€ParsedParams.Key1â”€â”¬â”€ParsedParams.Key2â”€â”<br>â”‚ 5024825574842900819 â”‚ gen_timestamp     â”‚ group             â”‚<br>â”‚ 5024825574842900819 â”‚ Toolbar           â”‚ trueâ€ /           â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p></code></pre><br> ARRAY JOINä¹Ÿæ”¯æŒå·¦è¿æ¥æ¥<code>LEFT ARRAY JOIN</code>ã€‚ </p>
<h3 id="6-LIMIT-BYå­å¥"><a href="#6-LIMIT-BYå­å¥" class="headerlink" title="6.LIMIT BYå­å¥"></a>6.LIMIT BYå­å¥</h3><blockquote>
<p> LIMIT BYå­å¥ä¸åŒäºé€šç”¨SQLçš„LIMITå­å¥ã€‚<br> <code>LIMIT n BY expression</code>Â å¯¹SELECTç»“æœå…ˆæŒ‰expressionåˆ†ç»„ï¼Œå†åœ¨æ¯ç»„é‡Œé€‰å‡ºå‰nä¸ªï¼Œç±»ä¼¼åˆ†ç±»æ’è¡Œæ¦œçš„æ¦‚å¿µã€‚<br> ç¤ºä¾‹ï¼š<br> <pre><code class="language-sql">CREATE TABLE limit_by(id Int, val Int) ENGINE = Memory;<br>INSERT INTO limit_by VALUES (1, 10), (1, 11), (1, 12), (2, 20), (2, 21), (2, 22), (3, 31);<br></code></pre><br> <pre><code class="language-sql">-- æ’åº<br>SELECT * FROM limit_by ORDER BY id, val</p>
</blockquote>
<p>â”Œâ”€idâ”€â”¬â”€valâ”€â”<br>â”‚  1 â”‚  10 â”‚<br>â”‚  1 â”‚  11 â”‚<br>â”‚  1 â”‚  12 â”‚<br>â”‚  2 â”‚  20 â”‚<br>â”‚  2 â”‚  21 â”‚<br>â”‚  2 â”‚  22 â”‚<br>â”‚  3 â”‚  31 â”‚<br>â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜</p>
<p>â€“ åˆ†ç±»æ’åºï¼Œå†åœ¨æ¯ä¸ªåˆ†ç»„å†…å–å‰2æ¡è®°å½•<br>SELECT * FROM limit_by ORDER BY id, val LIMIT 2 BY id</p>
<p>â”Œâ”€idâ”€â”¬â”€valâ”€â”<br>â”‚  1 â”‚  10 â”‚<br>â”‚  1 â”‚  11 â”‚<br>â”‚  2 â”‚  20 â”‚<br>â”‚  2 â”‚  21 â”‚<br>â”‚  3 â”‚  31 â”‚<br>â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜</p>
<p>â€“ æ³¨æ„ï¼Œä¸LIMIT 2çš„ä¸åŒ<br>SELECT * FROM limit_by ORDER BY id, val LIMIT 2</p>
<p>â”Œâ”€idâ”€â”¬â”€valâ”€â”<br>â”‚  1 â”‚  10 â”‚<br>â”‚  1 â”‚  11 â”‚<br>â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜</p>
<p></code></pre><br> LIMIT BYå­å¥ä¹Ÿæ”¯æŒåç§»é‡ï¼š<code>LIMIT n OFFSET m BY exression</code> </p>
<h3 id="7-INTO-OUTFILEå­å¥"><a href="#7-INTO-OUTFILEå­å¥" class="headerlink" title="7.INTO OUTFILEå­å¥"></a>7.INTO OUTFILEå­å¥</h3><blockquote>
<p> ClickHouseçš„INTO OUTFILEå­å¥ä¸MySQLçš„INTO OUTFILEå­å¥ç±»ä¼¼ã€‚<br> <pre><code class="language-sql">-- è¾“å‡ºåˆ°å½“å‰ç›®å½•<br>-- é»˜è®¤æ ¼å¼ä¸ºTSV<br>-- æ³¨æ„æ–‡ä»¶åå¿…é¡»ç”¨å•å¼•å·æ¥æ‹¬èµ·æ¥ï¼Œä¸”ä¸èƒ½ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šExpected string literal<br>-- ç›®å½•ä¸‹ä¸èƒ½å­˜åœ¨åŒåæ–‡ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥é”™<br>select WatchID, JavaEnable, EventDate  from hits_v1 limit 10 into outfile 'test.tsv'</p>
</blockquote>
<p>â€“ è®¾ç½®æ ¼å¼ä¸ºCSVï¼ŒCSVéœ€è¦ä¸ºå…¨å¤§å°<br>select WatchID, JavaEnable, EventDate  from hits_v1 limit 10 into outfile â€˜out.csvâ€™ format CSV<br></code></pre> 
 Â  </p>
<h3 id="8-æ‰§è¡Œè®¡åˆ’"><a href="#8-æ‰§è¡Œè®¡åˆ’" class="headerlink" title="8.æ‰§è¡Œè®¡åˆ’"></a>8.æ‰§è¡Œè®¡åˆ’</h3><blockquote>
 <h3>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</h3> 
 å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼š 
 <ol>- ç›´æ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼š ch --send_logs_level=trace &lt;&lt;&lt; 'select * from tutorial.hits_v1' &gt; /dev/null <li>å¯ä»¥å°†ä»¥ä¸‹å†…å®¹ä¿æŒåˆ°ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œæ¯”å¦‚`chx.sh`ä¸­ï¼š <pre><code class="language-bash">#!/bin/bash
</blockquote>
<p>clickhouse-client â€“send_logs_level=trace &lt;&lt;&lt; â€œ$1â€ &gt; /dev/null<br></code></pre> å†é€šè¿‡<code>bash chi.sh &quot;select * from tutorial.hits_v1&quot;</code>Â æ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€‚ </li>- ä¹Ÿå¯ä»¥åœ¨clickhouse-clientæ‰§è¡ŒsqlåŒæ—¶ï¼Œç”¨<code>tail -f clickhouse-server.log</code>Â æŸ¥çœ‹clickhouse-serverçš„æ—¥å¿—ã€‚</ol><br> <h3>æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹</h3><br> <code>select * from tutorial.hits_v1</code>çš„æ‰§è¡Œè®¡åˆ’æ—¥å¿—ç¤ºä¾‹ï¼š<br> <pre><code class="language-bash">&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): Key condition: unknown<br>&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): MinMax index condition: unknown<br>&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): Selected 9 parts by date, 9 parts by key, 1094 marks to read from 9 ranges<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_1_6_1, approx. 1900000 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_7_12_1, approx. 1900000 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_13_18_1, approx. 1800000 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_19_24_1, approx. 1800000 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_25_25_0, approx. 303104 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_26_26_0, approx. 303104 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_27_27_0, approx. 303104 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_28_28_0, approx. 303104 rows starting from 0<br>&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_29_29_0, approx. 278528 rows starting from 0<br>&lt;Trace&gt; InterpreterSelectQuery: FetchColumns -&gt; Complete<br>&lt;Information&gt; executeQuery: Read 8873898 rows, 7.88 GiB in 47.964 sec., 185011 rows/sec., 168.22 MiB/sec.<br>&lt;Debug&gt; MemoryTracker: Peak memory usage (for query): 204.54 MiB.<br></code></pre><br> <strong>è¯´æ˜ï¼š</strong> </p>
<ul>
<li><strong>Key condition: unknownï¼šæ²¡æœ‰ä½¿ç”¨ä¸»é”®ç´¢å¼•ã€‚</strong>- <strong>MinMax index condition: unknownï¼š æ²¡æœ‰ä½¿ç”¨åˆ†åŒºç´¢å¼•ã€‚</strong>- <strong>Selected 9 parts by date, 9 parts by key, 1094 marks to read from 9 rangesï¼š å…±æ‰«æäº†9ä¸ªåˆ†åŒºï¼Œå…±1094ä¸ªmarkã€‚</strong>- <strong>Read 8873898 rows, 7.88 GiB in 47.964 sec., 185011 rows/sec., 168.22 MiB/sec.: è¯»å–äº†8873898è¡Œæ•°æ®ï¼Œæ•°æ®å¤§å°ä¸º7.88GBï¼Œç”¨æ—¶47.964ç§’ã€‚</strong>- <strong>Peak memory usage (for query): 204.54 MiB.: å†…å­˜å³°å€¼ï¼ˆæœ€å¤§å†…å­˜ä½¿ç”¨é‡ï¼‰ä¸º204.54MBã€‚</strong><br>å°†SQLæ”¹ä¸ºåªè¿”å›ä¸€ä¸ªå­—æ®µ<code>select WatchID from tutorial.hits_v1</code>ï¼Œå†æ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼š <pre><code class="language-sql">&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): Key condition: unknown
&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): MinMax index condition: unknown
&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): Selected 9 parts by date, 9 parts by key, 1094 marks to read from 9 ranges
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_1_6_1, approx. 1900000 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_7_12_1, approx. 1900000 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_13_18_1, approx. 1800000 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_19_24_1, approx. 1800000 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_25_25_0, approx. 303104 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_26_26_0, approx. 303104 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_27_27_0, approx. 303104 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_28_28_0, approx. 303104 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 1 ranges from part 201403_29_29_0, approx. 278528 rows starting from 0
&lt;Trace&gt; InterpreterSelectQuery: FetchColumns -&gt; Complete
&lt;Information&gt; executeQuery: Read 8873898 rows, 67.70 MiB in 0.318 sec., 27892532 rows/sec., 212.80 MiB/sec.
&lt;Debug&gt; MemoryTracker: Peak memory usage (for query): 12.32 MiB.
</code></pre> 
å‡ ä¸ªå˜åŒ–ï¼š </li>
<li>Read 8873898 rows, 67.70 MiB in 0.318 sec., 27892532 rows/sec., 212.80 MiB/sec.: æ•°æ®å¤§å°ä»7.88GBå‡å°åˆ°67.70MBï¼Œç”¨æ—¶ä»47.964ç§’å‡å°åˆ°0.318ç§’ã€‚- Peak memory usage (for query): 12.32 MiB.: å†…å­˜å³°å€¼ä»204.54MBå‡å°åˆ°12.32MBã€‚<br>å†å°†SQLæ”¹ä¸ºæŒ‡å®šåˆ†åŒºæŸ¥è¯¢ï¼š <pre><code class="language-sql">select WatchID from tutorial.hits_v1 where EventDate = '2014-03-17'
</code></pre> 
æ‰§è¡Œè®¡åˆ’æ—¥å¿—ï¼šÂ  <pre><code class="language-bash">&lt;Debug&gt; executeQuery: (from 127.0.0.1:48102) SELECT WatchID FROM tutorial.hits_v1 WHERE EventDate = '2014-03-17'
&lt;Debug&gt; InterpreterSelectQuery: MergeTreeWhereOptimizer: condition "EventDate = '2014-03-17'" moved to PREWHERE
&lt;Trace&gt; ContextAccess (default): Access granted: SELECT(WatchID, EventDate) ON tutorial.hits_v1
&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): Key condition: (column 1 in [16146, 16146])
&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): MinMax index condition: (column 0 in [16146, 16146])
&lt;Debug&gt; tutorial.hits_v1 (SelectExecutor): Selected 9 parts by date, 9 parts by key, 833 marks to read from 72 ranges
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 14 ranges from part 201403_1_6_1, approx. 818656, up to 818656 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 14 ranges from part 201403_7_12_1, approx. 1621472, up to 1621472 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 15 ranges from part 201403_13_18_1, approx. 1349440, up to 1349440 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 14 ranges from part 201403_19_24_1, approx. 1619776, up to 1619776 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 4 ranges from part 201403_25_25_0, approx. 278528, up to 278528 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 3 ranges from part 201403_26_26_0, approx. 286720, up to 286720 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 2 ranges from part 201403_27_27_0, approx. 294912, up to 294912 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 3 ranges from part 201403_28_28_0, approx. 229376, up to 229376 rows starting from 0
&lt;Trace&gt; MergeTreeSelectProcessor: Reading 3 ranges from part 201403_29_29_0, approx. 253952, up to 253952 rows starting from 0
&lt;Trace&gt; InterpreterSelectQuery: FetchColumns -&gt; Complete
&lt;Information&gt; executeQuery: Read 6735786 rows, 61.49 MiB in 0.097 sec., 69655325 rows/sec., 635.86 MiB/sec.
&lt;Debug&gt; MemoryTracker: Peak memory usage (for query): 16.32 MiB.
</code></pre> </li>
</ul>
<p> <strong>è¯´æ˜ï¼š</strong> </p>
<ul>
<li>MergeTreeWhereOptimizer: condition â€œEventDate = â€˜2014-03-17â€™â€ moved to PREWHEREï¼š å¯åŠ¨äº†PREWHEREä¼˜åŒ–ã€‚- Key condition: (column 1 in [16146, 16146])ï¼š ç”¨äº†ä¸»é”®ç´¢å¼•ã€‚- MinMax index condition: (column 0 in [16146, 16146])ï¼š ç”¨äº†åˆ†åŒºç´¢å¼•ã€‚- Selected 9 parts by date, 9 parts by key, 833 marks to read from 72 rangesï¼šä»1094 markså‡å°‘åˆ°833 marksã€‚- Read 6735786 rows, 61.49 MiB in 0.097 sec., 69655325 rows/sec., 635.86 MiB/sec.ï¼š æ•°æ®å¤§å°ä»67.70MBå˜ä¸º61.49MBï¼Œç”¨æ—¶ä»0.318ç§’å‡å°‘åˆ°0.097ç§’ã€‚</li>
</ul>
<h3 id="æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹"><a href="#æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹" class="headerlink" title="æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹"></a>æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹</h3> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹ä¸å¸¸ç”¨æ•°æ®æ ¼å¼"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8B%E4%B8%8D%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/"
    >clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹ä¸å¸¸ç”¨æ•°æ®æ ¼å¼</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8B%E4%B8%8D%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/" class="article-date">
  <time datetime="2021-07-18T14:12:50.326Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹ä¸å¸¸ç”¨æ•°æ®æ ¼å¼<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”# 1. Native</p>
<blockquote>
<p> æ•°æ®ä»¥äºŒè¿›åˆ¶æ•°æ®å—çš„æ–¹å¼è¿›è¡Œè¯»å†™ã€‚ æ•°æ®çš„å¯¼å‡ºï¼š clickhouse-client â€“query=â€œSELECT * FROM tsv_demo FORMAT Nativeâ€ &gt; a.native<br> æ•°æ®çš„å¯¼å…¥ï¼š clickhouse-client â€“query=â€œinsert into tsv_demo FORMAT Nativeâ€ &lt; a.native </p>
</blockquote>
<h1 id="2-Null"><a href="#2-Null" class="headerlink" title="2. Null"></a>2. Null</h1><blockquote>
<p> ä¸»è¦ç”¨äºæµ‹è¯•æ€§èƒ½ã€‚ æŸ¥è¯¢ä¼šè¢«å¤„ç†ï¼Œå¹¶ä¸”æ•°æ®ä¼šè¢«ä¼ é€åˆ°å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä»€ä¹ˆä¹Ÿä¸è¾“å‡ºã€‚ Nullæ ¼å¼åªèƒ½ç”¨äºæŸ¥è¯¢ï¼Œ ä¸èƒ½ç”¨äºæ•°æ®çš„å¯¼å…¥ã€‚ </p>
</blockquote>
<h1 id="3-Pretty"><a href="#3-Pretty" class="headerlink" title="3. Pretty"></a>3. Pretty</h1><blockquote>
<p> PrettyCompactï¼šåœ¨äº¤äº’å¼æ¨¡å¼ä¸‹ï¼Œé»˜è®¤çš„æ•°æ®æ˜¾ç¤ºæ ¼å¼ã€‚ PrettySpace </p>
</blockquote>
<h1 id="4-Values"><a href="#4-Values" class="headerlink" title="4. Values"></a>4. Values</h1><blockquote>
<p> æ¯è¡Œä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ï¼Œåˆ—ä¹‹é—´ä¹Ÿæ˜¯ä½¿ç”¨é€—å·åˆ†éš”ã€‚åœ¨æ‹¬å·ä¸­æ‰“å°æ¯ä¸€è¡Œã€‚ INSERT INTO XX values<br> INSERT INTO XX FORMAT Values<br> insert into tsv_demo FORMAT Values (â€˜115.248.158.231â€™, â€˜115.248.158.232â€™, â€˜2020-07-12 17:22:56â€™), (â€˜115.248.158.231â€™, â€˜115.248.158.232â€™, â€˜2020-07-12 17:22:56â€™); </p>
</blockquote>
<h1 id="5-Vertical"><a href="#5-Vertical" class="headerlink" title="5. Vertical"></a>5. Vertical</h1><blockquote>
<p> æ•°æ®ä»¥å‚ç›´çš„æ ¼å¼è¿›è¡Œå±•ç¤ºã€‚ \G </p>
</blockquote>
<ul>
<li>XML åªæ”¯æŒæ•°æ®çš„æŸ¥çœ‹ã€‚<br>select * from tsv_demo limit 2 FORMAT XML; </li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹Parquet"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8BParquet/"
    >clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹Parquet</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8BParquet/" class="article-date">
  <time datetime="2021-07-18T14:12:50.320Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹Parquet<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”# Parquetè¾“å…¥è¾“å‡ºæ ¼å¼</p>
<blockquote>
<p> æ”¯æŒParquetæ ¼å¼çš„å¯¼å‡ºå’Œå¯¼å…¥ã€‚ </p>
</blockquote>
<h1 id="Parquetå’ŒClickHouseç±»å‹çš„åŒ¹é…å…³ç³»"><a href="#Parquetå’ŒClickHouseç±»å‹çš„åŒ¹é…å…³ç³»" class="headerlink" title="Parquetå’ŒClickHouseç±»å‹çš„åŒ¹é…å…³ç³»"></a>Parquetå’ŒClickHouseç±»å‹çš„åŒ¹é…å…³ç³»</h1><blockquote>
 <img alt="" height="772" src="https://img-blog.csdnimg.cn/20210411161702364.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
 ä¸æ”¯æŒçš„Parquetæ•°æ®ç±»å‹ï¼šDATE32, TIME32, FIXED_SIZE_BINARY, JSON, UUID, ENUMã€‚ 
 **æ³¨æ„ï¼š** 
</blockquote>
<ul>
<li>ClickHouseè¡¨çš„åˆ—åå¿…é¡»ä¸Parquetè¡¨çš„åˆ—åä¸€è‡´ã€‚- ClickHouseè¡¨çš„åˆ—æ•°æ®ç±»å‹å¯ä»¥ä¸åŒäºæ’å…¥çš„Parquetæ•°æ®ç±»å‹ã€‚ åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œ ClickHouseæ ¹æ®ä¸Šè¡¨è§£é‡Šæ•°æ®ç±»å‹ï¼Œ ç„¶åå°†æ•°æ®ç±»å‹è½¬æ¢ä¸ºClickHouseè¡¨çš„åˆ—æ•°æ®ç±»å‹ã€‚</li>
</ul>
<h1 id="æ•°æ®çš„å¯¼å‡ºï¼š"><a href="#æ•°æ®çš„å¯¼å‡ºï¼š" class="headerlink" title="æ•°æ®çš„å¯¼å‡ºï¼š"></a>æ•°æ®çš„å¯¼å‡ºï¼š</h1><p>å¤‡æ³¨ï¼šè¡¨éšä¾¿æ‰¾ä¸€å¼ </p>
<blockquote>
<p> å‘½ä»¤ï¼šclickhouse-client â€“query=â€SELECT * FROM tutorial.tsv_demo FORMAT Parquetâ€ &gt; parquet_demo.parquet<br> <img alt="" height="142" src="https://img-blog.csdnimg.cn/20210411165153551.png" width="1200"> </p>
</blockquote>
<h1 id="æ•°æ®çš„å¯¼å…¥ï¼š"><a href="#æ•°æ®çš„å¯¼å…¥ï¼š" class="headerlink" title="æ•°æ®çš„å¯¼å…¥ï¼š"></a>æ•°æ®çš„å¯¼å…¥ï¼š</h1><blockquote>
<p> åˆ›å»ºæµ‹è¯•è¡¨ï¼š<br> å‘½ä»¤ï¼šcreate table parquet_demo (srcip String, destip String, time String) ENGINE=TinyLog;<br> å¯¼å…¥å‘½ä»¤ï¼š<br> cat parquet_demo.parquet | clickhouse-client â€“query=â€INSERT INTO parquet_demo FORMAT Parquetâ€ </p>
</blockquote>
<h3 id="å¯¼å…¥çš„æ•°æ®æŸ¥è¯¢ï¼š"><a href="#å¯¼å…¥çš„æ•°æ®æŸ¥è¯¢ï¼š" class="headerlink" title="å¯¼å…¥çš„æ•°æ®æŸ¥è¯¢ï¼š"></a>å¯¼å…¥çš„æ•°æ®æŸ¥è¯¢ï¼š</h3><blockquote>
 <img alt="" height="311" src="https://img-blog.csdnimg.cn/20210411171838671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="716"> 
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹ORC"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8BORC/"
    >clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹ORC</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8BORC/" class="article-date">
  <time datetime="2021-07-18T14:12:50.311Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹ORC<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”# ORCæ•°æ®çš„è¾“å…¥è¾“å‡º</p>
<p>ä»…æ”¯æŒORCæ ¼å¼çš„å†™å…¥ã€‚</p>
<h1 id="ORCå’ŒCHæ•°æ®ç±»å‹çš„åŒ¹é…å…³ç³»"><a href="#ORCå’ŒCHæ•°æ®ç±»å‹çš„åŒ¹é…å…³ç³»" class="headerlink" title="ORCå’ŒCHæ•°æ®ç±»å‹çš„åŒ¹é…å…³ç³»"></a>ORCå’ŒCHæ•°æ®ç±»å‹çš„åŒ¹é…å…³ç³»</h1><blockquote>
 <img alt="" height="721" src="https://img-blog.csdnimg.cn/20210411172805489.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="1200"> 
 **å¤‡æ³¨ï¼š** 
</blockquote>
<ul>
<li>ä¸æ”¯æŒçš„ORCæ•°æ®ç±»å‹ï¼šDATE32, TIME32, FIXED_SIZE_BINARY, JSON, UUID, ENUMã€‚- ClickHouseè¡¨çš„åˆ—åå¿…é¡»ä¸ORCè¡¨çš„åˆ—åä¸€è‡´ã€‚</li>
</ul>
<h1 id="ä½¿ç”¨Sparkç”ŸæˆORCæ–‡ä»¶"><a href="#ä½¿ç”¨Sparkç”ŸæˆORCæ–‡ä»¶" class="headerlink" title="ä½¿ç”¨Sparkç”ŸæˆORCæ–‡ä»¶"></a>ä½¿ç”¨Sparkç”ŸæˆORCæ–‡ä»¶</h1><blockquote>
<p> val list = List( Â  (â€œ113.248.234.232â€, â€œ123.212.22.01â€, â€œ2018-07-12 14:35:31â€), Â  (â€œ115.248.158.231â€, â€œ154.245.56.23â€, â€œ2020-07-12 13:26:26â€), Â  (â€œ115.248.158.231â€, â€œ154.245.56.23â€, â€œ2020-07-12 13:22:13â€), Â  (â€œ187.248.135.230â€, â€œ221.228.112.45â€, â€œ2019-08-09 13:17:39â€), Â  (â€œ187.248.234.232â€, â€œ221.228.112.24â€, â€œ2019-08-09 20:51:16â€), Â  (â€œ115.248.158.231â€, â€œ154.245.56.23â€, â€œ2020-07-12 17:22:56â€) )<br> val rdd = sc.makeRDD(list) import spark.implicits._ val df = rdd.toDF(â€œsrcipâ€, â€œdestipâ€, â€œtimeâ€) df.repartition(1).write.format(â€œorcâ€).mode(â€œappendâ€).save(â€œ/tmp/orcâ€) Â  </p>
</blockquote>
<h1 id="åˆ›å»ºæµ‹è¯•è¡¨"><a href="#åˆ›å»ºæµ‹è¯•è¡¨" class="headerlink" title="åˆ›å»ºæµ‹è¯•è¡¨"></a>åˆ›å»ºæµ‹è¯•è¡¨</h1><blockquote>
<p> create table orc_demo (srcip String, destip String, time DateTime) ENGINE=TinyLog; </p>
</blockquote>
<h1 id="æ•°æ®å¯¼å…¥"><a href="#æ•°æ®å¯¼å…¥" class="headerlink" title="æ•°æ®å¯¼å…¥"></a>æ•°æ®å¯¼å…¥</h1><blockquote>
<p> cat file.orc | clickhouse-client â€“query=â€INSERT INTO test.orc_demo FORMAT ORCâ€ </p>
</blockquote>
<h1 id="æŸ¥è¯¢ç»“æœ"><a href="#æŸ¥è¯¢ç»“æœ" class="headerlink" title="æŸ¥è¯¢ç»“æœ"></a>æŸ¥è¯¢ç»“æœ</h1><blockquote>
<p> <code>select * from orc_demo</code> </p>
</blockquote>
<img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/20210318163404299.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTcyNjk=,size_16,color_FFFFFF,t_70">
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹JSONç³»åˆ—ã€JSONã€JSONCompactå’ŒJSONEachRowã€‘"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8BJSON%E7%B3%BB%E5%88%97%E3%80%90JSON%E3%80%81JSONCompact%E5%92%8CJSONEachRow%E3%80%91/"
    >clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹JSONç³»åˆ—ã€JSONã€JSONCompactå’ŒJSONEachRowã€‘</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/18/clickhouse%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E4%B9%8BJSON%E7%B3%BB%E5%88%97%E3%80%90JSON%E3%80%81JSONCompact%E5%92%8CJSONEachRow%E3%80%91/" class="article-date">
  <time datetime="2021-07-18T14:12:50.304Z" itemprop="datePublished">2021-07-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Clickhouse/">Clickhouse</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>title: clickhouseè¾“å…¥è¾“å‡ºæ ¼å¼ä¹‹JSONç³»åˆ—ã€JSONã€JSONCompactå’ŒJSONEachRowã€‘<br>categories:</p>
<ul>
<li>clickhouse</li>
</ul>
<p>â€”# JSON</p>
<h2 id="JSONæ ¼å¼çš„è¾“å…¥è¾“å‡º"><a href="#JSONæ ¼å¼çš„è¾“å…¥è¾“å‡º" class="headerlink" title="JSONæ ¼å¼çš„è¾“å…¥è¾“å‡º"></a>JSONæ ¼å¼çš„è¾“å…¥è¾“å‡º</h2><p>JSONæ ¼å¼åªæ”¯æŒæ•°æ®çš„è¾“å‡ºï¼Œä¸æ”¯æŒæ•°æ®çš„è§£æï¼ˆæ•°æ®å¯¼å…¥ï¼‰ã€‚</p>
<h2 id="æ¡ˆä¾‹æ¼”ç¤º"><a href="#æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="æ¡ˆä¾‹æ¼”ç¤º"></a>æ¡ˆä¾‹æ¼”ç¤º</h2><h3 id="å»ºè¡¨æ’æ•°æ®"><a href="#å»ºè¡¨æ’æ•°æ®" class="headerlink" title="å»ºè¡¨æ’æ•°æ®"></a>å»ºè¡¨æ’æ•°æ®</h3><blockquote>
 <pre><code class="language-sql">create table t_json_demo(id UInt8, prov String) ENGINE=TinyLog;
insert into t_json_demo values(1, 'jiangsu'),
(1, 'jiangsu'),
(2, 'anhui'),
(2, 'anihu'),
(3, 'beijing');
</code></pre> 
</blockquote>
<h3 id="æŸ¥è¯¢æ¼”ç¤º"><a href="#æŸ¥è¯¢æ¼”ç¤º" class="headerlink" title="æŸ¥è¯¢æ¼”ç¤º"></a>æŸ¥è¯¢æ¼”ç¤º</h3><p><strong>ä»¥JSONæ ¼å¼æŸ¥è¯¢</strong></p>
<blockquote>
<p> å‘½ä»¤ï¼šselect id,count() as cnt from t_json_demo group by id format JSON;<br> <img alt="" height="854" src="https://img-blog.csdnimg.cn/20210411144340734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="532"> </p>
</blockquote>
<h3 id="å–å‡ºvalueçš„åŒå¼•å·"><a href="#å–å‡ºvalueçš„åŒå¼•å·" class="headerlink" title="å–å‡ºvalueçš„åŒå¼•å·"></a>å–å‡ºvalueçš„åŒå¼•å·</h3><blockquote>
<p> é»˜è®¤æƒ…å†µä¸‹ï¼Œ Int64å’ŒUInit64çš„æ•´å‹ä½¿ç”¨åŒå¼•å·åŒ…è£¹ï¼Œ å¦‚æœè¦ç§»é™¤åŒå¼•å·ï¼Œè®¾ç½®é…ç½®å‚æ•°output_format_json_quote_64bit_integersä¸º0ã€‚<br> å‘½ä»¤ï¼šset output_format_json_quote_64bit_integers=0;<br> å†è¿›è¡ŒåŒæ ·çš„æŸ¥è¯¢<br> å‘½ä»¤ï¼šselect id,count() as cnt from t_json_demo group by id format JSON;<br> <img alt="" height="843" src="https://img-blog.csdnimg.cn/20210411144556516.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="528"> </p>
</blockquote>
<h3 id="æŸ¥è¯¢æ—¶å‡ºç°rows-before-limit-at-least"><a href="#æŸ¥è¯¢æ—¶å‡ºç°rows-before-limit-at-least" class="headerlink" title="æŸ¥è¯¢æ—¶å‡ºç°rows_before_limit_at_least"></a>æŸ¥è¯¢æ—¶å‡ºç°rows_before_limit_at_least</h3><blockquote>
<p> åªæœ‰æŸ¥è¯¢åŒ…å«LIMITæ—¶æ‰è¾“å‡ºï¼Œ åªæœ‰åœ¨åŒ…å«group byçš„è¯­å¥ä¸­æ‰æœ‰æ„ä¹‰ã€‚å½“æŸ¥è¯¢æ²¡æœ‰LIMITæ—¶ï¼Œ æ‰§è¡Œç»“æœçš„æœ€å°è¡Œæ•°ã€‚ </p>
</blockquote>
<h3 id="è®¾ç½®æ˜¾ç¤ºæå€¼çš„å‚æ•°extremes-1ï¼ˆé»˜è®¤ä¸º0ï¼‰"><a href="#è®¾ç½®æ˜¾ç¤ºæå€¼çš„å‚æ•°extremes-1ï¼ˆé»˜è®¤ä¸º0ï¼‰" class="headerlink" title="è®¾ç½®æ˜¾ç¤ºæå€¼çš„å‚æ•°extremes=1ï¼ˆé»˜è®¤ä¸º0ï¼‰"></a>è®¾ç½®æ˜¾ç¤ºæå€¼çš„å‚æ•°extremes=1ï¼ˆé»˜è®¤ä¸º0ï¼‰</h3><blockquote>
<p> set extremes=1;<br> åœ¨è¿›è¡ŒæŸ¥è¯¢<code>select id,count() as cnt from t_json_demo group by id format JSON;</code><br> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/20210318151530860.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTcyNjk=,size_16,color_FFFFFF,t_70"> </p>
</blockquote>
<p>Â </p>
<h1 id="JSONCompact"><a href="#JSONCompact" class="headerlink" title="JSONCompact"></a>JSONCompact</h1><h2 id="JSONCompactçš„è¾“å…¥è¾“å‡º"><a href="#JSONCompactçš„è¾“å…¥è¾“å‡º" class="headerlink" title="JSONCompactçš„è¾“å…¥è¾“å‡º"></a>JSONCompactçš„è¾“å…¥è¾“å‡º</h2><blockquote>
</blockquote>
<ul>
<li>JSONæ ¼å¼çš„æ•°æ®ä»¥å¯¹è±¡çš„æ–¹å¼è¾“å‡ºï¼Œ è€ŒJSONCompactä»¥æ•°ç»„çš„æ–¹å¼è¾“å‡ºã€‚- JSONCompactåªæ”¯æŒæ•°æ®çš„æŸ¥çœ‹ï¼Œ ä¸æ”¯æŒæ•°æ®çš„å¯¼å…¥ã€‚<h2>æ¡ˆä¾‹æ¼”ç¤º</h2> 
`select id,count() as cnt from t_json_demo group by id format JSONCompact;` 
<img alt="" height="729" src="https://img-blog.csdnimg.cn/20210411145009619.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tfNTIwX1c=,size_16,color_FFFFFF,t_70" width="521"> </li>
</ul>
<h1 id="JSONEachRow"><a href="#JSONEachRow" class="headerlink" title="JSONEachRow"></a>JSONEachRow</h1><h2 id="JSONEachRowæ•°æ®è¾“å…¥è¾“å‡º"><a href="#JSONEachRowæ•°æ®è¾“å…¥è¾“å‡º" class="headerlink" title="JSONEachRowæ•°æ®è¾“å…¥è¾“å‡º"></a>JSONEachRowæ•°æ®è¾“å…¥è¾“å‡º</h2><blockquote>
</blockquote>
<ul>
<li>æ¯è¡Œæ•°æ®ä»¥æ¢è¡Œç¬¦åˆ†éš”çš„JSONå¯¹è±¡ã€‚- æ”¯æŒæ•°æ®çš„è¾“å‡ºå’Œæ•°æ®å¯¼å…¥ã€‚<h2>æ¡ˆä¾‹æ¼”ç¤º</h2> 
`select id,count() as cnt from t_json_demo group by id format JSONEachRow;` 
<img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/20210318152711341.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTcyNjk=,size_16,color_FFFFFF,t_70"> </li>
</ul>
<h3 id="æ•°æ®å¯¼å…¥"><a href="#æ•°æ®å¯¼å…¥" class="headerlink" title="æ•°æ®å¯¼å…¥"></a>æ•°æ®å¯¼å…¥</h3><blockquote>
</blockquote>
<ul>
<li>å¯¹è±¡ä¸­é”®å€¼å¯¹çš„é¡ºåºå¯ä»»æ„æ’åˆ—ã€‚- ç¼ºå¤±æŸäº›å­—æ®µã€‚<h3>å»ºè¡¨æ’å…¥æ•°æ®</h3> 
<pre><code class="language-sql">#å»ºè¡¨
create table UserActivity (PageViews UInt8, UserID String, Duration UInt64, Sign Int8) ENGINE TinyLog;
#æ’å…¥æ•°æ®
INSERT INTO UserActivity FORMAT JSONEachRow &#123;"PageViews":5, "UserID":"4324182021466249494", "Duration":146,"Sign":-1&#125; &#123;"UserID":"4324182021466249494","PageViews":6,"Duration":185,"Sign":1&#125;
</code></pre> 
<h2>ç¼ºå¤±å€¼å¤„ç†æ¼”ç¤º</h2> 
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS example_table
(
 x UInt32,
 a DEFAULT x + 2
) ENGINE = Memory;
# ç¬¬äºŒæ¡æ•°æ®ç¬¬äºŒä¸ªå€¼æ²¡æœ‰è®¾ç½®
insert into example_table FORMAT JSONEachRow &#123;"x":3, "a":5&#125; &#123;"x":4&#125;;
</code></pre> 
<img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/20210318154207105.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTcyNjk=,size_16,color_FFFFFF,t_70"> </li>
</ul>
<h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><blockquote>
<p> å‚æ•°ï¼šinput_format_defaults_for_omitted_fields å¦‚æœä¸º0ï¼Œ åˆ™xå’Œaçš„é»˜è®¤å€¼ç­‰äº0ï¼ˆå³UInt32æ•°æ®ç±»å‹çš„é»˜è®¤å€¼ï¼‰ã€‚ å¦‚æœä¸º1ï¼Œ åˆ™xçš„é»˜è®¤å€¼ç­‰äº0ï¼Œ ä½†açš„é»˜è®¤å€¼ç­‰äºx+2ã€‚ input_format_defaults_for_omitted_fields=1 </p>
</blockquote>
<h3 id="åµŒå¥—æ•°æ®ç»“æ„"><a href="#åµŒå¥—æ•°æ®ç»“æ„" class="headerlink" title="åµŒå¥—æ•°æ®ç»“æ„"></a>åµŒå¥—æ•°æ®ç»“æ„</h3><p><strong>æ¡ˆä¾‹æ¼”ç¤º</strong></p>
<p><strong>å»ºè¡¨æ’å…¥æ•°æ®</strong></p>
<blockquote>
<p> #å»ºè¡¨ CREATE TABLE json_each_row_nested (n Nested (s String, i Int32) ) ENGINE = Memory; # æ’å…¥æ•°æ® INSERT INTO json_each_row_nested FORMAT JSONEachRow {â€œn.sâ€: [â€œabcâ€, â€œdefâ€], â€œn.iâ€: [1, 23]}; # æŸ¥çœ‹æ•°æ® select * from json_each_row_nested;<img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/20210318154828387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTcyNjk=,size_16,color_FFFFFF,t_70"> </p>
</blockquote>
<h3 id="è¦å°†æ•°æ®ä½œä¸ºåˆ†å±‚JSONå¯¹è±¡æ’å…¥"><a href="#è¦å°†æ•°æ®ä½œä¸ºåˆ†å±‚JSONå¯¹è±¡æ’å…¥" class="headerlink" title="è¦å°†æ•°æ®ä½œä¸ºåˆ†å±‚JSONå¯¹è±¡æ’å…¥"></a>è¦å°†æ•°æ®ä½œä¸ºåˆ†å±‚JSONå¯¹è±¡æ’å…¥</h3><blockquote>
<p> éœ€è¦è®¾ç½®input_format_import_nested_json=1ã€‚ï¼ˆé»˜è®¤ä¸º0ï¼‰ </p>
</blockquote>
<h3 id="å½“å‚æ•°è®¾ç½®ä¸ºé›¶æ—¶"><a href="#å½“å‚æ•°è®¾ç½®ä¸ºé›¶æ—¶" class="headerlink" title="å½“å‚æ•°è®¾ç½®ä¸ºé›¶æ—¶"></a>å½“å‚æ•°è®¾ç½®ä¸ºé›¶æ—¶</h3><blockquote>
<p> å½“éœ€è¦è®¾ç½®input_format_import_nested_json=0æ—¶ï¼š INSERT INTO json_each_row_nested FORMAT JSONEachRow {â€œnâ€: {â€œsâ€: [â€œabcâ€, â€œdefâ€], â€œiâ€: [1, 23]}}<br> Exception on client: Code: 117. DB::Exception: Unknown field found while parsing JSONEachRow format: n<br> Connecting to 192.168.0.200:9000 as user default. Connected to ClickHouse server version 20.1.4 revision 54431. </p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/">ä¸‹ä¸€é¡µ</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> kgf
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        ç”± <a href="https://hexo.io" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨
        <span class="division">|</span>
        ä¸»é¢˜ - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>è®¿é—®äººæ•°:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>æµè§ˆæ¬¡æ•°:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/image1.ico" alt="çˆ±ä¸Šå£è¢‹çš„å¤©ç©º"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">å…³äºæˆ‘</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="æœç´¢">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>è¯·æˆ‘å–æ¯å’–å•¡å§~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
  </div>
</body>

</html>